{"url": "https://community.thingspeak.com/forum/arduino/page-8/", "threads": [{"url": "https://community.thingspeak.com/forum/arduino/connecting-arduino-uno-r3-to-thingspeak-using-w5100/", "posts": [{"date": "February 27, 2016 - 2:36 am", "content": "hi, actual i am new this thing speak.i have arduino uno r3 and the Ethernet shield w5100, with me right now and i want to send the data sensed by sensor dht11.please can any one help how to this?", "num_user_post": " 5", "author": "sushma"}]}, {"url": "https://community.thingspeak.com/forum/arduino/sync-rtc/", "posts": [{"date": "February 22, 2016 - 3:26 pm", "content": "Hi,I'm working on a project that requires synchronizing a RTC module with ThingSpeakThe idea is to use the RTC module time and not the datetime of  ThingSpeak to upload the sensor data.Anyone have an idea?Thanks", "num_user_post": " 2", "author": "osc.araya"}, {"date": "February 22, 2016 - 6:44 pm", "content": "Include the created_at field in your update as per https://au.mathworks.com/help/thingspeak/update-channel-feed.htmlYou need to have the right format for the date/time value.", "num_user_post": " 271", "author": "rw950431"}, {"date": "February 26, 2016 - 3:44 pm", "content": "Thank you very much. ", "num_user_post": " 2", "author": "osc.araya"}]}, {"url": "https://community.thingspeak.com/forum/arduino/invalid-operands-of-types-const-char-and-const-char-9-to-binary-operator/", "posts": [{"date": "February 23, 2016 - 11:12 pm", "content": "This...    updateThingSpeak('field1=' + hum+ '&field2=' + temp);Verifies to this...invalid operands of types 'const char*' and 'const char [9]' to binary 'operator+'Have followed ThingSpeak's tutorial and not surmising why the error.Please teach this noob a lessonThanks", "num_user_post": " 1", "author": "tvmiller"}, {"date": "February 24, 2016 - 4:34 pm", "content": "Hi, Which library are you using for this? Also, could you point us to the tutorial you are referring to?Thanks", "num_user_post": " 62", "author": "Adarsh_Murthy"}]}, {"url": "https://community.thingspeak.com/forum/arduino/thingspeak-and-arduino-yun-not-working/", "posts": [{"date": "February 24, 2016 - 2:09 pm", "content": "I've been logging my data for months now but suddenly the service stopped working.I was using this code but even using the new library provided by thingspeak nothing seems to work...any idea?#include               //LIBRERIA BRIDGE #include                  //LIBRERIA SENSORE #include              //LIBRERIA SHELL#define DHTPIN 4        // DEFINISCO IL PIN#define DHTTYPE DHT22   // DEFINISCO IL TIPO DI SENSORE DHT 22DHT dht(DHTPIN, DHTTYPE); //********************// ThingSpeak Settings//********************#define ARRAY_SIZE           2  //l'array dei dati da postare su thingspeakvoid setup() {      Bridge.begin();       Console.begin();  dht.begin(); //INIZIALIZZO SENSORE}//********************//FUNZIONE POST VALORI//********************void postToThingSpeak(String key, float value[]) {  Process p;  String cmd = 'curl -d 'key='+key;  for (int i=0;i<ARRAY_SIZE;i++) {    cmd = cmd + '&field'+ (i+1) + '=' + value[i];  }  cmd = cmd + '' http://api.thingspeak.com/update&quot;;    p.runShellCommand(cmd);  Console.println(cmd);  //p.close();}void loop() {  float temperature = dht.readTemperature();  //LEGGO TEMPERATURA DEL SENSORE Console.println('temperatura:');    Console.println(temperature);  float humidity = dht.readHumidity();        //LEGGO UMIDIT\u00c0 DEL SENSORE    Console.println(humidity); float vol[ARRAY_SIZE];  vol[0] = temperature;  vol[1] = humidity;  postToThingSpeak('XXXXXXXXXX', vol); //ACCOUNT  delay(20000); // ThingSpeak will only accept updates every 15 seconds.}", "num_user_post": " 2", "author": "raxpa"}, {"date": "February 24, 2016 - 4:03 pm", "content": "Hi, I just checked the api.thingspeak.com/update end point and it seems to be working. Could it possible be the internet connection on the yun?Thanks,Adarsh", "num_user_post": " 62", "author": "Adarsh_Murthy"}]}, {"url": "https://community.thingspeak.com/forum/arduino/mega-with-esp-and-12-fields-how-to-upload-to-multiple-channels/", "posts": [{"date": "February 18, 2016 - 12:57 pm", "content": "Hi,I have a project and I'm using a Arduino Mega with ESP8266 for connectivity.This project has many sensors and standard examples of how to upload to ThingSpeak only allows a maximum of 8 fields to 1 channel.I have created 2 channels and now need to upload 8 fields to the 1st channel and the other 4 fields to the 2nd channel.Can anybody please help me with a working example or sketch please?I've been successful with uploading the normal 8 fields to 1 channel but I have failed updating 2 channels.Please help!Kind Regards,Peter", "num_user_post": " 2", "author": "petertree"}, {"date": "February 18, 2016 - 8:12 pm", "content": "What code are you using for the upload?  Its likely you will have to create a second instance of the client with a different key.", "num_user_post": " 271", "author": "rw950431"}, {"date": "February 19, 2016 - 3:22 am", "content": "rw950431 said What code are you using for the upload?  Its likely you will have to create a second instance of the client with a different key.Hi, thanks for the reply!I'm no programmer and I've tried different ways but cannot get it to work.Thus hoping for someone with a good example or sketch \ud83d\ude42", "num_user_post": " 2", "author": "petertree"}, {"date": "February 21, 2016 - 11:38 pm", "content": "Did you try the arduino forums? http://forum.arduino.cc/index.phpPost your code for 1 channel that works and see if anyone can help out.", "num_user_post": " 271", "author": "rw950431"}]}, {"url": "https://community.thingspeak.com/forum/arduino/i-need-to-push-feeds-to-thingspeak-from-arduino-connected-by-cable-to-my-laptop/", "posts": [{"date": "January 25, 2016 - 10:13 am", "content": "Hello, I am new to thingspeak. I used to use Xively, and I did not have any problem pushing feeds online.  I uploaded Uno firmata to arduino, and used grasshopper; ghowl and firefly.On thingspeak, I can't push feeds online. What I am trying to do is a simple test of sending photocell data to thingspeak, collected from arduino uno Rs3 which is connected by usb cable to my laptop.Any help is much appreciated !", "num_user_post": " 1", "author": "Hunia"}, {"date": "January 25, 2016 - 2:44 pm", "content": "Hi Hunia,Where are you getting stuck?   I assume you're able to get the data from the Arduino to your laptop since that was working with your Xively setup. I'm not familiar with grasshopper, ghowl, and firefly but a quick google search indicates that gHowl is quite extensible.  If this is what you're using, you need this set of apps to push your data to ThingSpeak. ThingSpeak has a restful API you can call to do this. So presumably you can extend gHowl (or grasshpper/firely) to make internet calls that include the calls to the ThingSpeak API.   Alternatively, you could write an app in any language to read from the serial port and post to ThingSpeak.Need a little more detail about where you are stuck to be more helpful....Tom", "num_user_post": " 1", "author": "tlowell"}]}, {"url": "https://community.thingspeak.com/forum/arduino/arduino-uploading-blank-entries-to-thingspeak/", "posts": [{"date": "January 18, 2016 - 9:26 am", "content": "Hi there!I'm using an ESP8266 wifi shield to upload some data to Thingspeak, and while it does show something is being uploaded (the number of entries increases indicating it's getting something), but the entry is completely blank and doesn't have the number it's supposed to have received.. I'm using the ThingSpeak library that was newly introduced. Is this a problem anyone else has faced?thanks!", "num_user_post": " 9", "author": "abhishekjacob21"}, {"date": "January 18, 2016 - 1:17 pm", "content": "Hi abhishekjacob21,Sorry to hear you're having trouble.  Would you post the code that you're using to post?-Rob", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "January 18, 2016 - 3:26 pm", "content": "Rob,So while doing some troubleshooting, I deleted the rest of the void loop just in a n attempt to simplify things. Unfortunately that didn't have a positive effect on the results.. When I upload it, though, it says 'Low memory available, stability problems may occur.' Could that be a cause?Here's the code I have:#include #include // The SparkFunESP8266WiFi library uses SoftwareSerial// to communicate with the ESP8266 module. Include that// library first:#include// Include the ESP8266 AT library:#include MS5803 sensor(ADDRESS_HIGH);//////////////////////////////// WiFi Network Definitions ////////////////////////////////// Replace these two character strings with the name and// password of your WiFi network.const char mySSID[] = 'IFH Loft';const char myPSK[] = 'ifhJanuary';ESP8266Client client;//////////////////////////// Thingspeak Constants ////////////////////////////unsigned long myChannelNumber = 64341;const char * myWriteAPIKey = '4JRIMA3GJF3PIQKE';/////////////////////Time Retrieval ///////////////////////////////////////////////Variable Definitions//////////////////////////int Calc;volatile int NbTopsFan;unsigned long copyCount = 0;unsigned long lastRead = 0;unsigned long interval = 1000;unsigned long thingspeakInterval = 16000;unsigned long lastThingspeak = 0;int hallsensor = 3;unsigned long lastThingspeak2 = 0;unsigned long thingspeakInterval2 = 40000;float temperature_c, temperature_f;double pressure_abs, pressure_relative, altitude_delta, pressure_baseline;float atmPressure = 101300;float depth;float rho = 1000.0; // units: kg/m^3float g = 9.8; // units: m/s^2float currentPressure;float depthft;double base_altitude = 1655.0; // Altitude of SparkFun's HQ in Boulder, CO. in (m)const int redPin=5;const int greenPin=10;const int bluePin=6;const int max_red=255;const int max_green=255;const int max_blue=255;byte colors[3]={0, 0, 0};byte lineEnding = 0x0A;byte redVal=0;byte greenVal=0;byte blueVal=0;void rpm(){  NbTopsFan++;}void setup(){  pinMode (hallsensor, INPUT);  pinMode (redPin, OUTPUT);  pinMode (greenPin, OUTPUT);  pinMode (bluePin, OUTPUT);  attachInterrupt(1, rpm, RISING);  int status;  Serial.begin(9600);  // To turn the MG2639 shield on, and verify communication  // always begin a sketch by calling cell.begin().  status = esp8266.begin();  if (status <= 0)  {    Serial.println(F('Unable to communicate with shield. Looping'));    while(1) ;  }  esp8266.setMode(ESP8266_MODE_STA); // Set WiFi mode to station  if (esp8266.status() <= 0) // If we're not already connected  {    if (esp8266.connect(mySSID, myPSK) = thingspeakInterval){    ThingSpeak.writeField(myChannelNumber, 2, depthft, myWriteAPIKey);    lastThingspeak = millis();  }  Serial.println(depthft);  delay(1000);}", "num_user_post": " 9", "author": "abhishekjacob21"}, {"date": "January 18, 2016 - 8:28 pm", "content": "I'm sorry Rob but for some reason the code didn't copy properly. Below is the void setup and loop functions:void setup(){  int status;  Serial.begin(9600);  // To turn the MG2639 shield on, and verify communication  // always begin a sketch by calling cell.begin().  status = esp8266.begin();  if (status <= 0)  {    Serial.println(F('Unable to communicate with shield. Looping'));    while(1) ;  }  esp8266.setMode(ESP8266_MODE_STA); // Set WiFi mode to station  if (esp8266.status() <= 0) // If we're not already connected  {    if (esp8266.connect(mySSID, myPSK) < 0)    {      Serial.println(F('Error connecting'));      while (1) ;    }  }  // Get our assigned IP address and print it:  Serial.print(F('My IP address is: '));  Serial.println(esp8266.localIP());  ThingSpeak.begin(client);  setTime(9, 27, 59, 18, 02, 2015);}void loop(){  Calc = 7;  ThingSpeak.writeField(myChannelNumber, 1, Calc, myWriteAPIKey);}", "num_user_post": " 9", "author": "abhishekjacob21"}, {"date": "January 19, 2016 - 1:54 am", "content": "So an update: I kept removing pieces of the code above and eventually it just started working..And when I added the code that I took out back, it continued to work..Do you think it has something to do with the 'Low Memory' issue?", "num_user_post": " 9", "author": "abhishekjacob21"}, {"date": "January 20, 2016 - 9:40 am", "content": "Hi abhishekjacob21,Yes -- that is almost certainly the cause.  The ESP8266 doesn't have a whole lot of memory to work with.  I tried to keep the memory footprint of the write functions as low as I could, but many of the string operations needed to construct the HTTP post will fail silently once we're low on memory.One option would be to rip apart the library and only take the absolute minimum for what you need.  It is flexible, and as such it uses more memory than a dedicated implementation might use.-Rob", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "January 21, 2016 - 5:39 pm", "content": "Because I don't know C++ or much about programming for that matter, can you give me an idea of what I can remove from the code so that it reduces the SRAM usage? The only lines in the code using the library are:-ThingSpeak.begin(client)-ThingSpeak.writeField(myChannelNumber, 2, depthft, myWriteAPIKey); (this line uses approximately 13% of the memory)I'm also exploring ways to reduce memory used by other libraries. (The one for using the ESP8266 is also quite substantial)thanks for the help!", "num_user_post": " 9", "author": "abhishekjacob21"}]}, {"url": "https://community.thingspeak.com/forum/arduino/error-code-303-err_bad_response-unable-to-parse-response/", "posts": [{"date": "January 8, 2016 - 4:01 am", "content": "Hey everyone,I'm using the mathwork/thingspeak-arduino library to update a private channel from an Arduino Mega. I'm using a standard ethernet shield.My project has been running smooth for the past 3 months but today it all went south. Data are updated fine on TS (sensor values), but something is wrong and it looks like reading from TS won't work properly anymore.So I logged a bit and I found out that whenever I try to write to TS (using setField several times then writeFields, which was running fine so far) I get a 303 error code which as I read in the library means  ERR_BAD_RESPONSE / Unable to parse responseI looked through the interwebs, on official doc and on this forum but couldnt find anything related to this error, how to deal with it etc..Also, reading values from TS will return all zeros.What is weird is that data are still correctly written to TS so my first naive guess is that this is a TS return message error but can't be sure.If someone here have any clue of what it means i would be soooo happy.Thanks a lotCheers", "num_user_post": " 2", "author": "baoutch"}, {"date": "January 8, 2016 - 2:24 pm", "content": "Yes -- there was a latent bug in the library that was exposed when the response message from ThingSpeak changed slightly.  I have posted a new version of the library on GitHub.  It should appear in the Arduino IDE within the next few hours.  If you want it sooner, get the ThingSpeak.h file direct from GitHub.-Rob", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "January 9, 2016 - 5:01 pm", "content": "Hey Rob,Everything seems back to normal on my side.Thanks a lot for your fast fix.Cheers", "num_user_post": " 2", "author": "baoutch"}, {"date": "January 15, 2016 - 4:43 pm", "content": "For my own learning, could you post up what line in the header or cpp file had to be changed, and what the change was?", "num_user_post": " 7", "author": "TipsEZ"}]}, {"url": "https://community.thingspeak.com/forum/arduino/thingspeak-communication-library-for-particle-photon-and-core/", "posts": [{"date": "September 11, 2015 - 3:51 pm", "content": "We've created a Arduino library to connect your Particle Photon or Core to ThingSpeak. It appears inside the Particle Build IDE list of libraries.  You can get a Cheerlights client running in about 90 seconds, and try out the examples right away! You can read and write with just 1 line of code!See the 90 second video:  Send us your feedback!-Rob", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "December 28, 2015 - 8:26 am", "content": "Hi all,Version 1.1.0 of these libraries now supports ESP8226 devices, the Particle Electron (coming soon!).You can use these libraries directly from within the Arduino and Particle IDEs.All the best,-Rob", "num_user_post": " 47", "author": "Rob Purser"}]}, {"url": "https://community.thingspeak.com/forum/arduino/sketch-sends-data-a-couple-times-then-stops/", "posts": [{"date": "November 11, 2015 - 8:33 pm", "content": "hey guys, when I run my sketch, it updates quite a few times (arbitrary) and then it stops. Not sure why. Can you look through my code? It's largely a copy of the code from here: http://community.thingspeak.com/tutorials/arduino/using-an-arduino-ethernet-shield-to-update-a-thingspeak-channel/#include#include#include#include#include // These are the interrupt and control pins#define ADAFRUIT_CC3000_IRQ   2  // MUST be an interrupt pin!// These can be any two pins#define ADAFRUIT_CC3000_VBAT  7#define ADAFRUIT_CC3000_CS    10// Use hardware SPI for the remaining pins// On an UNO, SCK = 13, MISO = 12, and MOSI = 11Adafruit_CC3000 cc3000 = Adafruit_CC3000(ADAFRUIT_CC3000_CS, ADAFRUIT_CC3000_IRQ, ADAFRUIT_CC3000_VBAT,                                         SPI_CLOCK_DIVIDER); // you can change this clock speed but DI#define WLAN_SSID       'wlan_ssid'        // cannot be longer than 32 characters!#define WLAN_PASS       'wlan_pass'// Security can be WLAN_SEC_UNSEC, WLAN_SEC_WEP, WLAN_SEC_WPA or WLAN_SEC_WPA2#define WLAN_SECURITY   WLAN_SEC_WPA2char server[]= 'api.thingspeak.com';String writeAPIKey = '4JRIMA3GJF3PIQKE'; // API key for Thingspeaklong lastConnectionTime = 0;boolean lastConnected = false;int failedCounter = 0;int test = 0; //THIS IS THE VALUE BEING LOGGED. Adafruit_CC3000_Client client;const unsigned long  connectTimeout  = 15L * 1000L, // Max time to wait for server connection  responseTimeout = 15L * 1000L; // Max time to wait for data from serverint  countdown       = 0;  // loop() iterations until next time server queryunsigned long  lastPolledTime  = 0L, // Last value retrieved from time server  sketchTime      = 0L; // CPU milliseconds since last server queryvoid setup(void){  Serial.begin(9600);  Serial.println(F('Hello, CC3000!'));   Serial.println(F('Initialising the CC3000 ...'));  if (!cc3000.begin()) {    Serial.println(F('Unable to initialise the CC3000! Check your wiring?'));    for(;;);  }  Serial.println(F('Deleting old connection profiles'));  if (!cc3000.deleteProfiles()) {    Serial.println(F('Failed!'));    while(1);  }  /* Attempt to connect to an access point */  char *ssid = WLAN_SSID;             /* Max 32 chars */  Serial.print(F('Attempting to connect to ')); Serial.println(ssid);  /* NOTE: Secure connections are not available in 'Tiny' mode! */  if (!cc3000.connectToAP(WLAN_SSID, WLAN_PASS, WLAN_SECURITY)) {    Serial.println(F('Failed!'));    while(1);  }  Serial.println(F('Connected!'));  /* Wait for DHCP to complete */  Serial.println(F('Request DHCP'));  while (!cc3000.checkDHCP()) {    delay(100); // ToDo: Insert a DHCP timeout!  }}void loop(void) {  if(countdown == 0) {            // Time's up?    unsigned long t  = getTime(); // Query time server    if(t) {                       // Success?      lastPolledTime = t;         // Save time      sketchTime     = millis();  // Save sketch time of last valid time query      countdown      = 24*60*4-1; // Reset counter: 24 hours * 15-second intervals    }  }  else {    countdown--;                  // Don't poll; use math to figure current time  }  unsigned long currentTime = lastPolledTime + (millis() - sketchTime) / 1000;  setTime(currentTime-18000);  Serial.print(hour());  Serial.print(':');  Serial.println(minute());  test = 7;  if (client.available()){    char c = client.read();    //Serial.print(c);  }  if (!client.connected() && lastConnected){    Serial.println('...disconnected');    Serial.println();    client.stop();  }  updateThingSpeak('field1='+ String(test,DEC)); // if(!client.connected() && (millis() - lastConnectionTime > updateThingSpeakInterval)){   // updateThingSpeak('field1='+ String(test,DEC));  //}  if (failedCounter > 3){    cc3000.connectToAP(WLAN_SSID, WLAN_PASS, WLAN_SECURITY);  }  lastConnected = client.connected();  delay(15000);}// Minimalist time server query; adapted from Adafruit Gutenbird sketch,// which in turn has roots in Arduino UdpNTPClient tutorial.unsigned long getTime(void) {  uint8_t       buf[48];  unsigned long ip, startTime, t = 0L;  Serial.print(F('Locating time server...'));  // Hostname to IP lookup; use NTP pool (rotates through servers)  if(cc3000.getHostByName('pool.ntp.org', &ip)) {    static const char PROGMEM      timeReqA[] = { 227,  0,  6, 236 },      timeReqB[] = {  49, 78, 49,  52 };    Serial.println(F('Attempting connection...'));    startTime = millis();    do {      client = cc3000.connectUDP(ip, 123);    } while((!client.connected()) &&            ((millis() - startTime) < connectTimeout));    if(client.connected()) {      Serial.print(F('connected!Issuing request...'));      // Assemble and issue request packet      memset(buf, 0, sizeof(buf));      memcpy_P( buf    , timeReqA, sizeof(timeReqA));      memcpy_P(&buf[12], timeReqB, sizeof(timeReqB));      client.write(buf, sizeof(buf));      Serial.print(F('Awaiting response...'));      memset(buf, 0, sizeof(buf));      startTime = millis();      while((!client.available()) &&            ((millis() - startTime) < responseTimeout));      if(client.available()) {        client.read(buf, sizeof(buf));        t = (((unsigned long)buf[40] << 24) |             ((unsigned long)buf[41] << 16) |             ((unsigned long)buf[42] <<  8) |              (unsigned long)buf[43]) - 2208988800UL;        Serial.print(F('OK'));      }      client.close();    }  }  if(!t) Serial.println(F('error'));  return t;}void updateThingSpeak(String tsData){ //this block of lines basically accesses the Thingspeak channel in the required format  if (client.connect(server, 80)){    client.print('POST /update HTTP/1.1');    client.print('Host: api.thingspeak.com');    client.print('Connection: close');    client.print('X-THINGSPEAKAPIKEY: '+writeAPIKey+ '');    client.print('Content-Type: application/x-www-form-urlencoded');    client.print('Content-Length: ');    client.print(tsData.length());    client.print('');    client.print(tsData);    lastConnectionTime = millis();    if (client.connected()){      Serial.println('Connected to Thingspeak...');      Serial.println();      failedCounter = 0;    }    else{      failedCounter++;      Serial.println('Connection to ThingSpeak failed ('+String(failedCounter, DEC)+')');      Serial.println();    }   }   else{    failedCounter++;    Serial.println('Connection to ThingSpeak failed ('+String(failedCounter, DEC)+')');    Serial.println();    lastConnectionTime = millis();   }  }", "num_user_post": " 9", "author": "abhishekjacob21"}, {"date": "November 12, 2015 - 9:27 am", "content": "abhishekjacob21,Can you please elaborate what you have tried to resolve the issue? For example, are there any messages written to a console or to a log which says the device lost internet connectivity and the program terminated?", "num_user_post": " 4", "author": "hans"}]}, {"url": "https://community.thingspeak.com/forum/arduino/arduino-not-working/", "posts": [{"date": "November 2, 2015 - 12:07 pm", "content": "My Arduino and ether net shield have been working for at least 4 years I replaced the router and now it is not working. Do I need to change something on my new router?", "num_user_post": " 5", "author": "samlro"}, {"date": "November 2, 2015 - 2:49 pm", "content": "Are you just sending data to ThingSpeak or is ThingSpeak controlling your devices?Also, I would ask if your Arduino is using static IPs? I would look at your your Arduino code and look for a line that says, '192.168.x.x'. Your new router may be a different subnet.", "num_user_post": " 402", "author": "Hans"}, {"date": "November 2, 2015 - 3:02 pm", "content": "I am just sending data. How can I find out the subnet of the router?", "num_user_post": " 5", "author": "samlro"}, {"date": "November 2, 2015 - 3:28 pm", "content": "How I just send something from the http line to test your end?", "num_user_post": " 5", "author": "samlro"}, {"date": "November 3, 2015 - 10:17 am", "content": "Are you using windows?If so, open 'cmd' and type 'ipconfig' and press enter. You are looking for your default gateway address.Does your Arduino code make mention of an IP address anywhere?", "num_user_post": " 402", "author": "Hans"}, {"date": "November 3, 2015 - 12:02 pm", "content": "Yes 192.168.?.175. I can't remember the 3rd number. It maybe 1.", "num_user_post": " 5", "author": "samlro"}, {"date": "November 4, 2015 - 11:36 am", "content": "It is working now my new router only can handle 192.168.1.up 99 not 175", "num_user_post": " 5", "author": "samlro"}]}, {"url": "https://community.thingspeak.com/forum/arduino/mq-2-slow-responses/", "posts": [{"date": "October 27, 2015 - 4:21 pm", "content": "Looking for a little help if I may.I have a couple of Arduinos running on Thingspeak but I want to try and speed up one of them.Managed to graft some MQ-2 code into the basic Thingspeak sketch and it is working, but its very slow.https://thingspeak.com/channels/62674Tried two versions. One with all comments and serial print statements removed apart from the few that are really needed for debug. and one that contains items from the original MQ source, but both are the same.Managed to reduce some delays and timers but I suspect I may be getting close to corrupting the outputs to Thingspeak.Thinking  maybe I might have grafted a section of code into the wrong spot and its doing too many readings on the sensor before sending to Thingspeak ?I understand there is a 15/16 second delay between readings but currently it is way more than that and I think some brief readings will probably get missed.Below is the sketch I currently use for the MQ-2. Not sure how much the forum munges code so gonna try it as is.Forgive me if I get this wrong --------------MQ-2 Sketch below-----------------/* Arduino --> ThingSpeak Channel via Ethernet The ThingSpeak Client sketch is designed for the Arduino and Ethernet. This sketch updates a channel feed with an analog input reading via the ThingSpeak API (https://thingspeak.com/docs) using HTTP POST. The Arduino uses DHCP and DNS for a simpler network setup. The sketch also includes a Watchdog / Reset function to make sure the Arduino stays connected and/or regains connectivity after a network outage. Use the Serial Monitor on the Arduino IDE to see verbose network feedback and ThingSpeak connectivity status. Getting Started with ThingSpeak:   * Sign Up for New User Account - https://thingspeak.com/users/new   * Create a new Channel by selecting Channels and then Create New Channel   * Enter the Write API Key in this sketch under 'ThingSpeak Settings' Arduino Requirements:   * Arduino with Ethernet Shield or Arduino Ethernet   * Arduino 1.0+ IDE  Network Requirements:   * Ethernet port on Router   * DHCP enabled on Router   * Unique MAC Address for Arduino Created: October 17, 2011 by Hans Scharler (http://www.nothans.com) Additional Credits: Example sketches from Arduino team, Ethernet by Adrian McEwen MQ2 grafted from https://github.com/iot-playground/Arduino/blob/master/external_libraries/MySensors/examples/AirQualitySensor/AirQualitySensor.ino By R. Humpleby (2015)// MQ2 ADDITIONS START/************************Hardware Related Macros************************************/  #define MQ_PIN              (0)     //define which analog input channel you are going to use  #define RL_VALUE            (5)     //define the load resistance on the board, in kilo ohms  #define RO_CLEAN_AIR_FACTOR (9.83)  //RO_CLEAR_AIR_FACTOR=(Sensor resistance in clean air)/RO,                                      //which is derived from the chart in datasheet/***********************Software Related Macros************************************/  #define CALIBARAION_SAMPLE_TIMES    (40)  // was 50   //define how many samples you are going to take in the calibration phase  #define CALIBRATION_SAMPLE_INTERVAL (400) // was 500  //define the time interal(in milisecond) between each samples in the                                            //cablibration phase  #define READ_SAMPLE_INTERVAL        (25)  // was 50   //define how many samples you are going to take in normal operation  #define READ_SAMPLE_TIMES           (5)   //define the time interal(in milisecond) between each samples in                                            //normal operation/**********************Application Related Macros**********************************/  #define GAS_LPG    (0)  #define GAS_CO     (1)  #define GAS_SMOKE  (2)/*****************************Globals***********************************************/float LPGCurve[3] = {2.3,0.21,-0.47};   //two points are taken from the curve.                                        //with these two points, a line is formed which is 'approximately equivalent'                                        //to the original curve.                                        //data format:{ x, y, slope}; point1: (lg200, 0.21), point2: (lg10000, -0.59)float COCurve[3]  =  {2.3,0.72,-0.34};  //two points are taken from the curve.                                        //with these two points, a line is formed which is 'approximately equivalent'                                        //to the original curve.                                        //data format:{ x, y, slope}; point1: (lg200, 0.72), point2: (lg10000,  0.15)float SmokeCurve[3] ={2.3,0.53,-0.44};  //two points are taken from the curve.                                        //with these two points, a line is formed which is 'approximately equivalent'                                        //to the original curve.                                        //data format:{ x, y, slope}; point1: (lg200, 0.53), point2: (lg10000,  -0.22)  float Ro =  10;                       //Ro is initialized to 10 kilo ohms  float LPG = 0;  float CO = 0;  float SMOKE = 0;// MQ2 ADDITIONS END  #include  #include// Local Network Settings  byte mac[] = { 0xDA, 0x28, 0xB2, 0xFF, 0xA0, 0xA1 }; // Must be unique on local network// ThingSpeak Settings  char thingSpeakAddress[] = 'api.thingspeak.com';  String writeAPIKey = 'xxxxxxxxxxxxxxxxxxxxxx';  const int updateThingSpeakInterval = 15 * 1000;      // Time interval in milliseconds to update ThingSpeak (number of seconds * 1000 = interval)// Variable Setup  long lastConnectionTime = 0;  boolean lastConnected = false;  int failedCounter = 0;  float AV = 0;// Initialize Arduino Ethernet Client    EthernetClient client;    void setup()  {// Start Serial for debugging on the Serial Monitor  Serial.begin(9600);// Start Ethernet on Arduino  startEthernet();  }    void loop()  {// Read value from Analog Input Pin 1  AV = analogRead(A1);  AV = AV / 100; // get true decimal value  String analogValue0 = String((AV), DEC);  // String analogValue0 = String(analogRead(A1), DEC); // original code// MQ2 ADDITIONS START  // Serial.print('LPG:');  // Serial.print(MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_LPG) );   char lpg2_buffer[10];   float lpg2 = (MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_LPG) );   String LPGONE=dtostrf(lpg2,0,5,lpg2_buffer);  // Serial.print( 'ppm' );  // Serial.print('    ');  // Serial.print('CO:');  // Serial.print(MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_CO) );   char co_buffer[10];   float co = (MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_CO) );   String COTWO=dtostrf(co,0,5,co_buffer);  // CO = (MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_CO) );  // String CO2 = String(MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_CO), DEC);  // Serial.print( 'ppm' );  // Serial.print('    ');  // Serial.print('SMOKE:');  // Serial.print(MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_SMOKE) );   char smoke_buffer[10];   float smoke = (MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_SMOKE) );   String SMOKEY=dtostrf(smoke,0,5,smoke_buffer);  // SMOKE = (MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_SMOKE) );  // String SMOKE3 = String(MQGetGasPercentage(MQRead(MQ_PIN)/Ro,GAS_SMOKE), DEC);  // Serial.print( 'ppm' );  // Serial.print('');  // delay(200);  // Original code not req. here  // MQ2 ADDITIONS END// Print Update Response to Serial Monitor  if (client.available())  {    char c = client.read();    Serial.print(c);  }// Disconnect from ThingSpeak  if (!client.connected() && lastConnected)  {    Serial.println('...disconnected');    Serial.println();    client.stop();  }// Update ThingSpeak  if(!client.connected() && (millis() - lastConnectionTime > updateThingSpeakInterval))  {    updateThingSpeak('field1='+analogValue0+'&field2='+LPGONE+'&field3='+COTWO+'&field4='+SMOKEY);  }  // Check if Arduino Ethernet needs to be restarted  if (failedCounter > 3 ) {startEthernet();}  lastConnected = client.connected();  }    void updateThingSpeak(String tsData)  {  if (client.connect(thingSpeakAddress, 80))  {    client.print('POST /update HTTP/1.1');    client.print('Host: api.thingspeak.com');    client.print('Connection: close');    client.print('X-THINGSPEAKAPIKEY: '+writeAPIKey+'');    client.print('Content-Type: application/x-www-form-urlencoded');    client.print('Content-Length: ');    client.print(tsData.length());    client.print('');    client.print(tsData);    lastConnectionTime = millis();    if (client.connected())    {      Serial.println('Connecting to ThingSpeak...');      Serial.println();      failedCounter = 0;    }    else    {      failedCounter++;      Serial.println('Connection to ThingSpeak failed ('+String(failedCounter, DEC)+')');      Serial.println();    }  }  else  {    failedCounter++;    Serial.println('Connection to ThingSpeak Failed ('+String(failedCounter, DEC)+')');    Serial.println();    lastConnectionTime = millis();  }  }    void startEthernet()  {  client.stop();  Serial.println('Connecting Arduino to network...');  Serial.println();  delay(900); // was 1000// Connect to network amd obtain an IP address using DHCP  if (Ethernet.begin(mac) == 0)  {    Serial.println('DHCP Failed, reset Arduino to try again');    Serial.println();  }  else  {    Serial.println('Arduino connected to network using DHCP');    Serial.println();  }    delay(900); // was 1000  }// MQ2 ADDITIONS START/****************** MQResistanceCalculation ****************************************Input:   raw_adc - raw value read from adc, which represents the voltageOutput:  the calculated sensor resistanceRemarks: The sensor and the load resistor forms a voltage divider. Given the voltage         across the load resistor and its resistance, the resistance of the sensor         could be derived.************************************************************************************/  float MQResistanceCalculation(int raw_adc)  {    return ( ((float)RL_VALUE*(1023-raw_adc)/raw_adc));  }/***************************** MQCalibration ****************************************Input:   mq_pin - analog channelOutput:  Ro of the sensorRemarks: This function assumes that the sensor is in clean air. It use         MQResistanceCalculation to calculates the sensor resistance in clean air         and then divides it with RO_CLEAN_AIR_FACTOR. RO_CLEAN_AIR_FACTOR is about         10, which differs slightly between different sensors.************************************************************************************/  float MQCalibration(int mq_pin)  {  int i;  float val=0;  for (i=0;i<CALIBARAION_SAMPLE_TIMES;i++) {            //take multiple samples    val += MQResistanceCalculation(analogRead(mq_pin));    delay(CALIBRATION_SAMPLE_INTERVAL);  }    val = val/CALIBARAION_SAMPLE_TIMES;                   //calculate the average value    val = val/RO_CLEAN_AIR_FACTOR;                        //divided by RO_CLEAN_AIR_FACTOR yields the Ro                                                          //according to the chart in the datasheet    return val;  }/*****************************  MQRead *********************************************Input:   mq_pin - analog channelOutput:  Rs of the sensorRemarks: This function use MQResistanceCalculation to caculate the sensor resistenc (Rs).         The Rs changes as the sensor is in the different consentration of the target         gas. The sample times and the time interval between samples could be configured         by changing the definition of the macros.************************************************************************************/  float MQRead(int mq_pin)  {    int i;    float rs=0;      for (i=0;i<READ_SAMPLE_TIMES;i++) {      rs += MQResistanceCalculation(analogRead(mq_pin));      delay(READ_SAMPLE_INTERVAL);    }    rs = rs/READ_SAMPLE_TIMES;    return rs;  }/*****************************  MQGetGasPercentage **********************************Input:   rs_ro_ratio - Rs divided by Ro         gas_id      - target gas typeOutput:  ppm of the target gasRemarks: This function passes different curves to the MQGetPercentage function which         calculates the ppm (parts per million) of the target gas.************************************************************************************/  int MQGetGasPercentage(float rs_ro_ratio, int gas_id)  {    if ( gas_id == GAS_LPG ) {       return MQGetPercentage(rs_ro_ratio,LPGCurve);    } else if ( gas_id == GAS_CO ) {       return MQGetPercentage(rs_ro_ratio,COCurve);    } else if ( gas_id == GAS_SMOKE ) {       return MQGetPercentage(rs_ro_ratio,SmokeCurve);    }    return 0;  }/*****************************  MQGetPercentage **********************************Input:   rs_ro_ratio - Rs divided by Ro         pcurve      - pointer to the curve of the target gasOutput:  ppm of the target gasRemarks: By using the slope and a point of the line. The x(logarithmic value of ppm)         of the line could be derived if y(rs_ro_ratio) is provided. As it is a         logarithmic coordinate, power of 10 is used to convert the result to non-logarithmic         value.************************************************************************************/  int  MQGetPercentage(float rs_ro_ratio, float *pcurve)  {    return (pow(10,( ((log(rs_ro_ratio)-pcurve[1])/pcurve[2]) + pcurve[0])));  }// MQ2 ADDITIONS END", "num_user_post": " 19", "author": "BSB"}]}]}