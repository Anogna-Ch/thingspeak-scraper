{"url": "https://community.thingspeak.com/forum/thingspeak-api/page-9/", "threads": [{"url": "https://community.thingspeak.com/forum/thingspeak-api/bulk-upload-not-working-with-static-ip/", "posts": [{"date": "January 30, 2018 - 1:29 pm", "content": "I can get the bulk upload to work fully when connecting to the wifi 'the normal way' (with only SSID and password) but when I try and use static IP instead I do get connection to wifi, but I do not get a client.connect true anymore so cant upload to Thingspeak. Anyone that got it to work and might be able to help. Have used the same code for connecting to wifi with 'normal' upload without problem. Thanks in advance.The code (removed connection data and channel no and key):Reveal Spoiler/* This example shows how to bulk update a ThingSpeak channel using an Arduino MKR1000 or an ESP8266*///#include<Ethee3ernetClient.h> //Uncomment this library to work with ESP8266#include<ESP8266WiFi.h> //Uncomment this library to work with ESP8266char jsonBuffer[2500] = '['; // Initialize the jsonBuffer to hold datachar ssid[] = ''; // Your network SSID (name)char pass[] = ''; // Your network passwordWiFiClient client; // Initialize the WiFi client librarychar server[] = 'api.thingspeak.com'; // ThingSpeak Server/* Collect data once every 15 seconds and post data to ThingSpeak channel once every 2 minutes */unsigned long lastConnectionTime = 0; // Track the last connection timeunsigned long lastUpdateTime = 0; // Track the last update time//const unsigned long postingInterval = 60L * 1000L; // Post data every 1 minutes//const unsigned long updateInterval = 15L * 1000L; // Update once every 15 seconds\u00a0IPAddress ip(192, 168, 1, 159); // Original with SHT31IPAddress gateway(); // Removed to post to forumIPAddress subnet();IPAddress dns1();IPAddress dns2();byte mac[6]; // the MAC address of wemosuint8_t router_mac[6] = { }; // Your router's wifi mac addressuint8_t router_channel = 10; // Your router's wifi channel\u00a0void setup() { Serial.begin(115200); //connectwifi(); // Works connectstatic(); // does not work}\u00a0void connectwifi(){ // Attempt to connect to WiFi network while (WiFi.status() != WL_CONNECTED) { Serial.print('Attempting to connect to SSID: '); Serial.println(ssid); WiFi.begin(ssid, pass); // Connect to WPA/WPA2 network. Change this line if using open or WEP network delay(10000); // Wait 10 seconds to connect } Serial.println('Connected to wifi'); printWiFiStatus(); // Print WiFi connection information}void connectstatic(){ // Attempt to connect to WiFi network while (WiFi.status() != WL_CONNECTED) { Serial.print('Attempting to connect to SSID: '); Serial.println(ssid); WiFi.mode(WIFI_STA); WiFi.config(ip, gateway, subnet, dns1, dns2); delay(10); WiFi.begin(ssid, pass, router_channel, router_mac); delay(10000); // Wait 10 seconds to connect } Serial.println('Connected to wifi'); printWiFiStatus(); // Print WiFi connection information}void loop() { updatesJson(jsonBuffer); for (int i = 0; i <= 120 ; i++) { // la in f\u00f6r annars kommer det f\u00f6r t\u00e4tt. l\u00f6ses automatiskt senare med deep sleep delay(500); }}// Updates the jsonBuffer with datavoid updatesJson(char* jsonBuffer){ /* JSON format for updates paramter in the API * This example uses the relative timestamp as it uses the 'delta_t'. If your device has a real-time clock, you can provide the absolute timestamp using the 'created_at' parameter * instead of 'delta_t'. * '[{'delta_t':0,'field1':-70},{'delta_t':15,'field1':-66}]' */ // Format the jsonBuffer as noted aboveSerial.print('Start build json'); Serial.println(millis());for (int i = 0; i <= 31 ; i++) { strcat(jsonBuffer,'{'delta_t':'); // Starta en rad i jsonBuffer unsigned long deltaT = 20; // ber\u00e4kna deltaT size_t lengthT = String(deltaT).length(); // ber\u00e4kna l\u00e4ngden p\u00e5 deltaT char temp[4]; // skapa parameter temp String(deltaT).toCharArray(temp,lengthT+1); // g\u00f6r om deltaT till String och till temp strcat(jsonBuffer,temp); // l\u00e4gg in str\u00e4ngen temp i jsonBuffer strcat(jsonBuffer,','); // l\u00e4gga in , i jsonBuffer long rssi = i; // skapa parameter rssi strcat(jsonBuffer, ''field1':'); // l\u00e4gg in prefix f\u00f6r f\u00f6rsta parametern lengthT = String(rssi).length(); // Ta reda p\u00e5 l\u00e4ngden p\u00e5 parameter 1 String(rssi).toCharArray(temp,lengthT+1); // g\u00f6r om till str\u00e4ng och in i temp strcat(jsonBuffer,temp); // in i json strcat(jsonBuffer,'},'); // avsluta den delen//Serial.print('json: '); //Serial.println(jsonBuffer); yield();} size_t len = strlen(jsonBuffer); jsonBuffer[len-1] = ']'; // byter sista , mot ] //Serial.print('Total json: '); //Serial.println(jsonBuffer); Serial.print('length json: '); Serial.println(String(jsonBuffer).length()); httpRequest(jsonBuffer);}// Updates the ThingSpeakchannel with datavoid httpRequest(char* jsonBuffer) { /* JSON format for data buffer in the API * This example uses the relative timestamp as it uses the 'delta_t'. If your device has a real-time clock, you can also provide the absolute timestamp using the 'created_at' parameter * instead of 'delta_t'. * '{'write_api_key':'YOUR-CHANNEL-WRITEAPIKEY','updates':[{'delta_t':0,'field1':-60},{'delta_t':15,'field1':200},{'delta_t':15,'field1':-66}] */ Serial.print('Start send: '); Serial.println(millis()); // Format the data buffer as noted above char data[2500] = '{'write_api_key':'XXX','updates':'; //Replace YOUR-CHANNEL-WRITEAPIKEY with your ThingSpeak channel write API key strcat(data,jsonBuffer); strcat(data,'}'); // Close any connection before sending a new request client.stop(); String data_length = String(strlen(data)+1); //Compute the data buffer length // POST data to ThingSpeak if (client.connect(server, 80)) { client.println('POST /channels/YOUR-CHANNEL-ID/bulk_update.json HTTP/1.1'); //Replace YOUR-CHANNEL-ID with your ThingSpeak channel ID client.println('Host: api.thingspeak.com'); client.println('User-Agent: mw.doc.bulk-update (Arduino ESP8266)'); client.println('Connection: close'); client.println('Content-Type: application/json'); client.println('Content-Length: '+data_length); client.println(); client.println(data); } else { Serial.println('Failure: Failed to connect to ThingSpeak'); } delay(250); //Wait to receive the response client.parseFloat(); String resp = String(client.parseInt()); Serial.println('Response code:'+resp); // Print the response code. 202 indicates that the server has accepted the response jsonBuffer[0] = '['; // Reinitialize the jsonBuffer for next batch of data jsonBuffer[1] = '0'; lastConnectionTime = millis(); // Update the last connection time Serial.print('End send: '); Serial.println(lastConnectionTime);}void printWiFiStatus() { // Print the SSID of the network you're attached to: Serial.print('SSID: '); Serial.println(WiFi.SSID());// Print your device IP address: IPAddress ip = WiFi.localIP(); Serial.print('IP Address: '); Serial.println(ip);// Print the received signal strength: long rssi = WiFi.RSSI(); Serial.print('signal strength (RSSI):'); Serial.print(rssi); Serial.println(' dBm');}", "num_user_post": " 1", "author": "Makeorbrake"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/not-able-to-subscribe-to-a-mqtt-topic-from-arduino/", "posts": [{"date": "January 29, 2018 - 4:19 am", "content": "There is only documentation for publishing to thingspeak from Arduino client using mqtt. Can anyone help me out to subscribe a channel from an Arduino\u00a0client and receive data using mqtt.\u00a0Is it even possible?\u00a0BTW I was able to receive data using the MQTT.fx software.Thanks in advance", "num_user_post": " 11", "author": "Vignesh maker"}, {"date": "January 29, 2018 - 3:53 pm", "content": "Vignesh,Yes, it is possible to subscribe to a ThingSpeak channel using an Arduino.\u00a0 There is an example currently for a MQTT subscribe on particle photon.\u00a0 The photon is very similar to Arduino.\u00a0 If you were able to subscribe with MQTT.fx, you should be almost there.You might consider the pubsub client for your MQTT library.\u00a0 Let me know if this example works for you.", "num_user_post": " 401", "author": "cstapels"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/multiple-ds18b20-on-raspberry-pi/", "posts": [{"date": "January 25, 2018 - 10:43 am", "content": "I have at present 2 (soon to be 3) ds18b20 probes connected to a Pi zero and want to send this data to ThingSpeak using python, I have setup the 2 fields and it will report data to both but both sets of data are the same. How can I get both probes to report the correct information.Both of the data values report correctly in the terminal on my pi when I run the command.\u00a0.py belowMany thanks\u00a0import os \u00a0import glob\u00a0import time \u00a0import sys \u00a0import datetime \u00a0import urllib2 \u00a0\u00a0\u00a0baseURL = 'https://api.thingspeak.com/update?api_key=(MY KEY)&field1=&field2=' \u00a0\u00a0\u00a0os.system('modprobe w1-gpio')os.system('modprobe w1-therm')\u00a0# add more sensor variables here based on your setuptemp_0 = 0temp_1 = 0\u00a0for sensors in range (2): # change number of sensors based on your setup\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 base_dir = '/sys/bus/w1/devices/'\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 device_folder = glob.glob(base_dir + '28*')[sensors]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 device_file = device_folder + '/w1_slave'\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 print device_file\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 print sensors\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 def read_temp_raw(): # gets the temps one by one\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 f = open(device_file, 'r')\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 lines = f.readlines()\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 f.close()\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 return lines\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 def read_temp(): # checks the temp recieved for errors\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 lines = read_temp_raw()\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 while lines[0].strip()[-3:] != 'YES':\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 time.sleep(0.2)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 lines = read_temp_raw()\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 equals_pos = lines[1].find('t=')\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 if equals_pos != -1:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 temp_string = lines[1][equals_pos+2:]\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 # set proper decimal place for C\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 temp = float(temp_string) / 1000.0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 # Round temp to 2 decimal points\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 temp = round(temp, 1)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 return temp\u00a0# ask for temps to be read and store each in a variable\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 if sensors == 0:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 temp_0 = read_temp()\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 \u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 if sensors == 1:\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 temp_1 = read_temp()\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 print temp_0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 print temp_1\u00a0while True: #infinite loop\u00a0\u00a0\u00a0\u00a0\u00a0 temp_0 = read_temp() #get the temp\u00a0\u00a0\u00a0\u00a0\u00a0 values = [datetime.datetime.now(), temp_0]\u00a0\u00a0\u00a0\u00a0\u00a0 temp_1 = read_temp() #get the temp\u00a0\u00a0\u00a0\u00a0\u00a0 values = [datetime.datetime.now(), temp_1]\u00a0\u00a0\u00a0\u00a0\u00a0 g = urllib2.urlopen(baseURL + '&field1=%s&field2=%s' % (temp_0, temp_1))\u00a0\u00a0\u00a0\u00a0\u00a0 time.sleep(60)\u00a0", "num_user_post": " 2", "author": "steveknott"}, {"date": "January 25, 2018 - 10:57 pm", "content": "Maybe posting to the forum messed up the indenting but that code doesnt look right to me.\u00a0 \u00a0The way its come out it looks like you are defining functions read_temp_raw() and read_temp() within the 'for sensors ' loop.\u00a0 Function definitions are usually done once at the top of the program.\u00a0 When you start on the infinite loop the value of the variable 'sensors' will be constant so you read the same temp repeatedly.\u00a0There are existing python modules (https://github.com/timofurrer/w1thermsensor looks like the most popular) to do the hard work of actually reading the sensor but if you want to keep rolling your own I've posted some suggestions for your code at\u00a0https://gist.github.com/rw950431/2b1a632f49e89cb0c3ac6b77433f13fa\u00a0 \u00a0\u00a0(Since the forum seems to be especially unkind to python code)", "num_user_post": " 271", "author": "rw950431"}, {"date": "January 26, 2018 - 4:42 pm", "content": "You may also want to consider removing '&field1=&field2=' from baseURL at definition time, since the statement at the end seems to add it again.\u00a0g = urllib2.urlopen(baseURL + '&field1=%s&field2=%s' % (temp_0, temp_1))", "num_user_post": " 401", "author": "cstapels"}, {"date": "January 27, 2018 - 8:32 am", "content": "Hi,Thank you both for taking the time to reply.This is my first project with python and I don\u2019t understand which part of the timofurrer code I need, my sensors are working locally and also I have them working with Domoticz so I only need to send this data to thingspeak I have read through all the code by timofurrer but can\u2019t see anything about thingspeak which I could use or modify as I\u2019m new to all of this.also the link https://gist.github.com/rw950431/2b1a632f49e89cb0c3ac6b77433f13fa\u00a0 does not work.", "num_user_post": " 2", "author": "steveknott"}, {"date": "January 29, 2018 - 12:25 am", "content": "Apologies, it appears my cut and paste added spurious characters to the end of the URLTry this linkhttps://gist.github.com/rw950431/2b1a632f49e89cb0c3ac6b77433f13fa\u00a0In terms of the library you probably want the multiple sensor example: this replaces all the globbing and string parsing you currently do.from w1thermsensor import W1ThermSensorfor sensor in W1ThermSensor.get_available_sensors():    print('Sensor %s has temperature %.2f' % (sensor.id, sensor.get_temperature()))", "num_user_post": " 271", "author": "rw950431"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/graph-line-with-different-colors-above-and-below-a-certain-value/", "posts": [{"date": "January 25, 2018 - 4:08 am", "content": "Hi,I'm posting weather data to a few channels on ThingSpeak, for example this outdoor temperature:https://thingspeak.com/channels/130083/charts/1?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&type=line\u00a0I know how to change the color for the entire line in the graph, but since this is an outdoor temperature in Norway - where the temperature changes between above and below freezing on a regular basis - it would be really nice to have the graph line have different colors above and below freezing. Specifically, I would like it to be blue below 0 (freezing point on the Centigrade scale) and red above 0.Any ideas how to do that?", "num_user_post": " 5", "author": "uphillbattle"}, {"date": "January 26, 2018 - 12:06 am", "content": "I dont know if any way to modify the thingspeak basic grapsh.\u00a0 If you use a Matlab visualization you can sort your values into 2 series (above and below zero in your case) and plot them on the same graph with different colors.\u00a0\u00a0\u00a0Hopefully someone with matlab skills can give us code for that..", "num_user_post": " 271", "author": "rw950431"}, {"date": "January 26, 2018 - 3:49 pm", "content": "Here is an example MATLAB code snippet to help you get started:% Read data from your channel[data, time] = thingSpeakRead(130083, 'NumPoints', 8000, 'Fields', 1);% Create variables for holding values greater than zero and less than zerodataGtZero = NaN(1, length(data));dataLsZero = NaN(1, length(data));% Assign values to the variables% dataGtZero has all values of data that are greater than zerodataGtZero(data>0) = data(data>0);% dataLsZero has all values of data that are less than zerodataLsZero(data<0) = data(data<0);% Plot both chunks of data and specify color to be blue ('b') for data less than zero and red for the other.plot(time, dataLsZero, 'b');hold on;plot(time, dataGtZero, 'r')", "num_user_post": " 62", "author": "Adarsh_Murthy"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/updating-multiple-channels-from-html/", "posts": [{"date": "December 17, 2017 - 1:44 pm", "content": "I posted this question under 'Arduino' and probably should of placed it here... my bad...Original post viewed here: http://community.thingspeak.com/forum/arduino/thingspeak-multiple-field-updates-from-html/", "num_user_post": " 2", "author": "Stillub"}, {"date": "January 2, 2018 - 3:03 pm", "content": "Stillub said I posted this question under 'Arduino' and probably should of placed it here... my bad...Original post viewed here: http://community.thingspeak.com/forum/arduino/thingspeak-multiple-field-updates-from-html/\u00a0\u00a0I'm not sure if it's my URL or something going on with the ThingSpeak.com servers but I'm not having any success getting consistency.It's quite possible they are working on the servers or there are a number of datastream intensive opertions going on that are slowing down the ThingSpeak server response times.All speculation.\u00a0 But I cannot figure out why my data URLS work fine one moment then not at all the next, and the intervals are all over the place as far as time between data points....like anywhere between 1 minute and several hours even though I am sending update feeds every 60 seconds. \u00a0 I have a gut feeling something's going on with the ThingSpeak server(s) at this time.\u00a0\u00a0\u00a0 Again, could be totally wrong...just a guess based on observation of data.", "num_user_post": " 15", "author": "Piez"}, {"date": "January 2, 2018 - 4:28 pm", "content": "The servers seem pretty steady on channels where I have time controls set up. I see a fluctuation of about 15 seconds for these.\u00a0 There is less variation in the channels I have that are using devices to write, except where they collide with other writes.\u00a0If you have multiple writes to your channels, they might be competing, which will make the posting look intermittent.\u00a0 Check your time controls and analysis scripts.\u00a0 You licence type will tell you how often you can update.\u00a0If you are using the REST interface from an HTML script, reliability may depend on your internet connection. Are you posting from a location with a reliable internet connection?\u00a0\u00a0", "num_user_post": " 401", "author": "cstapels"}, {"date": "January 3, 2018 - 2:23 pm", "content": "cstapels said \u00a0 Check your time controls and analysis scripts.What do you mean by this?Where are these and are they pertinent to GET URLs suppling datapoints via an HTML feed (no Json, XML)", "num_user_post": " 15", "author": "Piez"}, {"date": "January 3, 2018 - 3:35 pm", "content": "I am trying to send two data values to thingspeak value. Please tell me the command through which I can send the two sensor data. The basic code is given below.\u00a0#include <SoftwareSerial.h>/* Create object named SIM900 of the class SoftwareSerial */SoftwareSerial SIM900(8, 7);void setup(){ SIM900.begin(9600); /* Define baud rate for software serial communication */ Serial.begin(9600); /* Define baud rate for serial communication */}void loop() { Serial.println('HTTP post method :'); Serial.print('AT'); SIM900.println('AT'); /* Check Communication */ delay(500); ShowSerialData(); /* Print response on the serial monitor */ delay(500); /* Configure bearer profile 1 */ Serial.print('AT+SAPBR=3,1,'CONTYPE','GPRS''); SIM900.println('AT+SAPBR=3,1,'CONTYPE','GPRS''); /* Connection type GPRS */ delay(500); ShowSerialData(); delay(500); Serial.print('AT+SAPBR=3,1,'APN','airtelgprs.com''); SIM900.println('AT+SAPBR=3,1,'APN','airtelgprs.com''); /* APN of the provider */ delay(500); ShowSerialData(); delay(500); Serial.print('AT+SAPBR=1,1'); SIM900.println('AT+SAPBR=1,1'); /* Open GPRS context */ delay(500); ShowSerialData(); delay(500); Serial.print('AT+SAPBR=2,1'); SIM900.println('AT+SAPBR=2,1'); /* Query the GPRS context */ delay(500); ShowSerialData(); delay(2000); Serial.print('AT+HTTPINIT'); SIM900.println('AT+HTTPINIT'); /* Initialize HTTP service */ delay(2000); ShowSerialData(); delay(500); Serial.print('AT+HTTPPARA='CID',1'); SIM900.println('AT+HTTPPARA='CID',1'); /* Set parameters for HTTP session */ delay(500); ShowSerialData(); delay(500); Serial.print('AT+HTTPPARA='URL','api.thingspeak.com/update''); SIM900.println('AT+HTTPPARA='URL','api.thingspeak.com/update''); /* Set parameters for HTTP session */ delay(500); ShowSerialData(); delay(500); Serial.print('AT+HTTPDATA=33,10000'); SIM900.println('AT+HTTPDATA=33,10000'); /* POST data of size 33 Bytes with maximum latency time of 10seconds for inputting the data*/ delay(200); ShowSerialData(); delay(200); Serial.print('api_key=8MMR5DD7QC42NAUJ&field1=2'); /* Data to be sent */ SIM900.println('api_key=8MMR5DD7QC42NAUJ&field1=2'); delay(500); ShowSerialData(); delay(500); Serial.print('AT+HTTPACTION=1'); SIM900.println('AT+HTTPACTION=1'); /* Start POST session */ delay(1000); ShowSerialData(); delay(2000); Serial.print('AT+HTTPTERM'); SIM900.println('AT+HTTPTERM'); /* Terminate HTTP service */ delay(2000); ShowSerialData(); delay(500); Serial.print('AT+SAPBR=0,1'); SIM900.println('AT+SAPBR=0,1'); /* Close GPRS context */ delay(500); ShowSerialData(); delay(500);}void ShowSerialData(){ while(SIM900.available()!=0) /* If data is available on serial port */ Serial.write(char (SIM900.read())); /* Print character received on to the serial monitor */}", "num_user_post": " 3", "author": "MURLIDHAR ROY"}, {"date": "January 5, 2018 - 1:50 pm", "content": "Piez,You can perform channel updates in MATLAB analysis scripts. (also in visualizations)\u00a0 If you were using a script to update the channel, I would check if the script is doing multiple writes within the update limit.\u00a0 Time controls\u00a0are used to regularly schedule running of code.\u00a0 They\u00a0 can be used to trigger analysis scripts, which could also cause overlapping writes to channels.\u00a0Writing simultaneously to multiple channels can also violate the update rate limitation and lead to missed data.", "num_user_post": " 401", "author": "cstapels"}, {"date": "January 5, 2018 - 2:05 pm", "content": "MURLIDHAR ROY,See\u00a0REST API documentation\u00a0for the appropriate syntax.\u00a0Does the code you provided work to update a single field?\u00a0 If it works as is for one field, add &field2=... to get it to work for 2 fields.\u00a0 \u00a0 If the code doesn't work as is, you may need a '?' before the api key.If you are using a GET operationhttps://api.thingspeak.com/update?api_key=xxxxxxxxxxxxxxxx&field1=0Then continue to append fields with the '&'.https://api.thingspeak.com/update?api_key=xxxxxxxxxxxxxxxx&field1=0&field2=56&field3=123", "num_user_post": " 401", "author": "cstapels"}, {"date": "January 25, 2018 - 10:48 pm", "content": "Perform channel updates in MATLAB analysis scripts and check script if it is doing multiple writes within the update limit..gomovies", "num_user_post": " 2", "author": "royalghost"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/posting-to-a-channel-with-applescript/", "posts": [{"date": "January 24, 2018 - 2:59 pm", "content": "I am unable to update a channel with the following:\u00a0\u00a0 POST https://api.thingspeak.com/update\u00a0 api_key= M5O3LNSMLQG8TWXZ\u00a0 field1=456\u00a0Applescript balks at 'https'. I'm guessing 'POST' isn't in the applescript dictionary. Unfortunately what little skill I have is in applescript.\u00a0Question: \u00a0is it possible to update a channel with applescript? If not, is there a python possibility?", "num_user_post": " 1", "author": "smuseby"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/data-disappears-from-chart-and-database/", "posts": [{"date": "January 19, 2018 - 11:44 am", "content": "I have Matlab code whose output gets written to my ThingSpeak channel (ID =\u00a0 379753) in three separate instances. Instance 1) writes to fields 1,3,4,5; Instance 2) writes to field 6; Instance 3) writes to field 7. It's the data logged in instance 1 that I'm having trouble with.Data gets written successfully but eventually disappears after maybe an hour or two. When I download and view the exported CSV files, it isn't there either. I can't seem to connect the disappearance with any other task being performed by my computer. For instance, it doesn't disappear while writing to the other fields in my channel. Nor does it happen when I call for instance 1 to happen again, because at the moment, I've only got one data point each to write to fields 1,3,4,5; I've called for instance 1 to happen only once.\u00a0While the data remains, I've also noticed that these fields take several moments to show data, something like 10s. Whereas if I refresh my page, all the other fields re-populate almost instantly. Any help with this would be much appreciated.\u00a0", "num_user_post": " 3", "author": "bbruno22"}, {"date": "January 19, 2018 - 11:28 pm", "content": "Hi bbruno22,As your data seems public I downloaded some with:\u00a0api.thingspeak.com/channels/379753/feeds.csv?start=2018-01-19 00:00:00&end=2018-01-19 23:59:59obtainingcreated_at,entry_id,field1,field3,field4,field5,field6,field72018-01-19 00:53:58 UTC,303,,,,,0.01663893511805415,2018-01-19 01:01:39 UTC,323,,,,,,592018-01-19 01:53:58 UTC,304,,,,,0.01668520578309842,2018-01-19 02:05:22 UTC,324,,,,,,592018-01-19 02:53:50 UTC,305,,,,,0.01673640169033585,2018-01-19 03:08:47 UTC,325,,,,,,592018-01-19 03:53:28 UTC,306,,,,,0.008356545955453048,2018-01-19 04:12:03 UTC,326,,,,,,58.989830457627132018-01-19 04:53:30 UTC,307,,,,,0.01668984697099557,2018-01-19 05:15:33 UTC,327,,,,,,58.998611133333332018-01-19 05:53:18 UTC,308,,,,,0.0167061116647121,2018-01-19 06:20:23 UTC,328,,,,,,58.987222166666672018-01-19 06:53:13 UTC,309,,,,,0.08326394677719125,2018-01-19 07:25:25 UTC,329,,,,,,58.982222266666672018-01-19 07:53:24 UTC,310,,,,,0.08375209373545039,2018-01-19 08:29:58 UTC,330,,,,,,592018-01-19 08:52:37 UTC,311,,,,,0.008270158522242643,2018-01-19 09:39:11 UTC,331,,,,,,592018-01-19 09:54:19 UTC,312,,,,,0.01666666666666667,2018-01-19 10:47:19 UTC,332,,,,,,58.990555652018-01-19 10:52:37 UTC,313,,,,,0.01690617074210293,2018-01-19 11:48:29 UTC,333,,,,,,592018-01-19 11:52:37 UTC,314,,,,,0.01666666666666667,2018-01-19 12:48:30 UTC,334,,,,,,58.987222249999992018-01-19 13:48:30 UTC,335,,,,,,592018-01-19 14:28:30 UTC,336,,,,,,59observe entry_id (the order of reception) and created_at (timestamp). These 2 values must be correlated and with the same order ... and they are not. Perhaps that is the problem, I think you are having troubles sending the timestampsI hope this is some helpp.", "num_user_post": " 91", "author": "piajola"}, {"date": "January 21, 2018 - 11:08 am", "content": "piajola,Much thanks for your reply. It is strange to me that the entry IDs bounce around like that, however, the data that you pulled up is from the charts that I am having no trouble with. I wonder why this entry_id/timestamp issue would cause problems for one chart and not for others. I also don't know how I would troubleshoot this issue. If it helps, here is an example of the code I use to upload the disappearing data to ThingSpeak. The code for the other fields is the same.\u00a0for j = 1:size(events_data,1)\u00a0 \u00a0 \u00a0 \u00a0 thingSpeakURL = 'http://api.thingspeak.com/';\u00a0 \u00a0 \u00a0 \u00a0 thingSpeakWriteURL = [thingSpeakURL 'update'];\u00a0 \u00a0 \u00a0 \u00a0 writeApiKey = 'XKSEKKX7TEKZ2N8E';\u00a0 \u00a0 \u00a0 \u00a0 %fieldName = 'Chart With Multiple Series 1';\u00a0 \u00a0 \u00a0 \u00a0 ChannelID = 379753;\u00a0 \u00a0 \u00a0 \u00a0 fieldvalues = [masses_M(j)];\u00a0 \u00a0 \u00a0 \u00a0 D = datetime(datestr(start_times(j)), 'InputFormat','dd-MMM-yyyy HH:mm:ss');\u00a0 \u00a0 \u00a0 \u00a0 thingSpeakWrite(ChannelID, 'Fields',[1],'Values',fieldvalues,'WriteKey',writeApiKey,'TimeStamp',D)\u00a0 \u00a0 \u00a0 \u00a0 pause(15);\u00a0 \u00a0 end\u00a0Is there anything in the code above which would cause the assignment of random entry ids?Thanks.\u00a0", "num_user_post": " 3", "author": "bbruno22"}, {"date": "January 21, 2018 - 6:34 pm", "content": "I looked at your channel, Anerobic Digester sounds like a fun tracking application for thingSpeak!I used the following rest call to see the data in fields 1,3,4,5:http://api.thingspeak.com/channels/379753/charts/1?results=400http://api.thingspeak.com/channels/379753/charts/3?results=400etc.I would suggest using the 'Data export' tab next to the API keys tab instead of the data export button if you want all the data in the fields.\u00a0 Even better to use REST api calls such ashttps://api.thingspeak.com/channels/CHANNEL_ID/fields/FIELD_ID.csv?days=3There are many other parameters you can use to customize the data returned to you with the rest call. ( i used three days as a parameter in the above, just as an example.)As piojola indicated, different alignment of the entry ID and the time stamps will cause your plots to behave differently, but this is not outside the model of thingSpeak.\u00a0 EntryID is assigned at the time you enter data, and is presently used to order the database entries.\u00a0 So if you have one point entered in 2018 but its time stamp is from 2016, it would probably have a higher entry ID than all your data from 2017, for example.Your data will not disappear once it gets written to a channel, but you may have to adjust some settings to see it.\u00a0 Have you played with the chart parameters?\u00a0 Its a pencil icon on the top of the plot.\u00a0 Try the Results parameter, or Days.\u00a0 These may help you make the chart show what you want more predictably. The delay you are seeing might be due to the alignment of the chart, settings, and data entry.\u00a0If you have two update frequencies for the two sets of fields: it may be easier to use the default display settings if you update two channels separately.\u00a0 It is definitely possible to use one channel, but the alternate updates will put empty entries in the fields of the other updates.\u00a0 This does not change the data, but if you read by the results parameter, you might get a lot of empty entries.\u00a0\u00a0", "num_user_post": " 401", "author": "cstapels"}, {"date": "January 22, 2018 - 9:22 am", "content": "cstaples,\u00a0Thank you for your reply. It is such a relief to see that my data doesn't actually disappear, though strange that it would seem so when using one export button and not another. Unfortunately, the data export button you recommend is not accessible to the public, making downloads by the public restricted to API calls. I was hoping to make downloading very easy, and my target audience is so much more likely to be familiar with CSV files then with calling an API. Alas. I may try to use separate channels for each data stream in hopes that it may help the charts keep my data visible. Thank you.\u00a0", "num_user_post": " 3", "author": "bbruno22"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/sample-visual-basic-code-to-post-http-1-0-put-method-to-thingspeak-channel-small-error/", "posts": [{"date": "January 18, 2018 - 10:11 pm", "content": "Newbie ProgrammerTrying to modify existing code developed many years back for pachube feed to be compatible with Thingspeak upload using Microsoft Visual Basic.It appears to successfully login, as there are no error and the entries denotes transfers taking place, but the data for field5 is not updated. Must be a simple formatting error and would like support from those in the know.Here is my VB codeTryDim PachubeStream As String = '&field5=20''prepare to Upload the latest changed data to pachube (ThingSpeak) for on-line data storage and plottingDim myWebClient As New WebClient()uploaddatapachubekey = 'XXXXXXXXXXXXX'myWebClient.Headers.Add('Content-Type', 'text/csv')' Apply ASCII Encoding to obtain the string as a byte array.Dim byteArray As Byte() = Encoding.ASCII.GetBytes(PachubeStream)'configure uploaddata pachube port urluploaddatapachubeport = 'https://api.thingspeak.com/update?api_key=' + uploaddatapachubekey'UploadData input string using Http 1.0 PUT Method if not in test modeIf TestMode = False Then myWebClient.UploadData(uploaddatapachubeport, 'post', byteArray)'reinitialize data comparitor for next passCatch fail As ExceptionConsole.WriteLine('The process failed: {0}.', fail.ToString())End Try", "num_user_post": " 2", "author": "Metawatch"}, {"date": "January 21, 2018 - 7:08 pm", "content": "Are you sure TestMode=false?\u00a0 That would cause the client to not upload the data.\u00a0 Your formatting of the REST call looks fine.\u00a0 I'm not familiar with your library specifically, but there is usually a data size indicator in the POST command.For example, you can see the steps in this example.\u00a0 I assume your client library takes care of that itself, but I thought I would mention it just in case.\u00a0 Also you might double check the write API key.", "num_user_post": " 401", "author": "cstapels"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/only-last-100-entries-are-collected/", "posts": [{"date": "January 19, 2018 - 7:18 am", "content": "\u00a0Via the arduino and dht22 sensor I am uploading my temperature to thingspeak. The data is shown in the graphs of the applicable fields of my private channel.\u00a0Nevertheless only the last 100 entries are shown and downloading them as a csv file gives the same result. Only\u00a0 the last100 samples are downloaded.The number of results is left empty in channel config.Why do I not obtain the remaining previous samples. Is there something wrong with my channel settings?Any help is appreciated.", "num_user_post": " 1", "author": "edenderest"}, {"date": "January 19, 2018 - 10:28 am", "content": "Use the data export tab to the right of the API Keys tab to get all your channel data, or use a rest call with results set greater than 100.https://api.thingspeak.com/channels/CHANNEL_ID/feeds.json?results=200&api_key=XXXXXXXXXXXXXXXXDon't use the button next to 'Add Visualization', this has the output default of 1 day.", "num_user_post": " 401", "author": "cstapels"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/daily-average-chart-in-new-channel-not-working/", "posts": [{"date": "January 13, 2018 - 8:13 am", "content": "Hello,I imported data into a new channel.Now the daily average chart is not working, there is alway one point visible.But when I change to 12 hours chart it's working.\u00a0daily:https://thingspeak.com/channels/402929/charts/1?average=1440&days=712 hour:https://thingspeak.com/channels/402929/charts/1?average=720&days=7Anyone knows this problem?", "num_user_post": " 2", "author": "stni"}, {"date": "January 15, 2018 - 1:52 pm", "content": "I see 3 points in your daily chart. I'm not sure what you mean by it is not working.Have you considered that the channel may only have data worth 3 days?", "num_user_post": " 225", "author": "Vinod"}, {"date": "January 16, 2018 - 10:34 am", "content": "You can see there is more data on the second chart.But it's not showing the data before 13.1. on the daily chart.\u00a0I imported all data on 13.1. via the csv import function. The newer data is uploaded with thingspeak api.", "num_user_post": " 2", "author": "stni"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/i-dont-understand-how-to-change-the-rate-at-which-data-points-are-added/", "posts": [{"date": "January 1, 2018 - 7:07 pm", "content": "After an extensive Google search and on this forum, I haven't found anything that gives me an idea of how to change the number of data points over a given time period.\u00a0\u00a0 Right now I am getting a data point about every 8 minutes, although inexplicably, it sometimes changes to as many as 1 data point per minute.I have absolutely no clue why it changes or how to try to set it to the rate I want which is 1 data point per minute.Can someone please point me to meaningful documentation on this or explain the steps?\u00a0Thanks!", "num_user_post": " 15", "author": "Piez"}, {"date": "January 1, 2018 - 9:24 pm", "content": "What is updating your channel?\u00a0 Are you using a device or a ThingSpeak app such as MATLAB analysis?Sensor devices can update a channel with HTTP commands or with MQTT protocol. MATLAB can update a channel from the desktop environment.\u00a0 MATLAB analysis can write to a channel in a similar way, generally with thingSpeakRead command.\u00a0 Then you can schedule a time control to complete that action at regular intervals.\u00a0 Is your question related to how many points are displayed in a plot or how many points you have in your channel?\u00a0If you are interested in seeing how a channel updates, try the Getting Started tutorial. It will take you through the whole process step by step.If you are looking for options on the plots, see the create a chart page.\u00a0 The parameters listed there are for HTTP commands, but they match the controls for ThingSpeak plots when you press the pencil icon.\u00a0Let us know if that helps.", "num_user_post": " 401", "author": "cstapels"}, {"date": "January 1, 2018 - 9:35 pm", "content": "cstapels said What is updating your channel?\u00a0 Are you using a device or a ThingSpeak app such as MATLAB analysis? Sensor devices can update a channel with HTTP commands or with MQTT protocol. MATLAB can update a channel from the desktop environment.\u00a0 MATLAB analysis can write to a channel in a similar way, generally with thingSpeakRead command.\u00a0 Then you can schedule a time control to complete that action at regular intervals. \u00a0 Is your question related to how many points are displayed in a plot or how many points you have in your channel?\u00a0 If you are interested in seeing how a channel updates, try the Getting Started tutorial. It will take you through the whole process step by step. If you are looking for options on the plots, see the create a chart page.\u00a0 The parameters listed there are for HTTP commands, but they match the controls for ThingSpeak plots when you press the pencil icon.\u00a0 Let us know if that helps.\u00a0\u00a0Hello and thank you for the reply.I am using a sensor to update my channel via an HTTP Get URL.Does that mean that my local program's delay settings govern how many data points per hour for example are made?\u00a0\u00a0 For example, the Channel willl plot as many points as I send via URL (up to the limit of one data point every 15 seconds?)", "num_user_post": " 15", "author": "Piez"}, {"date": "January 10, 2018 - 10:13 am", "content": "Still haven't figured out how to change the update interval \ud83d\ude41I guess the basic question I need answered is this......Is the interval controlled from MY SIDE (my arduino sketch for example) or from the THINGSPEAK side in the channel settings?", "num_user_post": " 15", "author": "Piez"}, {"date": "January 10, 2018 - 10:23 am", "content": "If you have a free account, you can send data to a ThingSpeak channel up to once every 15 seconds. If you try sending it faster, the request will be rejected. You can send it slower, if you wish, and that would be controlled by your device.If you have a paid license, you can update a channel as fast as once per second enforced on the server side. Again, if you wish to go slower, that would be on your device end.", "num_user_post": " 225", "author": "Vinod"}, {"date": "January 10, 2018 - 11:08 am", "content": "Vinod said  If you have a free account, you can send data to a ThingSpeak channel up to once every 15 seconds. If you try sending it faster, the request will be rejected. You can send it slower, if you wish, and that would be controlled by your device. If you have a paid license, you can update a channel as fast as once per second enforced on the server side. Again, if you wish to go slower, that would be on your device end.\u00a0\u00a0ok,I think you're saying it is controlled from MY side and not by Thingspeak other than free = greater than or equal to one update every 15 seconds and paid you can update as often as every second.So this is to conclude that there is NO CONTROL over the data interval or how it's displayed (other than stated above) while at the ThingSpak website.Thanks", "num_user_post": " 15", "author": "Piez"}, {"date": "January 10, 2018 - 11:12 am", "content": "Are you asking about controlling the rate of storing data to ThingSpeak, or the rate at which the data is refreshed in the charts?My comments above relate to how fast you can send data to ThingSpeak.If your question is about how fast a chart is refreshed, for a free license the chart is updated every 15 seconds. For a paid license, the charts can be configured to update once a second or at a lower rate.", "num_user_post": " 225", "author": "Vinod"}, {"date": "January 10, 2018 - 7:27 pm", "content": "Vinod said  Are you asking about controlling the rate of storing data to ThingSpeak, or the rate at which the data is refreshed in the charts? My comments above relate to how fast you can send data to ThingSpeak. If your question is about how fast a chart is refreshed, for a free license the chart is updated every 15 seconds. For a paid license, the charts can be configured to update once a second or at a lower rate.\u00a0\u00a0You know, those two things both could probably affect the apparent rate.But I'm referring to the time between each data point.\u00a0 Not the refresh rate on ThingSpeakI had set my data rate to 1 data point every 60 seconds, but they were all over the place....1 minute, 2 minutes, 3 minutes all the way up to hours between data points....this being after they6 were all plotted.", "num_user_post": " 15", "author": "Piez"}, {"date": "January 10, 2018 - 8:32 pm", "content": "Piez said  I had set my data rate to 1 data point every 60 seconds, but they were all over the place....1 minute, 2 minutes, 3 minutes all the way up to hours between data points....this being after they6 were all plotted.\u00a0\u00a0I think the quickest way to understand what is going on is to share your code (redact the API keys, please) that is posting data to ThingSpeak. I suspect the way the data is packaged before being sent to ThingSpeak has some subtle bug. If my hunch is right, your device is providing the timestamp of the data (instead of ThingSpeak recording when it received the data and using that for plotting) and the bug is in this section of the code on your device.", "num_user_post": " 225", "author": "Vinod"}, {"date": "January 12, 2018 - 7:28 pm", "content": "Hello Vinod,Thanks for your help and looking at this.Here's the entire sketch.\u00a0\u00a0 If you see anything I would really appreciate your advice \ud83d\ude42/////////////// BEGIN CODE ////////////////#include <DHT.h>#include <DHT_U.h>//#include'dht.h' // Including library for dht#include <DHT.h>;#include<LiquidCrystal.h>;LiquidCrystal lcd(14,15,16,17,18,19);#include<Timer.h>Timer t;#include <SoftwareSerial.h>SoftwareSerial Serial1(2, 3);//#define dht_dpin 12#define DHTPIN 12#define heart 13#define DHTTYPE DHT22 // DHT 22 (AM2302)DHT dht(DHTPIN, DHTTYPE);char *api_key='ABCDEFGHIJK123456'; // Enter your Write API key from ThingSpeakstatic char postUrl[150];float humi;float tem;//int tem,humi;float temConv;float humiConv;void httpGet(String ip, String path, int port=80);void setup(){ lcd.begin(16, 2); lcd.clear(); lcd.print(' Humidity '); lcd.setCursor(0,1); lcd.print(' Measurement '); delay(2000); lcd.clear(); lcd.print('Circuit Digest '); lcd.setCursor(0,1); lcd.print('Welcomes You'); delay(2000); Serial1.begin(115200); Serial.begin(115200); lcd.clear(); lcd.print('WIFI Connecting'); lcd.setCursor(0,1); lcd.print('Please wait....'); Serial.println('Connecting Wifi....');\u00a0connect_wifi('AT',1000); connect_wifi('AT+CWMODE=1',1000); connect_wifi('AT+CIPSTA='192.168.003.57','192.168.003.001','255.255.255.000'',10000); connect_wifi('AT+CWQAP',1000); connect_wifi('AT+RST',5000); connect_wifi('AT+CWJAP='MyWirelessSSID','Password'',10000); Serial.println('Wifi Connected'); lcd.clear(); lcd.print('WIFI Connected.'); pinMode(heart, OUTPUT); delay(2000); t.oscillate(heart, 1000, LOW); t.every(20000, send2server);}void loop(){humi = dht.readHumidity(); tem= dht.readTemperature(); // DHT.read11(DHTPIN); lcd.setCursor(0,0); lcd.print('Humidity: '); //humi=DHT.humidity; lcd.print(humi); // printing Humidity on LCD lcd.print(' % '); lcd.setCursor(0,1); lcd.print('Temperature:'); // tem=DHT.temperature; lcd.print(tem); // Printing temperature on LCD lcd.write(1); lcd.print('C '); delay(2000); t.update();}void send2server(){ char tempStr[8]; char humidStr[8]; temConv=(tem*1.8)+32; //temConv=tem; // temConv=temConv-1.4; //Correction for DHT11-1 temConv=temConv-1.4; //Correction for DHT22-1// Humidity Calibrations if ((humi <= 47) && (humi > 40)) humiConv=humi+1; if ((humi <= 40) && (humi > 39)) humiConv=humi+2; if ((humi <= 39) && (humi > 36)) humiConv=humi+3; if ((humi <= 36) && (humi > 34)) humiConv=humi+4; if (humi <= 34) humiConv=humi+5; dtostrf(temConv, 5, 3, tempStr); dtostrf(humiConv, 5, 3, humidStr); sprintf(postUrl, 'update?api_key=%s&field1=%s&field2=%s',api_key,humidStr,tempStr); httpGet('api.thingspeak.com', postUrl, 80);}//GET https://api.thingspeak.com/update?api_key=ABCDEFGH87654DEF5&field1=0void httpGet(String ip, String path, int port){ int resp; String atHttpGetCmd = 'GET /'+path+' HTTP/1.0'; //String atHttpGetCmd = 'GET /'+path+''; //AT+CIPSTART='TCP','192.168.20.200',80 String atTcpPortConnectCmd = 'AT+CIPSTART='TCP',''+ip+'','+port+''; connect_wifi(atTcpPortConnectCmd,1000); int len = atHttpGetCmd.length(); String atSendCmd = 'AT+CIPSEND='; atSendCmd+=len; connect_wifi(atSendCmd,1000); connect_wifi(atHttpGetCmd,1000);}void connect_wifi(String cmd, int t){ int temp=0,i=0; while(1) { lcd.clear(); lcd.print(cmd); Serial.println(cmd); Serial1.println(cmd); while(Serial1.available()) { if(Serial1.find('OK'))i=8; } delay(t); if(i>5) break; i++; } if(i==8) { Serial.println('OK'); lcd.setCursor(0,1); lcd.print('OK'); } else { Serial.println('Error'); lcd.setCursor(0,1); lcd.print('Error'); }}", "num_user_post": " 15", "author": "Piez"}, {"date": "January 15, 2018 - 1:49 pm", "content": "I think there is a lot going on in this sketch. I would try and simplify the sketch by removing the non-essential aspects and see if you notice the same behavior.Specifically, please remove the LCD related functionality. Also, you are using a delay() function in your sketch in addition to software serial. Because delay() is a blocking function, you may see some non-intuitive effects with soft-serial and your sketch. Take a look at this and there may be tips in there that will improve the reliability of your sketch:https://randomnerdtutorials.com/why-you-shouldnt-always-use-the-arduino-delay-function/", "num_user_post": " 225", "author": "Vinod"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/unable-to-send-data-to-thingspeak-cloud-api/", "posts": [{"date": "January 12, 2018 - 7:14 pm", "content": "Hi All ,\u00a0 i'm writing arduino Code using Arduino Uno and ESP01 Wifi module\u00a0 to sense some data and send it to Thingspeak API but i always got error and TCP connection close . here is my code and response\u00a0// EmonLibrary examples openenergymonitor.org, Licence GNU GPL V3#include 'EmonLib.h' // Include Emon LibraryEnergyMonitor emon1; // Create an instance#include <SoftwareSerial.h> // Code to use SoftwareSerialSoftwareSerial espSerial = SoftwareSerial(2,3); // arduino RX pin=2 arduino TX pin=3 connect the arduino RX pin to esp8266 module TX pin - connect the arduino TX pin to esp8266 module RX pin#include <NewPing.h>#define TRIGGER_PIN 12 // Arduino pin tied to trigger pin on the ultrasonic sensor.#define ECHO_PIN 11 // Arduino pin tied to echo pin on the ultrasonic sensor.#define MAX_DISTANCE 500 // Maximum distance we want to ping for (in centimeters). Maximum sensor distance is rated at 400-500cm.NewPing sonar(TRIGGER_PIN, ECHO_PIN, MAX_DISTANCE); // NewPing setup of pins and maximum distance.String apiKey = 'JWB4K7P94Y5BI0RR'; // replace with your channel's thingspeak WRITE API key//String ssid='NTG-Egypt'; // NTG Wifi network SSID//String password ='P@ssw0rd@Ntg-eg'; // NTG Wifi network password//String ssid='HanyHotspot'; // Mobile Wifi network SSID//String password ='fd8dbe30049d'; // Mobile Wifi network passwordString ssid='TP-LINK_9299B0'; //Home Wifi network SSIDString password ='hggihglsjuhk1'; // Home Wifi network passwordboolean DEBUG=true;double v_amps;double v_watt;double v_tanklevel;//======================================================================== showResponcevoid showResponse(int waitTime){ long t=millis(); char c; while (t+waitTime>millis()){ if (espSerial.available()){ c=espSerial.read(); if (DEBUG) Serial.print(c); } }}//================================================================================ setupvoid setup() { DEBUG=true; // enable debug serial Serial.begin(9600);  espSerial.begin(9600); // enable software serial // Your esp8266 module's speed is probably at 115200. // For this reason the first time set the speed to 115200 or to your esp8266 configured speed // and upload. Then change to 9600 and upload again// espSerial.println('AT+RST'); // Enable this line to reset the module; // showResponse(1000);//espSerial.println('AT+UART_CUR=9600,8,1,0,0'); // Enable this line to set esp8266 serial speed to 9600 bps //showResponse(1000);//espSerial.println('AT+CWMODE=1'); // set esp8266 as client //showResponse(1000);//espSerial.println('AT+CWJAP=''+ssid+'',''+password+'''); // set your home router SSID and password //showResponse(5000);if (DEBUG) Serial.println('Setup completed');emon1.current(2, 60); // Current: input pin, calibration.}//////========================================================================boolean thingSpeakWrite(double amps, double watt , double tanklevel){ String cmd = 'AT+CIPSTART='TCP',''; // TCP connection // cmd += '184.106.153.149'; // api.thingspeak.com cmd +='api.thingspeak.com'; cmd += '',80'; espSerial.println(cmd); showResponse(1000); if (DEBUG) Serial.println(cmd); if(espSerial.find('Error')){ if (DEBUG) Serial.println('AT+CIPSTART error'); return false; } String getStr = 'GET /update?api_key='; // prepare GET string getStr += apiKey; getStr +='&field1='; getStr += String(amps); getStr +='&field2='; getStr += String(watt); getStr +='&field3='; getStr += String(tanklevel); // ... getStr += '';// send data length cmd = 'AT+CIPSEND='; cmd += String(getStr.length()); espSerial.println(cmd); if (DEBUG) Serial.println(cmd); delay(100); if(espSerial.find('>')){ espSerial.print(getStr); if (DEBUG) Serial.print(getStr); } else{ espSerial.println('AT+CIPCLOSE'); // alert user if (DEBUG) Serial.println('AT+CIPCLOSE'); return false; } return true;}////double calcIrms(){ double Irms = emon1.calcIrms(1480); // Calculate Irms only // Serial.print(Irms*220.0); // Apparent power // Serial.print(' '); Serial.println(Irms); // Irmsreturn Irms;}//double calcPower(double i){ double w = (i*220.0); // Apparent power Serial.println(w); return w;}//double measureLevel(double dim1 , double dim2 , String shape,double totalvolume){unsigned int uS = sonar.ping(); // Send ping, get ping time in microseconds (uS).double distance = (uS / US_ROUNDTRIP_CM); // Convert ping time to distance in cm and print result (0 = outside set distance range)double levelvol = distance *dim1*dim2;Serial.println(distance);return levelvol;}void loop(){// setup(); v_amps = calcIrms(); v_watt = calcPower(v_amps); v_tanklevel = measureLevel(1,1,'cube',100);//// // Read sensor values thingSpeakWrite(v_amps,v_watt,v_tanklevel); // Write values to thingspeak// // thingspeak needs 15 sec delay between updates,delay(16000);}", "num_user_post": " 1", "author": "hanytalaat"}, {"date": "January 13, 2018 - 6:30 pm", "content": "You need to enter your WiFi information and UN Comment these lines.....This will (or should) work IF you are using DHCP on your router (most people are).\u00a0 I do NOT use DHCP and assign ALL my network devices a static IP address.// espSerial.println('AT+RST'); // Enable this line to reset the module; // showResponse(1000);//espSerial.println('AT+UART_CUR=9600,8,1,0,0'); // Enable this line to set esp8266 serial speed to 9600 bps //showResponse(1000);//espSerial.println('AT+CWMODE=1'); // set esp8266 as client //showResponse(1000);//espSerial.println('AT+CWJAP=''+ssid+'',''+password+'''); // set your home router SSID and password //showResponse(5000);", "num_user_post": " 15", "author": "Piez"}]}]}