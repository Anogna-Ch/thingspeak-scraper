{"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/page-4/", "threads": [{"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/parameter-timeout_ms_serverresponse-do-not-reflect-actual-system-time/", "posts": [{"date": "November 8, 2017 - 3:53 pm", "content": "Hello guys,I have an application running a Server and a Client together, along with the need to count coins, responding pretty much in real time, which has been a challenge. As we all know the\u00a0server.handleClient()\u00a0function is the bottleneck of the system, having to be instantiated very often under risk of resetting the system by watchdog timer.So, to prevent the system from getting stuck in an overly long loop, I reduced the Timeout of the client function parameter that talks to the cloud, namely the TIMEOUT_MS_SERVERRESPONSE value was reduced from 5,000ms to 1,500ms in the ThingSpeak.h file (C:UsersDocumentsArduinolibrariesThingSpeaksrc).But this seemed have not being reflected in the actual execution of the program, because when surrounding the function below, sometimes due to network issues, it takes a lot of time to get away, much more than the value that I have modified above.Serial.println ('Start-Upload'); ThingSpeak.WriteField ( .... );\u00a0 Serial.println ('Stop-Upload');Perhaps it is needed to perform a correction factor multiplication on that (\u00a0I'm on a module running at 80MHz ).\u00a0Does anybody know hot to fix that ?", "num_user_post": " 1", "author": "andre_teprom"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/reading-back-data-from-thingspeak/", "posts": [{"date": "July 30, 2017 - 8:15 am", "content": "\u00a0Hi All.I have set up \u00a0a Thingspeak channel with the purpose of logging how many times a tweet hashtag is used. This is OK.I have also set up a ThingHTTP with a TweetControl to do the above and log it to field 1 of the channel. This is OK. I make a Tweet and the number of events increases. I can also achieve the same by using the ThingHTTP code in a browser too. All happy.I have also set up another ThingHTTP to read just the entry_id of the channel to obtain just the number of events. I'm not interested in what else is in the tweet just the number of times the hashtag is utilised at an event I will be running. This works OK.I can use the Get command give from the last ThingHTTP in a browser and it gives me on the page just the number of events. Great.I have also found some code to GET the ThingHTTP data from the channel into the serial of my ESP8266.\u00a0But. What the serial shows is a load of preceding information before the actual event_id info I'm after. I only what the event_id number with which I can then use to activate some lights or something. Not sure what at the moment but something eye catching!The information on the serial is this:Connecting to api.thingspeak.comRequesting URL: api.thingspeak.com/apps/thinghttp/send_request?api_key=XXXXXXXXXXXXXXTRY: 2.HTTP/1.1 200 OKContent-Type: text/html; charset=utf-8Content-Length: 1Connection: closeStatus: 200 OKETag: 'eccbc87e4b5ce2fe28308fd9f2a7baf3'Cache-Control: max-age=0, private, must-revalidateX-Request-Id: 6fb2b657-ab0a-4d4d-a63b-bf5515d7c827X-Runtime: 0.272793X-Powered-By: Phusion Passenger 4.0.57Date: Sun, 30 Jul 2017 12:09:09 GMTServer: nginx/1.9.3 + Phusion Passenger 4.0.57\u00a03\u00a0It is just the number 3 at the end that I want. How do I do this? I've been looking around for hours but have not found anything that can help that I can understand. Any help would be appreciated.The code I have to GET is this:// We now create a URI for the request String url = '/apps/thinghttp/send_request?api_key=XXXXXXXXXXXXX'; Serial.print('Requesting URL: '); Serial.println(host + url); Serial.println(String('TRY: ') + value + '.'); // This will send the request to the server Client.print(String('GET ') + url + '&headers=false' + ' HTTP/1.1' + 'Host: ' + host + '' + 'Connection: close'); delay(500);\u00a0// Read all the lines of the reply from server and print them to Serial while(Client.available()){ String line = Client.readStringUntil(''); Serial.println(line); }", "num_user_post": " 3", "author": "astrotutor"}, {"date": "July 31, 2017 - 6:37 am", "content": "Unfortunately, as you have found, the Arduino web client lacks many of the sophisticated features of more advanced programming environments so you are left to deal with the raw strings by yourself.\u00a0If you are certain that the line you want is the only one that starts with a number then the procedure isnt too hard.\u00a0\u00a0while(Client.available()){ String line = Client.readStringUntil(' ');\u00a0 if ( line.charAt(0)>='0' and line.charAt(0)<='9') { \u00a0 \u00a0 Serial.println(line);\u00a0 };};See https://www.arduino.cc/en/Reference/StringObject particularly https://www.arduino.cc/en/Tutorial/StringCharactersYou may also wish to convert your string to a useable number instead - see https://www.arduino.cc/en/Reference/StringToInt", "num_user_post": " 271", "author": "rw950431"}, {"date": "August 1, 2017 - 8:48 am", "content": "Hi rw950431Thanks for the info. The result it gives is as below. I'm thinking is the answer to get the length of the string and read the last characters backwards until a blank space is reached? It's odd that a web browser only prints the 3 at the bottom that is the entry_id and nothing else.Connecting to api.thingspeak.comRequesting URL: api.thingspeak.com/apps/thinghttp/send_request?api_key=xxxxxxxxxxxxxxTRY: 2.2001Connection:2000.035260X-Powered-By:4.0.57Date:01201712:43:374.0.573Try nr. 2 is finished.Waiting for next try...", "num_user_post": " 3", "author": "astrotutor"}, {"date": "August 2, 2017 - 3:08 am", "content": "Not sure why its doing that. \u00a0Are you sure your code is reading the complete line and not just one character at a time? \u00a0(Maybe you need readStringUtil('') \u00a0instead).", "num_user_post": " 271", "author": "rw950431"}, {"date": "August 3, 2017 - 4:19 am", "content": "Thanks for the help but I found this video:which demonstrated an Example from Arduino which does exactly what I want. I have also now managed to convert the result from a string to an integer. So hopefully I can now get the code to do something more interesting with the result than just multiply it./** * BasicHTTPClient.ino * * Created on: 24.05.2015 * */#include <Arduino.h>#include <ESP8266WiFi.h>#include <ESP8266WiFiMulti.h>#include <ESP8266HTTPClient.h>#define USE_SERIAL SerialESP8266WiFiMulti WiFiMulti;void setup() {USE_SERIAL.begin(115200); // USE_SERIAL.setDebugOutput(true);USE_SERIAL.println(); USE_SERIAL.println(); USE_SERIAL.println();for(uint8_t t = 4; t > 0; t--) { USE_SERIAL.printf('[SETUP] WAIT %d...', t); USE_SERIAL.flush(); delay(1000); }WiFiMulti.addAP('ssis', 'password');}void loop() { // wait for WiFi connection if((WiFiMulti.run() == WL_CONNECTED)) {HTTPClient http;USE_SERIAL.print('[HTTP] begin...'); // configure traged server and url // get the entry_id from Thingspeak from the ThingHTTP TweetControl http.begin('api.thingspeak.com', 80, '/apps/thinghttp/send_request?api_key=XXXXXXXXXXXXXXX'); //HTTPUSE_SERIAL.print('[HTTP] GET...'); // start connection and send HTTP header int httpCode = http.GET();// httpCode will be negative on error if(httpCode > 0) { // HTTP header has been send and Server response header has been handled USE_SERIAL.printf('[HTTP] GET... code: %d', httpCode);// file found at server if(httpCode == HTTP_CODE_OK) { String payload = http.getString(); // Print the string value from Thingspeak USE_SERIAL.println(payload); // Convert string to integer so that we can utilise the number int number_tweets = payload.toInt(); USE_SERIAL.println(2*number_tweets); } } else { USE_SERIAL.printf('[HTTP] GET... failed, error: %s', http.errorToString(httpCode).c_str()); }http.end(); }delay(10000);}", "num_user_post": " 3", "author": "astrotutor"}, {"date": "October 30, 2017 - 5:48 am", "content": "Dear Friends,I have tried the above code and the output value is getting printed on the serial monitor from thingspeak. Please help me to display the value on the LED Matrix display with max7219 and fonts.h libraries.Thanks in adavnce.", "num_user_post": " 2", "author": "2SEAN2"}, {"date": "October 30, 2017 - 2:29 pm", "content": "Hi 2SEAN2,From Andreas Spiess in video #86 MAX7219 Dot Matrix Display, Thingspeak, ESP8266 ...and read the description and commentsI think there is enough info for your cause\u00a0Good luck", "num_user_post": " 91", "author": "piajola"}, {"date": "October 31, 2017 - 2:40 am", "content": "Thanks for the quick response\u00a0piajola.Will check the same and update.\u00a0Thanks again.", "num_user_post": " 2", "author": "2SEAN2"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/how-to-read-data/", "posts": [{"date": "October 26, 2017 - 5:43 pm", "content": "Hi to All, I'm new and I'm sorry if I'm not in the right place.Thare is any simple exampleHow to read data from my chanel-field1With ESP8266 NodMcu to serial monitor in IDE?\u00a0Thanks a lot.", "num_user_post": " 2", "author": "Moshe055"}, {"date": "October 27, 2017 - 10:10 am", "content": "See the examples page in the documentation.\u00a0 There is one example using the ThingSpeak communication library to read a thermistor and output the temperature.\u00a0 It also shows how to read data from a channel in the form of calibration parameters.\u00a0The moisture monitor example shows you how to write to a channel without using the library.\u00a0 You can modify the command to write into a read command using the API commands for getting field information from a channel.\u00a0Or for getting all the channel feed info.", "num_user_post": " 401", "author": "cstapels"}, {"date": "October 29, 2017 - 10:06 am", "content": "Thank you very much.I'll try and report results.", "num_user_post": " 2", "author": "Moshe055"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/esp-8266-node-mcu-and-dht-11-to-thingspeak-problems/", "posts": [{"date": "October 20, 2017 - 5:46 am", "content": "Dear friends I am new at thingspeak, and have problems to program and work with thingspeak, please could you help me? bellow is the program, the program may be wrong ?\u00a0//Include da lib de Wifi do ESP8266#include 'ESP8266WiFi.h'//Include da lib do sensor DHT11 e DHT22#include 'DHT.h'//Define do pino a ser utilizado no ESP para o sensor = GPIO4#define DHT_DATA_PIN 2#define DHTTYPE DHT11//Definir o SSID da rede WiFiconst char* ssid = 'Multilaser_2.4G_2FC158';//Definir a senha da rede WiFiconst char* password = '96243911';//Colocar a API Key para escrita neste campo//Ela \u00e9 fornecida no canal que foi criado na aba API KeysString apiKey = '***********************';const char* server = 'api.thingspeak.com';DHT dht(DHT_DATA_PIN, DHTTYPE);WiFiClient client;void setup() { //Configura\u00e7\u00e3o da UART Serial.begin(9600); //Inicia o WiFi WiFi.begin(ssid, password); //Espera a conex\u00e3o no router while (WiFi.status() != WL_CONNECTED) { delay(500); Serial.print('.'); } dht.begin(); //Logs na porta serial Serial.println(''); Serial.print('Conectado na rede '); Serial.println(ssid); Serial.print('IP: '); Serial.println(WiFi.localIP());}void loop() { //Espera 20 segundos para fazer a leitura delay(20000); //Leitura de umidade float umidade = dht.readHumidity(); //Leitura de temperatura float temperatura = dht.readTemperature(); //Se n\u00e3o for um numero retorna erro de leitura if (isnan(umidade) || isnan(temperatura)) { Serial.println('Erro ao ler o sensor!'); return; } //Inicia um client TCP para o envio dos dados if (client.connect(server,80)) { String postStr = apiKey; postStr +='&amp;field1='; postStr += String(temperatura); postStr +='&amp;field2='; postStr += String(umidade); postStr += ''; client.print('POST /update HTTP/1.1'); client.print('Host: api.thingspeak.com'); client.print('Connection: close'); client.print('X-THINGSPEAKAPIKEY: '+apiKey+''); client.print('Content-Type: application/x-www-form-urlencoded'); client.print('Content-Length: '); client.print(postStr.length()); client.print(''); client.print(postStr); //Logs na porta serial Serial.print('Temperatura: '); Serial.print(temperatura); Serial.print(' Umidade: '); Serial.println(umidade); } client.stop();}", "num_user_post": " 1", "author": "npctecnologia@gmail.com"}, {"date": "October 24, 2017 - 3:47 pm", "content": "Welcome to ThingSpeak!\u00a0 What responses are you getting from the server on the serial monitor?Also, I would make sure you can update your channel manually, using the command format for update a channel field.https://api.thingspeak.com/update?api_key=XXXXXXXXXXXXXXXX&field1=1230You can enter the format above in your browser address bar, use your channel write API key on place of XXXX...(not the user API key or the read API Key).", "num_user_post": " 401", "author": "cstapels"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/coding-how/", "posts": [{"date": "October 12, 2017 - 8:11 am", "content": "HI Guys,\u00a0I'm new\u00a0 user of Thingspeak and have some difficulty to send data from ESP8266 NodeMCU with Arduino IDE..I don't know how to add the right code to The\u00a0 sketch below for sending the data to thingspeak.Is there anybody to help me ??Thanks in advance for your reply\u00a0Gilles\u00a0*/// lowest and highest sensor readings:const int sensorMin = 0; // sensor minimumconst int sensorMax = 1024; // sensor maximumvoid setup() { // initialize serial communication @ 9600 baud: Serial.begin(9600);}void loop() { // read the sensor on analog A0: int sensorReading = analogRead(A0); // map the sensor range (Six options): // ex: 'long int map(long int, long int, long int, long int, long int)' int range = map(sensorReading, sensorMin, sensorMax, 0, 5); // range value: switch (range) { case 0: // Sensor getting wet Serial.println('Forte pluie'); break; case 1: // Sensor getting wet Serial.println('Pluie'); break; case 2: // Sensor getting wet Serial.println('Pluie faible'); break; case 3: // Sensor getting wet Serial.println('Brumeux'); break; case 4: // Sensor getting wet Serial.println('Humide'); break; case 5: // Sensor dry - To shut this up delete the ' Serial.println('Sec'); ' below. Serial.println('Sec'); break; } delay(1); // delay between reads}", "num_user_post": " 6", "author": "gillesroszak"}, {"date": "October 12, 2017 - 5:37 pm", "content": "Gilles,There are several new examples available at ThingSpeak, just posted. There is a temperature example that uses the ThingSpeak Library to handle the HTTP stuff.There is a moisture sensor example that uses an ESP8266-12 to post a voltage reading to a ThingSpeak channel.\u00a0 This one does not use the communication library and does use deep sleep between readings.\u00a0\u00a0There are some differences depending on what version of the ESP8266 you have, let me know if you have trouble.", "num_user_post": " 401", "author": "cstapels"}, {"date": "October 14, 2017 - 8:03 am", "content": "Here is what works for me:\u00a0#include <Esp.h>#include <user_interface.h>#include 'display.h'#include 'button.h'#include 'onewire.h'#include <ESP8266WiFi.h>\u00a0// boot log - connect putty to com port at 74880 baud to see boot log// Thermostat GPIO pin defines// pins to avoid GPIO0 (D3), GPIO2(D4), GPIO15(D8)\u00a0#define DS18B20 2 // D4 on mini = GPIO2 on ESP8266#define SCL 12 // D6 on mini = GPIO12 on ESP8266#define SDA 13 // D7 on mini = GPIO13 on ESP8266#define BUTTON 14 // D5 on mini = GPIO14 on ESP8266#define TIMEOUT 500 // 5 seconds// ------------- wifi and http defines --------------------#define ssid 'xxxxx'#define password 'xxxxx'#define THINGSPEAKIP '184.106.153.149' // thingspeak.com#define host 'api.thingspeak.com'uint32_t RTC_Memory[10];int Current_Temperature, Current_Setpoint;struct rst_info *Reset_Info; // first int32 is the reason 5 = reset button, 6 = deep sleepint SleepTime = TIMEOUT;bool Temp_displayed = false;bool Show_Setpoint_or_Temperature = false; // Setpoint = false, Temperature = trueString httpstring;String ThingSpeak = 'GET http://api.thingspeak.com/update?api_key=VPTOJBWMJSADEDO806RQM&field1=';\u00a0void setup(){ Serial.begin(9600); pinMode(SCL, OUTPUT); pinMode(SDA, OUTPUT); pinMode(DS18B20, OUTPUT); pinMode(BUTTON, INPUT_PULLUP); digitalWrite(BUILTIN_LED, HIGH); // make sure the LED is off Reset_Info = ESP.getResetInfoPtr(); Serial.print('System Reset Reason: '); Serial.print(Reset_Info->reason); Serial.print(' '); Serial.println(ESP.getResetReason()); //get last temperature and setpoint ESP.rtcUserMemoryRead(0, (uint32_t*) &RTC_Memory, 10) ; Current_Temperature = (int)RTC_Memory[0]; if (Current_Temperature < 0 || Current_Temperature > 30) Current_Temperature = 19; Current_Setpoint = (int)RTC_Memory[1]; if (Current_Setpoint < 10 || Current_Setpoint > 25) Current_Setpoint = 20;// get the current temperature Request_Temperature(); if (Reset_Info->reason == 5) // we have awoken from deep sleep { Report_Temperature(); // report the current temperature over wifi and go back to sleep Goto_Sleep(); } else // the user pushed the button - show the display { Display_init(); Display_clear(); Show_Setpoint_or_Temperature = true; }}void loop(){ if (Timer()) // do this every 10 milliseconds { ESP.wdtFeed(); // watchdog is reset if (Temp_displayed == false) { Display_clear(); if (Show_Setpoint_or_Temperature) Show_Temperature(); else Show_Setpoint(); Temp_displayed = true; } byte but = Check_Button(); if (but > 0) SleepTime = TIMEOUT; switch (but) { case 3: // 3 = Button was pressed for COUNT_UP Current_Setpoint++; if (Current_Setpoint > 25) Current_Setpoint = 25; Temp_displayed = false; Show_Setpoint_or_Temperature = false; break; case 4: // 4 = Button was pressed for COUNT_DOWN Current_Setpoint--; if (Current_Setpoint <15) Current_Setpoint = 15; Temp_displayed = false; Show_Setpoint_or_Temperature = false; break; } SleepTime--; if (SleepTime == 0) Goto_Sleep(); // shutdown  }}bool Timer(void){ static unsigned long Time; if (millis() > Time) { Time += 10; return true; } return false;}void Goto_Sleep(void) // sleep for 10 minutes{ Display_off(); RTC_Memory[0] = (uint32_t)Current_Temperature; RTC_Memory[1] = (uint32_t)Current_Setpoint; ESP.rtcUserMemoryWrite(0, (uint32_t*) &RTC_Memory, 10) ; // save Setpoint ESP.deepSleep(600e6, (RFMode)(2)); // no RF calibration on startup}void Show_Temperature(void){ Display_setfont(1); Display_goto(30,0); Display_chars('Temperature'); Display_setfont(4); Display_goto(40,20); Display_char(Current_Temperature/10+0x30); Display_char(Current_Temperature%10+0x30); Display_update();}void Show_Setpoint(void){ Display_setfont(1); Display_goto(30,0); Display_chars(' Setpoint '); Display_setfont(4); Display_goto(40,20); Display_char(Current_Setpoint/10+0x30); Display_char(Current_Setpoint%10+0x30); Display_update();}void Show_Failure_Reason(const char *reason){ long timenow; Display_init(); Display_clear(); Display_setfont(1); Display_goto(20,26); Display_chars(reason); Display_update(); timenow = millis(); while ((millis() - timenow) < 3000); // show for 3 seconds}void Report_Temperature(void){ long timenow; long WiFiTime; // time to establish wifi connection long ClientTime; // time to connect to thingspeak server // start wifi station WiFi.persistent(false); //WiFi.mode(WIFI_OFF); WiFi.mode(WIFI_STA); WiFi.begin(ssid, password); timenow = millis(); while (WiFi.isConnected() == false) { delay(100); ESP.wdtFeed(); WiFiTime = millis() - timenow; if (WiFiTime > 10000) { Serial.println('WiFi Connection Timeout !'); Show_Failure_Reason('WiFi Timeout'); Goto_Sleep(); // if no connection after 10 seconds - give up } } Serial.print('WiFi Connection after '); Serial.print(WiFiTime/1000); Serial.print('.'); Serial.print(WiFiTime%1000); Serial.println(' seconds');Current_Temperature = Get_Temperature(); Serial.print('Current Temperature = '); Serial.println(Current_Temperature); WiFiClient client;httpstring = ThingSpeak + Current_Setpoint + '&field2=' + Current_Temperature + '&field3=' + WiFiTime; if (client.connect(host, 80)) { Serial.println('connected'); Serial.println(httpstring); client.println(httpstring);timenow = millis(); while (client.connected()) { if (client.available()) { String line = client.readStringUntil(''); Serial.println(line); } ClientTime = millis() - timenow; if (ClientTime > 5000) { Serial.println('thingspeak Connection Timeout !'); Show_Failure_Reason('Server Timeout'); Goto_Sleep(); // if no connection after 5 seconds - give up } } client.stop(); Serial.println('Disconnected'); } else { Serial.println('connection failed !'); client.stop(); } client.stop(); WiFi.mode(WIFI_OFF);}", "num_user_post": " 1", "author": "chputney"}, {"date": "October 16, 2017 - 2:43 pm", "content": "OK Guys thanks a lot I\u00a0progress well with your help!!!!Another question please, can we send text and display it to Thingspeak ?", "num_user_post": " 6", "author": "gillesroszak"}, {"date": "October 16, 2017 - 4:32 pm", "content": "Gilles,Can you post how you solved the problem you had above if you got it resolved for the sake of future forum readers?You can post text to ThingSpeak.\u00a0 If you read text data back with thingSpeakRead() you will want to use 'outputFormat','timetable'.\u00a0 The limit for a single field feed is 256 characters.If you update your channel status with text, you can click the 'Show Status' box on your channel settings page and then your main channel page will show the status text.ThingSpeak also recently added support for the Text analytics toolbox.\u00a0 If you have a license for that toolbox, you can also use its functions in ThingSpeak to analyze text.", "num_user_post": " 401", "author": "cstapels"}, {"date": "October 17, 2017 - 3:34 pm", "content": "Hi Guys ,\u00a0Can you help me one more time?\u00a0I want to use this sketch to send data to thingspeak see below)Which code line should i add to do this\u00a0[code]/* Flame Sensor analog example. Code by Reichenstein7 (thejamerson.com)For use with a Rain Sensor with an analog out!To test view the output, point a serial monitor such as Putty at your Arduino.- If the Sensor Board is completely soaked; 'case 0' will be activated and ' Flood ' will be sent to the serial monitor. - If the Sensor Board has water droplets on it; 'case 1' will be activated and ' Rain Warning ' will be sent to the serial monitor. - If the Sensor Board is dry; 'case 2' will be activated and ' Not Raining ' will be sent to the serial monitor.*/// lowest and highest sensor readings:const int sensorMin = 0; // sensor minimumconst int sensorMax = 960; // sensor maximumvoid setup() { // initialize serial communication @ 9600 baud: Serial.begin(9600);}void loop() { // read the sensor on analog A0: int sensorReading = analogRead(A0); // map the sensor range (Six options): // ex: 'long int map(long int, long int, long int, long int, long int)' int range = map(sensorReading, sensorMin, sensorMax, 0, 15);// range value: switch (range) { case 0: // Sensor getting wet Serial.println('15'); break; case 1: // Sensor getting wet Serial.println('14'); break; case 2: // Sensor getting wet Serial.println('13'); break; case 3: // Sensor getting wet Serial.println('12'); break; case 4: // Sensor getting wet Serial.println('11'); break; case 5: // Sensor getting wet Serial.println('10'); break; case 6: // Sensor getting wet Serial.println('9'); break; case 7: // Sensor getting wet Serial.println('8'); break; case 8: // Sensor getting wet Serial.println('7'); break; case 9: // Sensor getting wet Serial.println('6'); break; case 10: // Sensor getting wet Serial.println('5'); break; case 11: // Sensor getting wet Serial.println('4'); break; case 12: // Sensor getting wet Serial.println('3'); break; case 13: // Sensor getting wet Serial.println('2'); break; case 14: // Sensor getting wet Serial.println('1'); break; case 15: // Sensor dry - To shut this up delete the ' Serial.println('Sec'); ' below. Serial.println('0'); break; } delay(2000); // delay between reads}[/code]", "num_user_post": " 6", "author": "gillesroszak"}, {"date": "October 20, 2017 - 12:01 pm", "content": "cstapels said Gilles, Can you post how you solved the problem you had above if you got it resolved for the sake of future forum readers?Hi,\u00a0Sorry for the late reply,.I just use Tuniot\u00a0 for ESP8266\u00a0See here\u00a0\u00a0", "num_user_post": " 6", "author": "gillesroszak"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/controlloing-led-status-using-kivy/", "posts": [{"date": "September 20, 2017 - 10:45 am", "content": "I want to control the swtiching of LED with APP made in KIVY through MQTT . I am not able to find single tutorial or code which can demeonstrate how to switch ON/OFF LED through an APP ,", "num_user_post": " 1", "author": "angy1551"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/esp8266-sending-voltage-readings-to-thingspeak/", "posts": [{"date": "May 7, 2017 - 12:41 pm", "content": "Hello,\u00a0I'm trying to send voltage data to thingspeak, there are tons of tutorial using the DHT sensor, but I'm trying to send a normal voltage reading from the ESP8266 GIPO 2 to thingspeak.\u00a0I'm trying to do something like this, but only to read voltage output from a sensor.\u00a0can someone do the code for me, I've been trying for months. it should be very simple for you guys, please help me.\u00a0", "num_user_post": " 1", "author": "7asson93"}, {"date": "September 10, 2017 - 9:45 pm", "content": "Arduino mode or Lua mode?Here is a way by Lua:https://github.com/BLavery/esuite-lua/blob/master/projects/project18.lua", "num_user_post": " 1", "author": "blavery"}, {"date": "September 13, 2017 - 2:05 pm", "content": "Have a look at the bulk update code for Arduino, it also works for ESP8266. \u00a0 \u00a0You can modify the POST command to just do a single channel update using the command structure you can copy from your API Keys page or shown here. \u00a0", "num_user_post": " 401", "author": "cstapels"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/esp8266-sends-a-constant-to-thinkspeak-but-there-are-many-outliers-why/", "posts": [{"date": "August 25, 2017 - 4:36 am", "content": "I measure the value in Arduino Pro\u00a0and send it to Thinkspeak via ESP8266, but there are many outliers (stupid weird value out of range). That's why I tried send to Thinkspeak only one constant (3.33) stored directly in ESP8266 and the situation is the same. There are many outliers too, why??....void loop() { if (Serial.available() >= sizeof(int)) { float i = Serial.parseInt(); sendDataToThingspeak(3.33); }....time@email.cz", "num_user_post": " 3", "author": "Jerry"}, {"date": "August 25, 2017 - 3:32 pm", "content": "Can you describe what the function sendDataToThingspeak() does? \u00a0", "num_user_post": " 401", "author": "cstapels"}, {"date": "August 31, 2017 - 1:01 pm", "content": "Here you will find the whole file: \u00a0 \u00a0 \u00a0 https://www.dropbox.com/s/betiilykyrnhho1/MainProduct_317961.ino?dl=0thaks Jerry", "num_user_post": " 3", "author": "Jerry"}, {"date": "September 11, 2017 - 7:34 am", "content": "Hello,I tried another piece of ESP8266 but the result is still bad. I attach a link where I keep doing it all the time. Thus Thinkspeak is inapplicable.Thank you for your advice. Jerryhttps://thingspeak.com/channels/87384", "num_user_post": " 3", "author": "Jerry"}, {"date": "September 12, 2017 - 1:00 am", "content": "For those of us not willing to download random files from dropbox can you post the complete code of the sendDataToThingspeak() function? Did you try the official thinkspeak package (https://blogs.mathworks.com/iot/2015/10/09/official-thingspeak-library-for-arduino-and-particle/)\u00a0 Its possible your API call is failing in some way that you are not detecting.", "num_user_post": " 271", "author": "rw950431"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/wemos-d1-mini-vodafone-new-zealand-4g/", "posts": [{"date": "August 11, 2017 - 4:56 am", "content": "Hello AllI thought it would be of some help to this community to share my experiences with getting a thingspeak device working here in New Zealand.I am using a wemos D1 mini to upload my temperature data to thingspeak for a year or so before it \u201cstopped\u201d working. \u00a0My original project used LUA and worked fine.I thought the problem was that the code had become corrupted (I found a few people who mentioned the same problems as I was having) so I set about converting the LUA code to Arduino.I could not for the life of me get any of the example code on the web working at all. \u00a0I could connect to the wifi no problem; it would allocate my wemos an IP address. \u00a0When the code ran I could even see the IP address of the thingspeak servers, and it connected to them fine.The problem was when the code got to the following line, it would time out and fail. client.print('POST /update HTTP/1.1');I took the device to work(a fibre connection to the internet), and the code work perfectly, but I could not get it to work at my home, or even through a wifi hotspot from my cellphone.I discovered that the problem was with my internet connection at my home. \u00a0My internet connection is through Vodafone using their wireless broadband 4G network. \u00a0It appears that Vodafone (I won\u2019t say blocks) but doesn\u2019t allow the particular ports used by the WiFiClient connection through.I changed my code so that it uses the HTTP client instead. \u00a0This worked well, and I have been successfully using this for a few months now.Relevant Snippets of the code I used is below.I am sending two strings of information to thing speak. \u00a0The temperature outside my house, and the voltage of my batteries, thus the two values being passed to the function.\u00a0#include <ESP8266HTTPClient.h> \u00a0// instead of #include <ESP8266WiFi.h>......void PostToThingSpeak(float celsius, float voltage){ String updateURL = 'http://';updateURL += String(server);updateURL +='/update?api_key=';updateURL += String(apiKey);updateURL +='&field1=';updateURL += String(celsius);updateURL +='&field2=';updateURL += String(voltage);client.begin(updateURL);int httpCode = client.GET(); \u00a0// I guess I could check that I get a \u201c1\u201d as confirmation but I implemented that yetclient.end();}\u00a0For those of us who like a \u00a0\u201cTLDR\u201d Summary:Could not connect using normal 'client' code through vodafones network here in new Zealand, so had to adjust the code to use the httpclient method.", "num_user_post": " 2", "author": "SteveMcC"}, {"date": "August 12, 2017 - 7:51 am", "content": "For the record what port was your original code connecting to?", "num_user_post": " 271", "author": "rw950431"}, {"date": "August 14, 2017 - 10:24 pm", "content": "I was connecting using port 80...for example the code below was one of the examples I tried to use.....and I could not get it to work....(I have since then spoken to a friend who works in IT, and apparently there are different APN's that can be used with vodafone NZ network, and some of them allow different ports access through their firewalls, but I am not sure I can confirm or deny this)if (client.connect(server,80)) {String postStr = apiKey;postStr +='&field1=';postStr += String(t);postStr +='&field2=';postStr += String(h);postStr += '';\u00a0client.print('POST /update HTTP/1.1');client.print('Host: api.thingspeak.com');client.print('Connection: close');client.print('X-THINGSPEAKAPIKEY: '+apiKey+'');client.print('Content-Type: application/x-www-form-urlencoded');client.print('Content-Length: ');client.print(postStr.length());client.print('');client.print(postStr);\u00a0Serial.print('Temperature: ');Serial.print(t);Serial.print(' degrees Celsius Humidity: ');Serial.print(h);Serial.println('Sending data to Thingspeak');}", "num_user_post": " 2", "author": "SteveMcC"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/sensor-data-in-js-as-an-ifelse/", "posts": [{"date": "July 31, 2017 - 10:40 am", "content": "In my JavaScript I have a number of variables as shown:\u00a0stop = new google.maps.LatLng(59.093914487013, -122.71569423377514)waypts.push({location: stop,stopover: true\u00a0The line in Bold\u00a0is what I need help with. I have data transmitted to Thingspeak. I have an API that allows me to select the exact value to query; what I need to know is how to use a GET statement (Or anything that would work) to have that Stopover\u00a0line be True or False based on the result. So IF the result queried by the API is over 8, it's TRUE, if it's under it is false.\u00a0The API line looks like this:\u00a0\u00a0GET https://api.thingspeak.com/channels/****/fields/1.json?results=2So How do I set that Bold\u00a0field to query this and either be TRUE or FALSE based upon the result of this query?\u00a0If you need any more info please reply and I can fill in any blanks, but I'm reallllly needing some help here.\u00a0Thank you!\u00a0", "num_user_post": " 8", "author": "jteindl"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/thinghttp-to-serial-monitor/", "posts": [{"date": "July 27, 2017 - 8:52 am", "content": "Hello everyone, i am fairly new to this community. I am currently working on ThingHTTP with ESP8266 nodeMCU. My little project should read in total subscribers from youtube channel and lets say for now print them out to the serial monitor.\u00a0I have created a new ThingHTTP and filled in URL, parsing string and method. After the link was generated i clicked into it and it seems to be working just fine, while displaying only the total number of subscribers. Now, the problem is the code itself.. i don't know how to properly call the function and how it should be printed out to the serial. I would really appreciate some help here.\u00a0There is my code so far :\u00a0\u00a0 #include const char* ssid = 'ssidName'; const char* password = 'password'; const char* host = 'api.things.com';const char URL_youtube[] = 'GET https://api.thingspeak.com/apps/thinghttp/send_request?api_key=XXXXXXXXXXXXXXX HTTP/1.0';void setup() {Serial.begin(115200); delay(10);WiFi.begin(ssid, password);Serial.println(); Serial.println(); Serial.print('tConnecting to: '); Serial.println(ssid);while (WiFi.status() != WL_CONNECTED) {delay(100); Serial.print('.');}Serial.println(''); Serial.println('tWiFi Connected');}void loop() {getYoutube(); delay(15000);}\u00a0void getYoutube() {if (WiFi.status() == WL_CONNECTED) { // function goes here } }", "num_user_post": " 2", "author": "RytisBe"}]}, {"url": "https://community.thingspeak.com/forum/esp8266-wi-fi/tinkercad-esp8266-simulator-posting-null-values-to-thingspeak/", "posts": [{"date": "July 9, 2017 - 11:55 am", "content": "Hi All,I'm running into a weird error where my HTTP GET request will successfully post to a ThingSpeak channel, but the data is 'null.' Any idea on why this might be occurring? I'm planning to use Tinkercad and ThingSpeak as part of an 'Introduction to Arduino' (with an IoT section) class in the next couple of weeks, so any help is appreciated!The Tinkercad simulation can be found here: https://tinkercad.com/things/iIz3ZdsHG3BIf I paste in the URL (api.thingspeak.com/update?api_key=I72PI7HCKYI1MD9Q&field1=0) into my browser, I can post a '0' to my ThingSpeak channel.Also, if I send a GET request for example.com/index.html, I successfully get a properly formatted HTML page in the Tinkercad simulator, so I know that the emulated Internet connection is working.However, when I run the GET request to post something to ThingSpeak, I receive a 200 OK and the channel is updated with a 'null' value, which makes me think that something is formatted incorrectly. Here is a JSON of the data after posting 2 values:{'channel':{'id':299689,'name':'Temperature Logger','latitude':'0.0','longitude':'0.0','field1':'Temperature','created_at':'2017-07-08T17:26:56-06:00','updated_at':'2017-07-09T09:33:53-06:00','last_entry_id':2},'feeds':[{'created_at':'2017-07-09T09:33:07-06:00','entry_id':1,'field1':null},{'created_at':'2017-07-09T09:33:53-06:00','entry_id':2,'field1':null}]}\u00a0I've posted my code below. Please note that the ESP8266 is attached to the Arduino's Serial and SoftSerial is being used for debugging/status codes.\u00a0#include 'SoftwareSerial.h'// WiFi configString ssid     = 'Simulator Wifi';String password = '';// Server, file, and portconst String hostname = 'api.thingspeak.com';const String uri = '/update?api_key=I72PI7HCKYI1MD9Q&field1=0';const int port = 80;// This works: Basic GET of a page/*const String hostname = 'example.com';const String uri = '/index.html';const int port = 80;*/// Software serial objectSoftwareSerial soft(8, 9); // RX, TXvoid setup() {    // Initialize serial connections  Serial.begin(115200);  soft.begin(9600);    // Talk to ESP8266  soft.println('Init ESP8266...');  Serial.println('AT');  delay(10);  if ( Serial.find('OK') == 0 ) {    soft.println('ESP8266 not found');    while(1);  }    // Connect to WiFi  soft.println('Connecting to WiFi...');  Serial.println('AT+CWJAP='' + ssid + '','' + password + ''');  delay(10);  if ( Serial.find('OK') == 0 ) {    soft.println('Could not connect to WiFi');    while(1);  } else {    soft.println('Connected!');  }}void loop() {    // Open TCP connection  Serial.println('AT+CIPSTART='TCP','' + hostname + '',' + port);  delay(50);  if ( Serial.find('OK') == 0 ) {    soft.println('Error');  }  // Construct HTTP request  String req = 'GET ' + uri + ' HTTP/1.1' + 'Host: ' + hostname + '' +\u00a0 \u00a0 'Connection: close' +\u00a0 \u00a0 '';  int len = req.length();    // Send our request length  Serial.print('AT+CIPSEND=');  Serial.println(len);  delay(10);  if ( Serial.find('>') == 0 ) {    soft.println('Error');  }  // Send our http request  Serial.print(req);  delay(10);  if (!Serial.find('SEND OK')) {    soft.println('Error');  }    // Wait for a response from the server  while( Serial.available() == 0 ) {    delay(5);  }    // Print reply from server  while ( Serial.available() ) {    String ln = Serial.readStringUntil('');    soft.print(ln);  }    // Close TCP connection  Serial.println('AT+CIPCLOSE=0');  delay(50);  if ( Serial.find('OK') == 0 ) {    soft.println('Error');  } else {    soft.println();    soft.println('Connection closed');  }    delay(20000);}", "num_user_post": " 3", "author": "sgmustadio"}, {"date": "July 10, 2017 - 1:00 am", "content": "I do not know if this can help you56 // Construct HTTP request57 String req = 'GET ' + uri + ' HTTP/1.158 ' + 'Host: ' + hostname + '59 ' + \u00a0 \u00a0'Connection: close60 ' + \u00a0 \u00a0'61 ';62 int len = req.length();63 \u00a064 // Send our request length65 Serial.print('AT+CIPSEND=');66 Serial.println(len);67 delay(10);68 if ( Serial.find('>') == 0 ) {69 \u00a0soft.println('Error');70 }7172 // Send our http request73 Serial.print(req);74 delay(10);75 if (!Serial.find('SEND OK76 ')) {77 \u00a0soft.println('Error');78 }my way in my real life (nothing against simulators) \u00a0600000+ records and counting ...\u00a0 // TCP connection\u00a0 String cmd = 'AT+CIPSTART='TCP','';\u00a0 cmd += '184.106.153.149'; // api.thingspeak.com -- not working\u00a0 cmd += '',80';\u00a0 altSer.println(cmd);\u00a0 // \u00a0if (altSer.find('Error')) { \u00a0 \u00a0 one 'AT commands' version\u00a0 if (altSer.find('ERROR')) { \u00a0 \u00a0 \u00a0another 'AT commands' version\u00a0 \u00a0 Serial.println('AT+CIPSTART error');\u00a0 \u00a0 delay(4000);\u00a0 \u00a0 return;\u00a0 }\u00a0 // prepare GET string\u00a0 String getStr = 'GET /update?api_key=';\u00a0 getStr += apiKey;\u00a0 getStr += '&field1=';\u00a0 getStr += String(strTemp); \u00a0 \u00a0 \u00a0 \u00a0 \u00a0\u00a0number to string\u00a0 getStr += '&field2=';\u00a0 getStr += String(strHume);\u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0number to string\u00a0 getStr += ' r  n  r  n'; \u00a0 \u00a0 \u00a0must be  r \u00a0and \u00a0 n \u00a0without the space between so 2 CRs and 2 NLs\u00a0 // send data length\u00a0 cmd = 'AT+CIPSEND=';\u00a0 cmd += String(getStr.length());\u00a0 \u00a0 number to string\u00a0 altSer.println(cmd);\u00a0 if (altSer.find('>')) {\u00a0 \u00a0 altSer.print(getStr);\u00a0 } else {\u00a0 \u00a0 altSer.println('AT+CIPCLOSE');\u00a0 \u00a0 // alert user\u00a0 \u00a0 Serial.println('AT+CIPCLOSE');\u00a0 } \u00a0 // thingspeak needs 15 sec delay between updates\u00a0 Serial.println('- * - * - * - * - * - * - * -');\u00a0 delay(59800); \u00a0 \u00a0 almost 60 points/hour -- Better to use millis()}** altSer to ESP8266** Serial to consoleMaybe number 0 is received as NULL in your code (thinking aloud)Also there are more than one 'AT commands' versions", "num_user_post": " 91", "author": "piajola"}, {"date": "July 10, 2017 - 9:30 am", "content": "sgmustadio,From what I see in your code, you aren't sending any values in your GET request. \u00a0You can see this link\u00a0for sample code. \u00a0This code uses the bulk post method, but it allows you to see the formatting. \u00a0Also try this link.\u00a0In lines 56-62, you need to include the api key and field 1 info, as in the request you listed 'api.thingspeak.com/update?api_key=XXXXXXXXXXXXXXXX&field1=0)'56 \u00a0// Construct HTTP request57 \u00a0String req\u00a0=\u00a0'GET '\u00a0+ uri + ' HTTP/1.158 ' + 'Host:\u00a0' +\u00a0hostname\u00a0+ '59 ' +\u00a0 \u00a0 'Connection: close60 ' +\u00a0 \u00a0 '61 ';62 \u00a0int len\u00a0=\u00a0req.length();", "num_user_post": " 401", "author": "cstapels"}, {"date": "July 12, 2017 - 9:07 pm", "content": "Thanks for the suggestions,\u00a0piajola and cstapels. Still no luck on my end. The weird thing is that the GET request (with exactly the same formatting) successfully posts to ThingSpeak from a real ESP8266 (SparkFun Thing Dev), so it must be something with the Tinkercad ESP8266. My request does have a value for field1, as per the URI: '/update?api_key=I72PI7HCKYI1MD9Q&field1=0' (don't worry, I've since changed my Write API key, so this one is pretty useless).I've even tried a POST request (replace lines 56-62 with the following):// POST Test (no spaces for newline/return carriage symbols)String body = 'api_key=I72PI7HCKYI1MD9Q&field1=0';\u00a0String req = String('POST /update HTTP/1.1 r  n') +                  'Host: ' + hostname + ' r  n' +\u00a0 \u00a0                   'User-Agent: Arduino/1.0 r  n' +\u00a0 \u00a0                   'Content-Type: application/x-www-form-urlencoded; r  n' +              \u00a0 \u00a0 'Content-Length: ' + body.length() + ' r  n' +\u00a0 \u00a0                   'Connection: close r  n' +\u00a0 \u00a0                   ' r  n' +             \u00a0\u00a0 \u00a0 body + ' r  n';\u00a0 int len = req.length();\u00a0 Once again, it works great in real hardware as well as from something like hurl.it, but gives me a 404 Not Found in the simulator.", "num_user_post": " 3", "author": "sgmustadio"}, {"date": "July 13, 2017 - 6:41 pm", "content": "You had the right information in the uri variable (I missed that above). \u00a0Since you are getting a 404, perhaps its your line endings? There is a space between them, perhaps your encoder (in the simulator) is changing that space to a %20?", "num_user_post": " 401", "author": "cstapels"}, {"date": "July 14, 2017 - 8:52 pm", "content": "Oops, forgot to mention (sorry!): I added spaces to the slash-r-slash-n line endings because this forum tool actually tries to parse the newline-return carriage characters, and the normal  escape character doesn't work. There are no spaces there in the code.", "num_user_post": " 3", "author": "sgmustadio"}]}]}