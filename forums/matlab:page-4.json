{"url": "https://community.thingspeak.com/forum/matlab/page-4/", "threads": [{"url": "https://community.thingspeak.com/forum/matlab/calculating-averages-per-weekday/", "posts": [{"date": "January 5, 2017 - 4:34 am", "content": "\u00a0Hi,\u00a0I am logging my energy usage to channel\u00a0203631 (public).I would like to calculate the average (or median) energy usage per weekday (monday/tuesday/wednesday/....). \u00a0I am clueless on how to do this. Can somebody help me?The channel contains 2 fields, no1 = the energy used per 30 seconds. The other the sum of energy used per 24 hours. I hope the timestamp from the channel it self can be used for date/time that is requierd.\u00a0Feel free to use the data from the channel.\u00a0Thanx in advance!\u00a0Niels", "num_user_post": " 2", "author": "nielsb100"}, {"date": "January 5, 2017 - 7:13 pm", "content": "Hi Niels,Please first run as is (hope it run in your machine \ud83d\ude09See the output windows to check it is doing something useful ...Read the comments ( % ) then Change it however you want/needFinally post questionsHow are you reading watts? Can we know? Always good to know\u00a0\u00a0ver[ 'Time is=> UTC ' datestr(datetime('now','TimeZone','UTC')) ' - Lima ' datestr(datetime('now','TimeZone','America/Lima'))]%%diChanAiDi = 203631;%taim = 1; \u00a0 \u00a0% TimeStampscam1 = 2; \u00a0 % Field1cam2 = 3; \u00a0 % Field2% etc%% t1=datetime('now'); \u00a0 \u00a0% time at running time i.e. 'right now'yi=2017; \u00a0 % year(t1); initial point in space-time -- as in Star Trek \ud83d\ude09mi=1; \u00a0 \u00a0 \u00a0% month(t1);di=5; \u00a0 \u00a0 \u00a0 % day(t1);hi=16; \u00a0 \u00a0 % hour(t1);mmi=0; \u00a0 % minute(t1);si=0; \u00a0 \u00a0 \u00a0 % second(t1);yf=2017; \u00a0%ending point in desired time lapsemf=1;df=5;hf=16;mmf=14; % minute(t1);sf=59; \u00a0 \u00a0 % second(t1);%tini=datetime([yi,mi,di,hi,mmi,si],'TimeZone','UTC')tini=datetime([yi,mi,di,hi,mmi,si]);tfin=datetime([yf,mf,df,hf,mmf,sf]);tkomo = 0;if tkomo==1 tini.TimeZone = 'UTC'; tfin.TimeZone = 'UTC';else tini.TimeZone = 'America/Lima'; \u00a0 \u00a0 % change as per your galaxy and sun color tfin.TimeZone = 'America/Lima';end%tini.TimeZone, tfin.TimeZone['from-> ' datestr(tini) ' ** to-> ' datestr(tfin)]%[datCH] = thingSpeakRead(diChanAiDi,'Fields',[1 2],'numpoints',100,'OutputFormat','table'); % last 100 points[datCH] = thingSpeakRead(diChanAiDi,'Fields',[1 2],'DateRange',[tini,tfin],'OutputFormat','table')t1 = datCH{:, taim}; \u00a0 %x1 = datCH{:, cam1}; % datCH{start:end, field} nothing:nothing means ALL arrayx2 = datCH{:, cam2}; %['total kw-> ' num2str(sum(x1))]%second(t1)% prome=mean(x1);['median/avrg kw-> ' num2str(median(x1))]% prome=max(x1); % prome=min(x1);xdif = diff(datCH{:, taim}) % keyword diff finds 2nd-1st, 3rd-2nd, 4th-3rd, 5th-4th,.. so on to end of array['there are not regular 30 sec.']", "num_user_post": " 91", "author": "piajola"}, {"date": "January 8, 2017 - 3:38 pm", "content": "Thanx piajola!I have been working on the code and have so far the following code.Now i want to calculate the averages per weekday. haven't figured out how to do this.\u00a0----\u00a0ver[ 'Time is=> UTC ' datestr(datetime('now','TimeZone','UTC')) ' - Lima ' datestr(datetime('now','TimeZone','America/Lima'))]%%diChanAiDi = 203631;%taim = 1;\u00a0\u00a0\u00a0 % TimeStampscam1 = 2;\u00a0\u00a0 % Field1cam2 = 3;\u00a0\u00a0 % Field2% etc%% t1=datetime('now');\u00a0\u00a0\u00a0 % time at running time i.e. 'right now'yi=2017;\u00a0\u00a0 % year(t1); initial point in space-time -- as in Star Trekmi=1;\u00a0\u00a0\u00a0\u00a0\u00a0 % month(t1);di=5;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 % day(t1);hi=0;\u00a0\u00a0\u00a0\u00a0 % hour(t1);mmi=0;\u00a0\u00a0 % minute(t1);si=0;\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 % second(t1);yf=2017;\u00a0 %ending point in desired time lapsemf=1;df=5;hf=23;mmf=59;\u00a0\u00a0\u00a0 % minute(t1);sf=59;\u00a0\u00a0\u00a0\u00a0 % second(t1);for j=1:8,\u00a0\u00a0\u00a0 %day x to y\u00a0\u00a0 \u00a0%stepsize to 7? for weekdays\u00a0\u00a0 \u00a0%assign j to any of the yi - di variablesdi = j;df = j;%tini=datetime([yi,mi,di,hi,mmi,si],'TimeZone','UTC')tini=datetime([yi,mi,di,hi,mmi,si]);tfin=datetime([yf,mf,df,hf,mmf,sf]);tkomo = 0;if tkomo==1tini.TimeZone = 'UTC';tfin.TimeZone = 'UTC';elsetini.TimeZone = 'America/Lima';\u00a0\u00a0\u00a0\u00a0 % change as per your galaxy and sun colortfin.TimeZone = 'America/Lima';end%tini.TimeZone, tfin.TimeZone%[datCH] = thingSpeakRead(diChanAiDi,'Fields',[1 2],'numpoints',100,'OutputFormat','table'); % last 100 pointsdatCH = thingSpeakRead(diChanAiDi,'Fields',[1 2],'DateRange',[tini,tfin],'OutputFormat','table');t1 = datCH{:, taim};\u00a0\u00a0 %x1 = datCH{:, cam1};\u00a0 % datCH{start:end, field} nothing:nothing means ALL arrayx2 = datCH{:, cam2};\u00a0 %out =['total energy during ' num2str(yi) '-' num2str(mi) '-' num2str(di) ': ' num2str(max(x2)) 'Kwh'];disp(out)end%to figure out: group by weekday and post to anonther channel", "num_user_post": " 2", "author": "nielsb100"}, {"date": "January 9, 2017 - 12:25 pm", "content": "I'm probably being simplistic, but timetables in MATLAB are probably what you need here. \u00a0You can use the retime function to apply an operation on a daily basis:energyData = thingSpeakRead(203631, 'NumDays', 7, 'OutputFormat', 'timetable');retime(energyData,'daily',@median)\u00a0You'll get:ans =5\u00d72 timetable arrayTimestamps Kwatt TotalKwh ____________________ _____ ________05-Jan-2017 00:00:00 0.37 8.642 06-Jan-2017 00:00:00 0.36 5.373 07-Jan-2017 00:00:00 0.37 7.736 08-Jan-2017 00:00:00 0.24 5.787 09-Jan-2017 00:00:00 0.23 3.357", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "September 8, 2017 - 5:18 am", "content": "Neat Rob, just what im looking for as a starting point for my application (i think)\u00a0ThanksRay", "num_user_post": " 11", "author": "rayellam"}]}, {"url": "https://community.thingspeak.com/forum/matlab/matlab-visualization-rainfall/", "posts": [{"date": "August 28, 2017 - 10:44 am", "content": "\u00a0Hi,\u00a0I am discovering matlab on the go. I have one problem. \u00a0I get an incrementing value of rainfall in mm. I would like to get a bar graph for example per day. \u00a0The substraction of two values i have figured out (at begin of the day and at the end) but how do i link it to a date and visualize it? Thanks in advance for any help.", "num_user_post": " 1", "author": "LEDsREPAIR"}]}, {"url": "https://community.thingspeak.com/forum/matlab/displaying-sum-for-the-day-and-specific-hours/", "posts": [{"date": "July 18, 2017 - 7:10 pm", "content": "Hello Guys,\u00a0I am getting data from flow sensor and I want to calculate and display total liquid recorded for a day and for a specific hour. How can I do that using MATLAB Visualizations or Analysis?\u00a0Thank you and I look forward to some great suggestions.Best RegardsRushan", "num_user_post": " 8", "author": "rushanarshad"}, {"date": "July 20, 2017 - 3:48 pm", "content": "Rushan,There is an example of how to aggregate data in the documentation here. \u00a0You can find more information on retime in the main MATLAB documentation. You can also use the mean function in MATLAB to create an average value. \u00a0Read the data using MATLAB analysis into a variable using thingspeakRead()\u00a0(you could use the 'NumPoints' or 'NumMinutes' to select a slice of your data.) \u00a0Then you can use the between function to calculate the elapsed time between your first and last points. \u00a0Multiple the average flow rate by the time to get the total liquid. \u00a0Then use the thingSpeakWrite() to write the data to another channel, or another field of the same channel. \u00a0And if you really want to get fancy, you can create a plugin to display the numbers you are looking for on your private view of the channel.Good luck!", "num_user_post": " 401", "author": "cstapels"}]}, {"url": "https://community.thingspeak.com/forum/matlab/error-using-thingspeakwrite-command-in-a-matlab/", "posts": [{"date": "May 5, 2017 - 10:02 am", "content": "I am very impressed what thingspeak cloud service do but now, I can't solve the problem with running matlab code that ask for waiting the 15 second although I put the delay(45) up and down the command. \u00a0Please help me for the current project according to the attacted photo.Error displayMatlab command", "num_user_post": " 3", "author": "zkornz"}, {"date": "May 6, 2017 - 1:22 pm", "content": "Please help me guys. T_T", "num_user_post": " 3", "author": "zkornz"}, {"date": "May 6, 2017 - 2:49 pm", "content": "Thanks for the comment. I will try and find someone to help you as soon as possible. Thanks.\u00a0", "num_user_post": " 402", "author": "Hans"}, {"date": "May 8, 2017 - 7:57 am", "content": "Hi,\u00a0A channel on thingSpeak can be updated at the fastest rate of once every 15 seconds (free account) or once every 1 second (paid account). This limit is enforced even if multiple independent sources/clients are writing to the same thingSpeak channel at different rates. With this is mind, could you confirm that the MATLAB code that you have shared above is the only source writing to channel\u00a0242517?Note that the update rate limit is enforced even if you are writing to different fields at different rates. Consider the following example for the free account case: on channel 242517, if fields 1 and 2 are being updated once every 15 seconds from one client/MATLAB function and fields 3 and 4 are being updated once every 30 seconds by another client/MATLAB program, you might see an error because channel 242517 might get two updates in less than 15 seconds.\u00a0Let us know if you are still seeing an error after ensuring that there is only one client/MATLAB program writing to your channel. \u00a0\u00a0- Adarsh", "num_user_post": " 62", "author": "Adarsh_Murthy"}]}, {"url": "https://community.thingspeak.com/forum/matlab/calculate-total-time-channel-data-is-0/", "posts": [{"date": "January 22, 2017 - 12:59 pm", "content": "Hello,I have a thingSpeak project that requires some analysis.\u00a0 However, Matlab is totally foreign to me.\u00a0 I have been able to accomplish much of what I need but I'm stuck and would like some guidance.\u00a0I have a channel that has 8 fields and the values within those fields are zeroes or ones.\u00a0 I want to calculate for one specific day, and one specific field how much time the zeroes have been on.\u00a0 I cannot create a variable that contains the data points for just those zeroes such that I can then calculate the difference between the timestamps and then sum them.\u00a0 Here's what I thought would work but doesn't:\u00a0[data2,timestamps,chInfo] = thingSpeakRead(YYYYYY,'ReadKey','XXXXXX','Fields',[1],'DateRange',[datetime('Jan 21, 2017'),datetime('Jan 22, 2017')],'OutputFormat','timetable');t=table2array(data2);for i =1:1:60\u00a0\u00a0\u00a0 if(t(i,1) == 0)\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 zerodata=[t(i,1),1;];\u00a0\u00a0\u00a0 endendt1=diff(t.Timestamps);t1a=cumsum(t1);t2=max(t1a);t2\u00a0I believe the statement defining zerodata is wrong, but I cannot fix it.\u00a0 Also, I am just trying 60 data points rather than all the data for that day.\u00a0Please excuse any stupid errors since I am trying to use Matlab without getting deeply into it.\u00a0Thank for any guidance you can give me.", "num_user_post": " 5", "author": "Doug"}, {"date": "January 23, 2017 - 1:14 pm", "content": "I think you're looking for a feature in MATLAB called logical indexing.All you need is the timetable that is in the variable data2 in your example. \u00a0Assuming it looks something like this:data2 =\u00a0 \u00a0 \u00a0 \u00a0time \u00a0 \u00a0 \u00a0 \u00a0 \u00a0field1 field2 field3____________________ ______ ______ ______23-Jan-2017 06:57:28 1 \u00a0 \u00a0 \u00a0 0 \u00a0 \u00a0 \u00a0123-Jan-2017 07:57:28 0\u00a0 \u00a0 \u00a0\u00a0 0 \u00a0 \u00a0 \u00a0123-Jan-2017 08:57:28 0\u00a0 \u00a0 \u00a0 \u00a01 \u00a0 \u00a0 \u00a0123-Jan-2017 09:57:28 0\u00a0 \u00a0 \u00a0 \u00a01 \u00a0 \u00a0 \u00a0123-Jan-2017 10:57:28 1 \u00a0 \u00a0 \u00a0 1 \u00a0 \u00a0 \u00a0023-Jan-2017 11:57:28 0 \u00a0 \u00a0 \u00a0 0 \u00a0 \u00a0 \u00a0023-Jan-2017 12:57:28 0 \u00a0 \u00a0 \u00a0 0 \u00a0 \u00a0 \u00a01You can take the diff of the timestamps to get the duration between the timestamps, like you didtimeon = diff(data2.time);Since diff returns one fewer rows than it's given, you'll need to decide what to do with the last row. \u00a0If you just ignore it (which is simple), you'll need to 'tack on' a duration of 0:timeon = [timeon;hours(0)]A more sophisticated solution would be to tack on the elapsed time since the last row was written.OK, now you can use the logical indexing. \u00a0With it, you only select the rows that meet your condition (in this case, where field1 == 0)timeon(data2.field1 == 0)ans = 5\u00d71 duration array   01:00:00   01:00:00   01:00:00   01:00:00   00:00:00Really, you want the sum though:sum(timeon(data2.field1 == 0))ans = duration   04:00:00Repeat for the other fields:sum(timeon(data2.field2 == 0))sum(timeon(data2.field3 == 0))Hope this helps,-Rob", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "January 23, 2017 - 3:35 pm", "content": "Rob Purser said timeon = diff(data2.time);OK, now you can use the logical indexing. \u00a0With it, you only select the rows that meet your condition (in this case, where field1 == 0)timeon(data2.field1 == 0)Rob,Thanks a lot for your help. One thing I don't understand: Doesn't the second equation listed above from your post go back to the original data (ie data2) rather than use the difference data of equation one? Will I not get from timeon(data2.field1 ==0) \u00a0the original data from data2 that has 0 in field 1 but not the difference in the timestamps? \u00a0 So shouldn't I do it this way then:timeon(data2.field1 == 0)thentimeondiff = diff(timeon.time)BTW, \u00a0when I run your code, I get message: Unrecognized variable name 'time'.Of course my code doesn't run either!What now?\u00a0Thanks again for your help.", "num_user_post": " 5", "author": "Doug"}, {"date": "January 24, 2017 - 6:24 am", "content": "Hi,The timeon array contains the duration of time elapsed between each reading -- both the times that the condition was met, and the times when it wasn't.This line does two things:timeon(data2.field1 == 0)1. It compare the contents of field1 in the data2 timetable with the value of 0. \u00a0This produces a logical array of trues and falses identifying all the rows that met the condition (in this case, has a value of zero).2. It then uses that logical array to select from the timeon array the only the periods of time when the condition was met. \u00a0Now, you have an array of all the durations when the field1 value was 0. \u00a0You can just sum them.-Rob", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "January 24, 2017 - 4:01 pm", "content": "I got it! Thanks! \u00a0I'm now able to get an email each day saying how long my boiler was on for the previous day. \u00a0This way I can monitor it if I'm away. \u00a0Cool!\u00a0Thanks again\u00a0Doug", "num_user_post": " 5", "author": "Doug"}, {"date": "January 29, 2017 - 11:31 am", "content": "Well, I guess it is not quite perfect. \u00a0At times, I get the following message:Count = 966Index exceeds matrix dimensions.I then run it again later and all is well:\u00a0Count=1023etc\u00a0Here's my code. \u00a0I have removed comment lines but left in lines that are never used in the code that could be removed but haven't been. \u00a0Field1 is Boiler (with values of 0 or 1) and Field8 is dataNo (an index that counts the number of data points created by the Arduino but not necessarily transmitted for whatever reason).\u00a0readChannelID = xxxx;BoilerFieldID = 1;readAPIKey = 'xxxxxxx';writeChannelID = xxx;writeAPIKey = 'xxxxx';[data2,timestamps,chInfo] = thingSpeakRead(xxx,'ReadKey','xxxxxx','Fields',[1,8],'NumMinutes',1440,'OutputFormat','timetable');t=table2array(data2);Count=max(data2.dataNo)timeon = diff(data2.Timestamps)Sum = sum(timeon(data2.Boiler == 0))formatOut = 13; % sets output to HH:MM:SS see datestr descriptionTotalBoilerOn = datestr(Sum,formatOut) %convert to stringthingSpeakWrite(writeChannelID, {TotalBoilerOn, Count}, 'writekey', writeAPIKey); %{} needed to write nonnumeric data\u00a0I test it by running it every hour -everything is fine, then set it to every day and it sometimes gives that error.....Index exceeds matrix dimensions.\u00a0Can anyone explain?? \u00a0Thanks for your help.", "num_user_post": " 5", "author": "Doug"}, {"date": "January 30, 2017 - 3:05 pm", "content": "I can't see anything obvious by inspection. \u00a0Can you add a few calls to disp() to try and figure out what line is failing? \u00a0", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "January 30, 2017 - 4:02 pm", "content": "Rob Purser said I can't see anything obvious by inspection. \u00a0Can you add a few calls to disp() to try and figure out what line is failing? \u00a0\u00a0\u00a0\u00a0I don't have a lot of experience with it, but I was thinking that since it printed 'count' and a number and then said 'Index exceeds matrix dimensions' that the problem would be with the next statement that should have printed a result - that being the statement 'timeon = diff(data2.Timestamps)'. \u00a0Would disp() tell me anything different? \u00a0I suspect index means in this context the position within the matrix that is being referred to and then that position is larger than the matrix dimension. \u00a0But I don't see anywhere that I'm doing that!Thanks for your help.", "num_user_post": " 5", "author": "Doug"}, {"date": "January 31, 2017 - 6:29 am", "content": "Hi Doug,You're absolutely right. \u00a0I tried a few experiments to figure out what would cause the diff function to give that error, and didn't see anything obvious. \u00a0 Can you send me an email at rob.purser at mathworks.com, and we can try to figure it out another way?Thanks,-Rob", "num_user_post": " 47", "author": "Rob Purser"}]}, {"url": "https://community.thingspeak.com/forum/matlab/error-unrecognized-variable-name-x-by-non-ascii-field-name/", "posts": [{"date": "December 15, 2016 - 11:27 pm", "content": "In my channel, there are several fields that their names was written with Unicode character -- '\uc628\ub3c4', '\uc2b5\ub3c4', '\uae30\uc555', ...(FYI, \uc628\ub3c4 is temperature, \uc2b5\ub3c4 is humidity, and \uae30\uc555 is air pressure)\u00a0It looks like thingSpeakRead function doesn't work well with non-ASCII characters.The function reads '\uc628\ub3c4' field, but it throws Unrecognized variable name 'x' Error when it reads '\uc2b5\ub3c4' field.However '\uc2b5\ub3c4' field is read since I renamed the field to humidity.", "num_user_post": " 2", "author": "ykim"}, {"date": "December 22, 2016 - 3:18 pm", "content": "Thanks for sharing the issue. Could you share your channel ID as well to help us reproduce the error?\u00a0", "num_user_post": " 62", "author": "Adarsh_Murthy"}, {"date": "December 26, 2016 - 1:29 am", "content": "I created new public channel and public MATLAB visualization to reproduce the error.Please check following links:https://thingspeak.com/channels/206990https://thingspeak.com/apps/matlab_visualizations/116059", "num_user_post": " 2", "author": "ykim"}, {"date": "December 29, 2016 - 1:52 pm", "content": "Thanks for creating and sharing the new public channel. I am able to reproduce the\u00a0behavior:\u00a0thingSpeakRead(206990, 'outputFormat', 'table')\u00a0ans =1\u00d72 timetable arrayTimestamps \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 x \u00a0 \u00a0 \u00a0 \u00a0x_1 ____________________ ______ ______26-Dec-2016 01:20:11 \u00a0 \u00a017.271 \u00a045.443\u00a0As you mentioned, non-Ascii characters are not supported for column names by the existing functionality.\u00a0We will consider adding this to a future release of thingSpeakRead. Thanks again for sharing your use case.", "num_user_post": " 62", "author": "Adarsh_Murthy"}]}, {"url": "https://community.thingspeak.com/forum/matlab/report-generation-toolbox/", "posts": [{"date": "December 28, 2016 - 11:15 am", "content": "Has anyone tried to use the report generation toolbox in one of their scripts? I have the license for it, but it won't load in the cloud version on Thingspeak.", "num_user_post": " 1", "author": "SoupiestZebra"}, {"date": "December 28, 2016 - 12:21 pm", "content": "Hi SoupiestZebra,\u00a0Currently these are the MATLAB Toolboxes that are supported by ThingSpeak:\u00a0https://www.mathworks.com/help/thingspeak/matlab-toolbox-access.htmlWe plan to add more toolboxes in the future.\u00a0ThanksAkhila\u00a0", "num_user_post": " 21", "author": "akhila"}]}, {"url": "https://community.thingspeak.com/forum/matlab/convert-counter-values-to-rate/", "posts": [{"date": "November 3, 2016 - 12:33 am", "content": "I've got the following code that de-cumulates counter values into a rate display using the matlab diff function (fired by a React every time data is inserted into the channel).\u00a0 It works but seems like a kludge. Is there a neater way to do the same thing? I couldnt quite see how to do a multi-dimensional diff()\u00a0%read last 2 pointsdata = thingSpeakRead(readChannelID,'OutputFormat','Table','Numpoint',2, 'ReadKey', readAPIKey)%get the latest pointd=data(2,:)ts=d.Timestamps;% difference each parameterxdiff = diff(data.xcount)if xdiff<0\u00a0\u00a0\u00a0 xdiff=d.xcount;end\u00a0\u00a0 \u00a0ydiff = diff(data.ycount)if ydiff<0\u00a0\u00a0\u00a0 ydiff=d.ycount;endzdiff = diff(data.zcount)if zdiff<0\u00a0\u00a0\u00a0 zdiff=d.zcount;end%update new channel with the results.thingSpeakWrite(writeChannelID,[xdiff,ydiff,zdiff],'WriteKey', writeAPIKey,'TimeStamp',ts);", "num_user_post": " 271", "author": "rw950431"}, {"date": "November 4, 2016 - 8:24 am", "content": "Hi,\u00a0Could you share the 'data' table? Without looking at the data, my suggestion would be to\u00a0extract the numeric data from the 'data' variable and then call diff() on the array. For example:\u00a0data = thingSpeakRead(readChannelID,'OutputFormat','Table','Numpoint',2, 'ReadKey', readAPIKey);dataArr = data{:, 2:end};diffArr = diff(dataArr);\u00a0diff() function supports 2D arrays. However, it doesn't support tables. The 'Differences Between Matrix Rows' example on this page should be relevant to this case:https://www.mathworks.com/help/matlab/ref/diff.htmlIn this case, 'diffArr' variable should be 1xn row vector with the differences. Even with this, since you are looking to replace each variable in diffArr with a different value (if negative), the simple way is to use the if construct to check if it is negative and then replace the value.\u00a0HTH! \u00a0", "num_user_post": " 62", "author": "Adarsh_Murthy"}, {"date": "November 4, 2016 - 8:13 pm", "content": "Thanks Adarsh..\u00a0\u00a0 If I understand correctly there is no easier way to do the 'if negative replace with value from another array' step.Would it be easier if I used the '[data,timestamps]=thingSpeakRead(..)' form for the original extraction rather than a table? I'm a total newbie at Matlab and only used Table because I'm familiar with it.", "num_user_post": " 271", "author": "rw950431"}, {"date": "November 8, 2016 - 10:23 am", "content": "You could use arrays as you suggested (this would remove the additional line to extract data from the table):data = thingSpeakRead(readChannelID,'Numpoint',2, 'ReadKey', readAPIKey);diffArr = diff(data);\u00a0Regarding conditional replacement of values in an array, my suggestion would be to use if construct to keep the code readable. There are other techniques that you could consider, such as:diffArr(1) = (diffArr(1) < 0)*d.xcount + (diffArr(1) > 0)*diffArr(1);diffArr(2) = (diffArr(2) < 0)*d.ycount + (diffArr(2) > 0)*diffArr(2);diffArr(3) = (diffArr(3) < 0)*d.zcount + (diffArr(3) > 0)*diffArr(3);\u00a0where each element of the diffArr is assigned a value depending on whether it is negative. For example, in the code snippet above, if the first element of diffArr is negative then it is replaced by d.xcount else it is replaced by its present value.If you were replacing all negative elements in an array with the same value (instead of different values: d.xcount, d.ycount, d.zcount), there are other techniques that you could\u00a0consider as well.\u00a0", "num_user_post": " 62", "author": "Adarsh_Murthy"}, {"date": "December 23, 2016 - 1:53 pm", "content": "3 days to search .... but no result!\u00a0Every minutes i've a counter value in a chanel.How can i find a value (juste one !) one (year, day or hour) before ?% For 'now' it's okData1 = thingSpeakRead(202xxx,'Fields', 4, 'ReadKey','1F16B5PPNYxxxxxx');% don't working for\u00a0(year, day or hour) before[Data2, time] = thingSpeakRead(202xxx,'Fields', 4, 'DateRange', [start, stop],'ReadKey','1F16B5PPNYxxxxxx');Thank to you for helpNicolas", "num_user_post": " 5", "author": "nmac"}, {"date": "December 25, 2016 - 2:31 am", "content": "From the documentation:Retrieve the data for August 8, 2014 through August 12, 2014 for fields 1 and 4 of a public channel, including the timestamp, and channel information.[data,time,channelInfo] = thingSpeakRead(12397,'Fields',[1 4],'DateRange',[datetime('Aug 8, 2014'),datetime('Aug 12, 2014')]);Did this not work for you?  Perhaps you are not formatting start and stop correctly- might be helpful if you submit more of your code showing how the start and stop times are derived.  ", "num_user_post": " 271", "author": "rw950431"}, {"date": "December 25, 2016 - 8:11 am", "content": "I've see this documentation but it's not that i want,\u00a0In that case, you have a specific date.In my case I want to differentiate between a value from today and a value from (day or month before).For that i've value of 'now' --> It's easy and oka = thingSpeakRead(202xxx,'Fields', 4, 'ReadKey','1F16B5PPNxxxxxxx');a =\u00a013376742But i can't retrieve the data from there is a me from nowI try lots of things but nothing works; Each time it is to have full valueDate', datetime('start') ???'DateRange', [t1,t2] ???", "num_user_post": " 5", "author": "nmac"}, {"date": "December 25, 2016 - 10:25 am", "content": "Correction about my translation:--> But I can not retrieve a data from a month ago from now", "num_user_post": " 5", "author": "nmac"}, {"date": "December 25, 2016 - 11:47 pm", "content": "Have you tried the datetime(year.month,day,hour,minute,second) format (see https://au.mathworks.com/help/matlab/ref/datetime.html)This works for me using the public channel..% Enter your MATLAB Code below[data] = thingSpeakRead(12397,'Fields',[1 4],'DateRange',[datetime(2014,8,8,0,0,0),datetime(2014,8,8,1,0,0)],'OutputFormat','table')data =   Timestamps  WindDirectionNorth0Degrees TemperatureF ____________________ __________________________ ____________ 08-Aug-2014 00:00:22 0 78.6  08-Aug-2014 00:01:22 270 78.6  08-Aug-2014 00:02:22 270 78.6  08-Aug-2014 00:03:22 225 78.6  08-Aug-2014 00:04:22 135 78.6  08-Aug-2014 00:05:22 315 78.7  08-Aug-2014 00:06:22 45 78.7 ", "num_user_post": " 271", "author": "rw950431"}, {"date": "December 27, 2016 - 10:37 am", "content": "Thank you for help.I've find that i want :%\u00a0Time (month, day, hour ....) Here counter value in one hourt1 = datetime('now') - hours(1);t2 = datetime('now');[b,time,channelInfo] = thingSpeakRead(202xxx,'Fields',[4],'DateRange',[datetime(t1),datetime(t2)], 'ReadKey','1F16B5PPxxxxxxx');%\u00a0Take first & end valuea = b (1);c = b (end);% Diff\u00e9rence between end 1 first valued = c-a;Have a good year 2017 !", "num_user_post": " 5", "author": "nmac"}]}, {"url": "https://community.thingspeak.com/forum/matlab/thingspeakread-table-to-uitable/", "posts": [{"date": "November 11, 2016 - 8:34 am", "content": "Hey guys!I am facing a problem inserting a table with my data from thingspeak to a matlab uitable in guide.\u00a0When I press a button, i run the following code to put the data into the uitable (created with guide before):data = thingSpeakRead(<ChannelID>, 'DateRange',[datetime('Oct 27, 2016'),datetime('Nov 4, 2016')],'OutputFormat','table')set(handles.uitable1,'Data',data);\u00a0and this is the result in the command window:data =Timestamps \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0Fahrer \u00a0 \u00a0 \u00a0 Kilometerstand \u00a0 \u00a0 \u00a0Fahrtgrund ____________________ _________ ______________ ________________27-Oct-2016 18:15:25 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'Initialisieren' 27-Oct-2016 18:17:01 \u00a0 \u00a0 \u00a0217314240 \u00a0 \u00a0 \u00a0 \u00a0 \u00a00 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'Dienstfahrt' 27-Oct-2016 18:17:34 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a013 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0'Fahrtende' 27-Oct-2016 18:18:05 \u00a0 \u00a0 \u00a0741914369 \u00a0 \u00a0 \u00a0 \u00a0 13 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 'Analyse' 27-Oct-2016 18:18:36 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a020 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0 \u00a0'Fahrtende'Error using matlab.ui.control.Table/setWhile setting the 'Data' property of Table:Data must be a numeric, logical, or cell arrayError in Test_Download>pushbutton1_Callback (line 82)set(handles.uitable1,'Data',data);Error in gui_mainfcn (line 95) feval(varargin{:});Error in Test_Download (line 42) gui_mainfcn(gui_State, varargin{:});Error in @(hObject,eventdata)Test_Download('pushbutton1_Callback',hObject,eventdata,guidata(hObject))Error while evaluating UIControl CallbackWhen i don't use the 'OutputFormat','table'-Option in ThingSpeakRead it works, but then the timestamp and the last coloumn with the strings are missing. Which is bad, because they are necessary for my application.I don't know how to access the datatypes properly to get everything running. Can anybody help me with this?\u00a0Thanks a lot!\u00a0", "num_user_post": " 3", "author": "wasted"}, {"date": "November 15, 2016 - 8:08 am", "content": "Hi,\u00a0UITABLE\u00a0is currently supported only on MATLAB Desktop and MATLAB Online. It is not supported on ThingSpeak.An error is generated by\u00a0your code because UITABLE at present does not support TABLE\u00a0and DATETIME\u00a0types in MATLAB. Therefore, when you read data from ThingSpeak with outputFormat set to Table, the returned table isn't supported by UITABLE. To work around this, here is some example code:\u00a0% Read data from a channel as a tabledata = thingSpeakRead(1417, 'DateRange',[datetime('Oct 27, 2016'),datetime('Oct 28, 2016')], 'outputFormat', 'table');% Create an empty\u00a0UITABLEt = uitable;% Convert the timestamps in the table to string format (from datetime type)data.Timestamps = datestr(data.Timestamps);% Convert the table to a MATLAB Cell arraycellData = table2cell(data);% Assign the data to UITABLEt.Data = cellData;Let us know if this doesn't resolve the issue.\u00a0Thanks!", "num_user_post": " 62", "author": "Adarsh_Murthy"}, {"date": "November 17, 2016 - 6:49 am", "content": "Hello Adarsh_Murthy,thank you for your reply. I did the same thing with my table and formated all vectors to cell array data.Here is some example code for others facing the same problem:%%%%%%%%%%%%%%data=thingSpeakRead(channelID, 'DateRange',[datetime(startdatevar),datetime(enddatevar)],'OutputFormat','table')%T1 was datetime-variableT1=data{:,1:1};T1=datestr(T1);T1=cellstr(T1);%T2 is Num-variableT2=data{:,2:2};T2=num2str(T2);T2=cellstr(T2);%T3 is num-variableT3=data{:,3:3};T3=num2str(T3);T3=cellstr(T3);%T4 is cell-variableT4=data{:,4:4};%%%%%%%%%%Thanks again for your help!", "num_user_post": " 3", "author": "wasted"}]}, {"url": "https://community.thingspeak.com/forum/matlab/systemic-expected-shortfall-in-matlab/", "posts": [{"date": "October 30, 2016 - 3:09 pm", "content": "Hi, everyone,I'm a newbie in Matlab seeking to develop my programming skills. I have the following code to compute Systemic Expected Shortfall (SES), as in the paper of Acharya et al. (2010). So, the SES is based on Marginal Expected Shortfall. This code is just for one company, but I have n companies (banks, more precisely) in my sample, everyone having its mes_training_sample, lvg_training_sample, ses_training_sample, mes and lvg. I need a for loop for computing ses for all companies at once, but it's hard at this stage to figure it out. Any info will be useful.Thanks in advance.num_firms = length(mes_training_sample);% RegressorsX = [ones(num_firms,1) mes_training_sample lvg_training_sample];% Regress systemic expected shortfall on marginal expected shortfall and% leveragebetas = regress(ses_training_sample, X);b = betas(2);c = betas(3);ses = (b*mes_firm + c*lvg_firm)/(b+c);", "num_user_post": " 1", "author": "Niqx"}, {"date": "October 30, 2016 - 3:45 pm", "content": "I'm not sure how your question relates\u00a0to ThingSpeak.Since your question is about MATLAB programming, I would encourage you to post your question to the MATLAB\u00a0Community:\u00a0https://www.mathworks.com/matlabcentral/answers/You may also want to look up the MATLAB syntax for loops: https://www.mathworks.com/help/matlab/matlab_prog/loop-control-statements.html", "num_user_post": " 225", "author": "Vinod"}]}, {"url": "https://community.thingspeak.com/forum/matlab/documentation-for-beginner-about-matlab/", "posts": [{"date": "August 24, 2016 - 3:47 am", "content": "Dear All,It seems that I like ThingSpeak service very much but as usually I want to get a little bit more than the standart functionality can offer. For example I colled data from a Gas Meter and do that with real digits. That means that every single update increases number. And always I can see my Gas meter actual values. But I also would like to get momentum values of consumtion with slices 15 or 60 minutes.\u00a0In that case I need to get data from my channel and substract every value precedessor from the current value. Then, as I guess, I need to put these substracted values to a new channel (or field) and build a graph that will show me real consumption for every time period.But the problem is that I don't understand the principles how MatLab (Analyst mostly). And can't route my work into the right direction. Where can I read something on order to understand the language principles, sintaxsys and other core things of the used languages?", "num_user_post": " 28", "author": "kvv213"}, {"date": "August 25, 2016 - 5:25 pm", "content": "Hi,I am not sure if I understand 100% about what you want to achieve, nevertheless I will try to provide my suggestions.Create/Open a\u00a0MATLAB Analysis app.Use the thingSpeakRead function in the MATLAB Analysis to read data from your channel that contains the\u00a0Gas meter actual values.Use the diff function in MATLAB to substract every value precedessor from the current value. (there are also other similar arithmetic MATLAB functions that you can find in this page)Use the thingSpeakWrite function to write the values back into a new a channel.\u00a0There are many built-in MATLAB functions for using basic descriptive statistics. Also, since now ThingSpeak supports MATLAB Toolboxes, you can use advanced MATLAB functions that belong to these toolboxes - some examples of using functions from these toolboxes in ThingSpeak can be found here.If you are looking to learn MATLAB from the basics, you can visit the MATLAB Getting Started page which has links to nice tutorials of how to get started using MATLAB. Also, you have the MATLAB Central where you can ask MATLAB users\u00a0and get responses for any MATLAB related questions that you may have. And you can visit the MATLAB File Exchange\u00a0to find MATLAB code that other MATLAB users have posted that may help you.\u00a0", "num_user_post": " 12", "author": "jvasudev"}, {"date": "August 26, 2016 - 4:48 am", "content": "jvasudev said  If you are looking to learn MATLAB from the basics, you can visit the MATLAB Getting Started page which has links to nice tutorials of how to get started using MATLAB. Also, you have the MATLAB Central where you can ask MATLAB users\u00a0and get responses for any MATLAB related questions that you may have. And you can visit the MATLAB File Exchange\u00a0to find MATLAB code that other MATLAB users have posted that may help you.\u00a0\u00a0\u00a0thank you very much, will try to use these suggestions!", "num_user_post": " 28", "author": "kvv213"}, {"date": "October 7, 2016 - 4:18 am", "content": "jvasudev said  Hi,I am not sure if I understand 100% about what you want to achieve, nevertheless I will try to provide my suggestions.\u00a0\u00a0Hello\u00a0jvasudev,I've manage to realize two new grpahs using ThingSpeak MATLAB Analysis apps. The first app reads twice values from one field and calculates difference between two values in hour time. The pbolem here that not every record in the original field contains data. I update the original channel with 8 fields but not all of them have values at the time of update. So here I get hourly consumption of my gas. And I write it to a new channel.The second app does a little bit different work. It calculates momentum consumption. It uses diff function (I hope that this is a function) and the result is written to a new field. If there are some NaN values that is OK. As I understand from the description they are processed correctly by diff function.So, now I have two new fields with consumption values (hourly and momentum). But I'd like to generate bars graph not ordinary grpah. Is it possible with ThingSpeak somehow?Update: I think that I'll be able to do so with MATLAB Visualization app \ud83d\ude42\u00a0PS. Here are two usefull links for MATLAB and ThingSpeak online reference manuals:http://www.mathworks.com/help/matlab/functionlist.htmlhttp://www.mathworks.com/help/thingspeak/functionlist.htmlThey helped me very much.", "num_user_post": " 28", "author": "kvv213"}, {"date": "October 7, 2016 - 6:31 pm", "content": "You are right. You can use MATLAB Visualization app.checkout 'bar'\u00a0function from MATLAB: https://www.mathworks.com/help/matlab/ref/bar.htmlIn the following article, refer 'Looking at Weekly Sums for Eastbound and Westbound Traffic and Plotting' section to learn more about plotting bar graphs:\u00a0http://makerzone.mathworks.com/blog/counting-cars-and-analyzing-traffic-raspberry-pi-thingspeak/Hope this helps. Feel free to share your final Visualization.\u00a0", "num_user_post": " 8", "author": "Meenakshi"}, {"date": "October 11, 2016 - 11:38 am", "content": "Meenakshi said  You are right. You can use MATLAB Visualization app.checkout 'bar'\u00a0function from MATLAB: https://www.mathworks.com/help/matlab/ref/bar.htmlIn the following article, refer 'Looking at Weekly Sums for Eastbound and Westbound Traffic and Plotting' section to learn more about plotting bar graphs:\u00a0http://makerzone.mathworks.com/blog/counting-cars-and-analyzing-traffic-raspberry-pi-thingspeak/Hope this helps. Feel free to share your final Visualization.\u00a0\u00a0\u00a0Thank you for the good example. I'm already managed to use bar grpah and get something like this:\u00a0\u00a0I use the following code:figure bar(timeStamp, GasImpNow); xlabel('\u0412\u0440\u0435\u043c\u044f'); ylabel('\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435, \u043a\u0431. \u043c.'); title('\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0433\u0430\u0437\u0430 \u0437\u0430 \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 24 \u0447\u0430\u0441\u0430'); ax=gca; %set(gca,'XTickLabel', timeStamp); grid onBut the graph doesn't look pretty. The bars are too thin and the date labels are not very informative. But I can't impruve it easily. If I use XTickLabel I need to convert timeStamp into Strings and I receive just empthy graph. I also tried to collapse timeStamp into only hours because I use 24 hours graph frame but with no success.\u00a0The hard way is to process all the data into a much simplified data. Where I collect all the data into hour frames or something like this.\u00a0", "num_user_post": " 28", "author": "kvv213"}]}, {"url": "https://community.thingspeak.com/forum/matlab/how-to-get-unique-timestamps/", "posts": [{"date": "October 3, 2016 - 1:57 am", "content": "I have the matlab code below but it sometimes fails because of duplicated time-stamps in the data. (this causes 'bar' to fail with 'XData must be unique' error).Wondering how to get a unique set of timestamps then rejoin them to the values (I dont particularly care which of the duplicated values gets matched).\u00a0 My newbie attempts to use the 'unique' function do not work because the row as a whole is considered unique even when the timestamps are the same.\u00a002/10/2016 01:30-436.4302/10/2016 01:30-390.6102/10/2016 01:35-390.6802/10/2016 01:35-390.6% Draw a bar graph of Interconnector power% red for positive, blue for negativepower = thingSpeakRead(150393,'OutputFormat','Table','NumDays',3);pos=unique(power(power.Interconnect > 0,[1,4]));neg=unique(power(power.Interconnect <= 0,[1,4]))figure('position', [0, 0, 1200, 700])bar(datenum(neg.Timestamps),neg.Interconnect,'r','BarWidth',1,'EdgeColor','r')hold onbar(datenum(pos.Timestamps),pos.Interconnect,'b','BarWidth',1,'EdgeColor','b')hold offdatetick('x','ddd dd/mm')title 'South Australian Interconnector Load'ylabel 'Net Power (MW)'legend('Buying Power','Selling Power','Location','northwest')axis 'tight'", "num_user_post": " 271", "author": "rw950431"}, {"date": "October 4, 2016 - 12:32 pm", "content": "Since you are looking to find rows with unique timestamps, call unique() only on Timestamps column.\u00a0I added a couple lines of code to your snippet and it should work now.power = thingSpeakRead(150393,'OutputFormat','Table','NumDays',3);[~, uniqueIndx] = unique(power.Timestamps);power = power(uniqueIndx, :);pos= power(power.Interconnect > 0,[1,4]);neg= power(power.Interconnect <= 0,[1,4]);<insert\u00a0the remaining lines of code>Take a look at the link below for further info about unique() function:https://www.mathworks.com/help/matlab/ref/unique.html\u00a0I am curious about the cause for duplicate timestamps. How are you adding data to channel 150393 - from a device, or MATLAB Script tied to a TimeControl/React or another method? \u00a0", "num_user_post": " 62", "author": "Adarsh_Murthy"}, {"date": "October 4, 2016 - 8:44 pm", "content": "Thanks Adarsh, that worked perfectly.The repeated timestamp appears to be an artefact of the start of daylight savings time. The values are coming from a script that scrapes data off a website : the data includes a timestamp so I use 'created_at' to set this time in the thingspeak record.", "num_user_post": " 271", "author": "rw950431"}]}]}