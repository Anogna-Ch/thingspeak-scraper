{"url": "https://community.thingspeak.com/forum/arduino/page-7/", "threads": [{"url": "https://community.thingspeak.com/forum/arduino/updating-latitude-and-longitude-from-thingspeak-communication-library-for-arduino/", "posts": [{"date": "May 15, 2016 - 11:18 am", "content": "The ThingSpeak\u00a0Communication Library for\u00a0Arduino has location functions:ThingSpeak KEYWORD1begin KEYWORD2writeField KEYWORD2setField KEYWORD2setLatitude KEYWORD2setLongitude KEYWORD2setElevation KEYWORD2writeRaw KEYWORD2writeFields KEYWORD2readFloatField KEYWORD2readIntField KEYWORD2readLongField KEYWORD2readStringField KEYWORD2readRaw KEYWORD2getLastReadStatus KEYWORD2I am unable to get these to work.int setLatitude(float latitude) { #ifdef PRINT_DEBUG_MESSAGES Serial.print('ts::setLatitude(latitude: '); Serial.print(latitude,3); Serial.println('')'); #endif this->nextWriteLatitude = latitude; return OK_SUCCESS; }; /** * @brief Set the longitude of a multi-field update. * To record latitude, longitude and elevation of a write, call setField() for each of the fields you want to write, setLatitude() / setLongitude() / setElevation(), and then call writeFields() * @param longitude Longitude of the measurement (degrees E, use negative values for degrees W) * @return HTTP status code of 200 if successful. See getLastReadStatus() for other possible return values. * @see setField(), setLatitude(), setElevation(), writeFields() * @code void loop() { int sensor1Value = analogRead(A0); float sensor2Voltage = analogRead(A1) * (5.0 / 1023.0); String sensor3Meaning; int sensor3Value = analogRead(A2); if (sensor3Value < 400) { sensor3Meaning = String('Too Cold!'); } else if (sensor3Value > 600) { sensor3Meaning = String('Too Hot!'); } else { sensor3Meaning = String('Just Right'); } long timeRead = millis();ThingSpeak.setField(1, sensor1Value); ThingSpeak.setField(2, sensor2Voltage); ThingSpeak.setField(3, sensor3Meaning); ThingSpeak.setField(4, timeRead); setLatitude(42.2833); setLongitude(-71.3500); setElevation(100); ThingSpeak.writeFields(myChannelNumber, myWriteAPIKey); delay(20000); } * @endcode */The example from the library however does not work and setLatitude() will not compileany help with this would be appreciated12", "num_user_post": " 1", "author": "gregp228"}]}, {"url": "https://community.thingspeak.com/forum/arduino/no-data-transfered-to-thingspeak/", "posts": [{"date": "May 15, 2016 - 4:58 am", "content": "Hello, can anyone help me. I am new in learning about ThingSpeak and Arduino. I want to make send data from LM35 that connected to Arduino to ThingSpeak using Ethernet Shield. The program can be run but ThingSpeak does not update any of the data receive. How do I fixed this? This is the sample code that I have try.Thank You\u00a0#include <SPI.h>#include <Ethernet.h>int val;int tempPin = 0;float tempC;// Local Network Settingsbyte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xEF }; // Must be unique on local network// ThingSpeak Settingschar thingSpeakAddress[] = 'api.thingspeak.com';String writeAPIKey = '24AU1NCYHNIXFYEN';// Variable Setuplong lastConnectionTime = 0;boolean lastConnected = false;int failedCounter = 0;// Initialize Arduino Ethernet ClientEthernetClient client;void setup(){Serial.begin(9600);// Start Ethernet on Arduino startEthernet();}void loop(){ int val = 0; for(int i = 0; i < 10; i++) { val += analogRead(tempPin); delay(200); } float tempC = val*50.0f/1023.0f; char buf[16];// Read value from Input PinString LM35 = dtostrf(tempC,4,1,buf); Serial.println(LM35);// Print Update Response to Serial Monitor if (client.available()) { char c = client.read(); Serial.print(c); } // Disconnect from ThingSpeak if (!client.connected() && lastConnected) { Serial.println('...disconnected'); Serial.println();client.stop(); } // Update ThingSpeak if (!client.connected()) { updateThingSpeak(LM35); delay(25000); } // Check if Arduino Ethernet needs to be restarted if (failedCounter > 3 ) { startEthernet(); } lastConnected = client.connected();}//----- update the Thingspeak string with 1 valuevoid updateThingSpeak(String M){ if (client.connect(thingSpeakAddress, 80)) { String cmd = writeAPIKey +'&field1=' + M; Serial.println('Connecting to ThingSpeak...'); Serial.println('Sending Data'); client.print('POST /update HTTP/1.1'); client.print('Host: api.thingspeak.com'); client.print('Connection: close'); client.print('X-THINGSPEAKAPIKEY: '+writeAPIKey+''); client.print('Content-Type: application/x-www-form-urlencoded'); client.print('Content-Length: '); client.print(cmd.length()); client.print('');client.print(cmd); Serial.println(F('Done')); Serial.println(F('Waiting 30 sec for next sending'));lastConnectionTime = millis(); if (client.connected()) { failedCounter = 0; client.stop(); } else { failedCounter++;Serial.println('Connection to ThingSpeak failed ('+String(failedCounter, DEC)+')'); Serial.println(); }} else { failedCounter++;Serial.println('Connection to ThingSpeak Failed ('+String(failedCounter, DEC)+')'); Serial.println();lastConnectionTime = millis(); }}void startEthernet(){client.stop();Serial.println('Connecting Arduino to network...'); Serial.println();delay(1000);// Connect to network amd obtain an IP address using DHCP if (Ethernet.begin(mac) == 0) { Serial.println('DHCP Failed, reset Arduino to try again'); Serial.println(); } else { Serial.println('Arduino connected to network using DHCP'); Serial.println(); }delay(1000);}//dtostrf (float to String)char *dtostrf (float val, signed char width, unsigned char prec, char *sout){ char fmt[20]; sprintf(fmt, '%%%d.%df', width, prec); sprintf(sout, fmt, val); return sout;}", "num_user_post": " 1", "author": "sheahudson"}]}, {"url": "https://community.thingspeak.com/forum/arduino/thingspeak-and-1sheeld-arduino-shield/", "posts": [{"date": "May 11, 2016 - 3:05 am", "content": "hi there,I have tried to use the Arduino 1sheeld (www.1sheeld.com) to send sensor data to my fields in my thingspeak private channel. That worked fine.Now I'm trying to do the opposit: Getting data from field1,field2,field3 from my private thingspeak channel to trigger 3 LEDs.Does the thingspeak library work with 1sheeld? If not, what should the script in Arduino be without the library used?", "num_user_post": " 1", "author": "dukeofboz"}]}, {"url": "https://community.thingspeak.com/forum/arduino/read-last-value-and-timedate-from-thingspeak/", "posts": [{"date": "May 6, 2016 - 11:10 am", "content": "Hello,I'm trying to read the last value AND the date/time from a private channel to my Arduino. I can easily get the last value using the 'official thingspeak library for arduino' and the 'ReadPrivateChannel'-example.\u00a0But what about the timestamp (date/time) for that last value? It's not a part of the Thingspeak library I think..I can access the last value and the timestamp by a get request and get a return in JSON format (this is my privat channel...):https://api.thingspeak.com/channels/106334/fields/1/last.json?key=J38Y445RB2G9FNL0&timezone=Europe%2FStockholm\u00a0How do I make my Arduino to 'read' this url? I been trying to make a GET request but without any success... =(\u00a0RegardsMattias", "num_user_post": " 10", "author": "mdahlb"}, {"date": "May 8, 2016 - 9:15 pm", "content": "Maybe you have to use readRaw() and parse the string yourself?\u00a0From https://github.com/mathworks/thingspeak-arduino/blob/master/src/ThingSpeak.h/** * @brief Read a raw response from a public ThingSpeak channel * @param channelNumber Channel number * @param URLSuffix Raw URL to write to ThingSpeak as a String. See the documentation at https://thingspeak.com/docs/channels#get_feed * @return Response if successful, or empty string. Use getLastReadStatus() to get more specific information. * @remark This is low level functionality that will not be required by most users. * @code void loop() { String response = ThingSpeak.readRaw(myChannelNumber, String('feeds/days=1')); Serial.print('Response: ');  Serial.print(response); delay(30000); } * @endcode */", "num_user_post": " 271", "author": "rw950431"}, {"date": "May 9, 2016 - 10:20 am", "content": "Thanks!Well, I managed to get the 'age' (in seconds)\u00a0of the most recent entry by adding the following code:String response = ThingSpeak.readRaw(myChannelNumber, String(String('/fields/') + String(1) + String('/last_data_age')), myReadAPIKey); Serial.print('Response: '); Serial.print(response);\u00a0So, I get the age in seconds although then I have to convert it into a date and time. Hmm, I would be more convinient if I just could get the time/date at once..", "num_user_post": " 10", "author": "mdahlb"}]}, {"url": "https://community.thingspeak.com/forum/arduino/how-to-send-sensor-data-to-thingspeak-using-sim-900-for-internet-connection/", "posts": [{"date": "January 27, 2016 - 3:11 am", "content": "hello I am new to thingspeak.I was working with gas sensors. And i wanted to send the sensor data to thingspeak channel that i created. So as to get  the graph of the sensor data. I am using SIM 900 module to get the internet connection. But do not know how to do it. please provide some help to do so. thanks in advance.!", "num_user_post": " 1", "author": "ommakana"}, {"date": "January 27, 2016 - 6:38 pm", "content": "SIM900 + what?  Arduino?  Raspberry Pi?  Something else?You are likely to get more help if you give more detail about your setup..", "num_user_post": " 271", "author": "rw950431"}, {"date": "May 8, 2016 - 3:56 pm", "content": "I made it work with arduino!", "num_user_post": " 10", "author": "mdahlb"}]}, {"url": "https://community.thingspeak.com/forum/arduino/thingspeak-inclusion-causing-undesirable-problems/", "posts": [{"date": "April 20, 2016 - 10:41 am", "content": "I got a very basic program just reading sensor values displayed on thingspeak with live updation w/o even requirement of refreshing the page. Now I wanted to implement it in some other project wherein I want to keep the source voltage at around a fixed decided value in my case it's 14.85V-15V and I am continuously monitoring this value and keeping same by either increasing or decreasing PWM given to the MOSFET and then, also want to display these results of source voltage on thingspeak.Here is my program:\u00a0#include 'TimerOne.h' #include int source_voltage = A0; long int value_temp; float analog(int); float value_temp1; int i=0,j=0; int freq=10; #define DEBUG FALSE //comment out to remove debug msgs//*-- Hardware Serial #define _baudrate 9600//*-- Software Serial // #define _rxpin 0 #define _txpin 1 SoftwareSerial debug( _rxpin, _txpin ); // RX, TX//*-- IoT Information #define SSID 'disha' #define PASS 'fiftyfive55' #define IP '184.106.153.149' // ThingSpeak IP Address: 184.106.153.149// GET /update?key=[THINGSPEAK_KEY]&field1=[data 1]&field2=[data 2]...; String GET = 'GET /update?key=PT41QR66HL1NH8LU';void setup() { pinMode(freq,OUTPUT); pinMode(source_voltage,INPUT); Timer1.initialize(50); // initialize timer1, and set a 1/2 second period Timer1.pwm(10, 0); Serial.begin( _baudrate ); debug.begin( _baudrate );sendDebug('AT'); delay(5000); if(Serial.find('OK')) { debug.println('RECEIVED: OK Data ready to sent!'); connectWiFi(); }}void loop() { char buf[16];while(analog(source_voltage)<15) //this loop maintains source voltage at 15V { i--; if(i<0) i=1; for(j=0;j<=10;j++) Timer1.setPwmDuty(10,i); value_temp1=analog(source_voltage); //source voltage calculated and stored as float value String temp=dtostrf(value_temp1,4,1,buf); //converts float to string as thingpeak accepts only string updateTS(temp); //this calculated value is sent for updation on channeldelay(3000); } i++; if(i>1023) i=1022; for(j=0;j<=10;j++) Timer1.setPwmDuty(10,i); value_temp1=analog(pulse); String temp=dtostrf(value_temp1,4,1,buf); updateTS(temp); delay(3000); //wait as thingspeak updates every 3 seconds } float analog(int x) //subroutine to calculate source voltage { int i=0; int out; out =analogRead(x); float out1=(out/1023.0)*4.9; float out2=((out1)*(21.58+98.24))/(21.58); return(out2); } //----- update the Thingspeak string with 3 values void updateTS( String T) { // ESP8266 Client String cmd = 'AT+CIPSTART='TCP','';// Setup TCP connection cmd += IP; cmd += '',80'; sendDebug(cmd); delay(2000); if( Serial.find( 'Error' ) ) { debug.print( 'RECEIVED: Error Exit1' ); return; }\u00a0cmd = GET + '&field1=' + T +''; Serial.print( 'AT+CIPSEND=' ); Serial.println( cmd.length() ); if(Serial.find( '>' ) ) { debug.print('>'); debug.print(cmd); Serial.print(cmd); } else { sendDebug( 'AT+CIPCLOSE' );//close TCP connection } if( Serial.find('OK') ) { debug.println( 'RECEIVED: OK' ); } else { debug.println( 'RECEIVED: Error Exit2' ); } }void sendDebug(String cmd) { debug.print('SEND: '); debug.println(cmd); Serial.println(cmd); }boolean connectWiFi() { Serial.println('AT+CWMODE=1');//WiFi STA mode - if '3' it is both client and AP delay(2000); //Connect to Router with AT+CWJAP='SSID','Password'; // Check if connected with AT+CWJAP? String cmd='AT+CWJAP=''; // Join accespoint cmd+=SSID; cmd+='',''; cmd+=PASS; cmd+='''; sendDebug(cmd); delay(5000); if(Serial.find('OK')) { debug.println('RECEIVED: OK'); return true; } else { debug.println('RECEIVED: Error'); return false; }cmd = 'AT+CIPMUX=0';// Set Single connection sendDebug( cmd ); if( Serial.find( 'Error') ) { debug.print( 'RECEIVED: Error' ); return false; } }Now in void loop you can see that there is a loop which always maintains the source voltage fixed at around 14.85 or 15V and the same is updated using function :::::----> updateTS(temp);Here some contradictory results I have got that is:1)When I just wanted to check source voltage whether remained at desire value w/o bothering for utilizing thingspeak evreything worked fine.2)But in void loop when I included that functionupdateTS(temp); The source voltage sat at open circuit voltage and the same values got displayed and when i commented that function and very next line i.e delay(3000); everything again worked. Those two code lines are very important for updating on thingspeak what do you'll think? Why is this happening? How can I solve this?", "num_user_post": " 4", "author": "disha"}, {"date": "April 20, 2016 - 11:10 pm", "content": "Note that Thingspeak updates can be no more often than 15 seconds so you need to choose a different service if you want 5 second updates.Adding the call to updateTS() and the delay() adds at least 5 seconds to every iteration of the inner loop so by the time you do this 10 times almost a minute has passed before you can change the voltage at all.Why do you call setPwmDuty() 10 times with the same value?\u00a0 Seems pointless.. the value you set remains active on the pin until you change it.I would try something likev=analog(source_voltage)if (v<14.85) {\u00a0 if (i<1022) i++;}if (v>15.0) {\u00a0 if (i>0) i--;}Timer1.setPwmDuty(10,i)updateTS() // etc\u00a0So at least you can respond every 5 seconds or so.\u00a0If the load is likely to change more rapidly than this it will make it very hard to control it and make regular updates to Thingspeak", "num_user_post": " 271", "author": "rw950431"}]}, {"url": "https://community.thingspeak.com/forum/arduino/trouble-with-due/", "posts": [{"date": "April 20, 2016 - 3:48 pm", "content": "I cannot get any code for my DUE to compile if I include ThingSpeak.h, get the following error:#error Only Arduino Yun, Uno/Mega/Due with either Wired or wi-fi Ethernet shield, ESP8266, and Spark Core/Photon/Electron are supported.My setup is a DUE with the Adafruit CC3000 breakout. The code is literally just the adafruit CC3000 example with '#include <ThingSpeak.h>' at the top. If I remove that library include then the wifi example code works great and connect to my network and successfully pings adafruit.com.\u00a0I have used IDE 1.6.6 and 1.6.8.Any advice would be greatly appreciated.", "num_user_post": " 1", "author": "froggy2288"}]}, {"url": "https://community.thingspeak.com/forum/arduino/arduino-uno-cc3000-wifi-data-stops-sending-after-3-4-times/", "posts": [{"date": "December 15, 2015 - 5:56 pm", "content": "Hello,I am an Arduino newbie, but have succeeded in assembling and programming an Arduino uno with DHT11 and BMP180 and have sent data to Thingspeak via a CC3000 wifi breakout board.  Like others, a wifi connection is established, and data is sent/updated to my ThingSpeak channel about 3 to 4 times before stopping.  I understand that others have mentioned this problem in this forum, but what I have read has been in the context of ethernet connection, not wifi. Being new to Arduino, it is not clear how to adapt their suggestions to the code for CC3000 wifi.   I would greatly appreciate if someone could look at the code I am using (based primarily on http://obaej.blogspot.com/2015/01/ti-cc3000-wifi-and-thingspeak-online.html) and suggest what I might adjust to prevent the data transmission from ceasing.  Some folks have mentioned the warm up time needed by the DHT I believe.  However, I have tried a version that only transmits data from the bmp180 and that produces the same failed transmission after about 4 cycles.  Thank you so much for your time and expertise \ud83d\ude42Here is the code:// Libraries#include#include//#include  // don't need with earlier version of Adafruit_Sensor.h#include  //earlier version was used in Instructable link#include#include#include#include#include 'utility/debug.h'#include 'DHT.h'#include // Define CC3000 chip pins#define ADAFRUIT_CC3000_IRQ   3#define ADAFRUIT_CC3000_VBAT  5#define ADAFRUIT_CC3000_CS    10// temperature and humidity sensor#define DHTPIN 2#define DHTTYPE DHT11DHT dht(DHTPIN, DHTTYPE);Adafruit_BMP085 bmp;// Create CC3000 instancesAdafruit_CC3000 cc3000 = Adafruit_CC3000(ADAFRUIT_CC3000_CS, ADAFRUIT_CC3000_IRQ, ADAFRUIT_CC3000_VBAT,SPI_CLOCK_DIV2); // you can change this clock speed// WLAN parameters#define WLAN_SSID       'WGSKB'#define WLAN_PASS       '8RVQWYWKNWMB3X9K'// Security can be WLAN_SEC_UNSEC, WLAN_SEC_WEP, WLAN_SEC_WPA or WLAN_SEC_WPA2#define WLAN_SECURITY   WLAN_SEC_WPA2// ThingSpeak Settingschar thingSpeakAddress[] = 'api.thingspeak.com';String writeAPIKey = 'WVE8CXSX2QK08RYR';uint32_t ip;// Variable Setuplong lastConnectionTime = 0;boolean lastConnected = false;int failedCounter = 0;void setup(void){  // Initialize  Serial.begin(115200);  ConnectWifi();   //// Connect with Wifi}void loop(void){  //dht.begin(); //added this on Tuesday cause it was in the bmp180_and_dht11 sketch  bmp.begin();    /* Display atmospheric pressue in hPa */  float p = (bmp.readPressure()/100.0);  Serial.print('Absolute Pressure = ');  Serial.println(p); /*this is where I need to change the code to convert to QHN pressure */  // Get data & transform to integers  float h = dht.readHumidity();  float t = dht.readTemperature(true); //fahrenheit  float hif = dht.computeHeatIndex(t, h);  Serial.print('Temperature = ');  Serial.println(t);  Serial.print('Humidity = ');  Serial.println(h);  Serial.print('Heat Index = ');  Serial.println(hif);  int temperature = (int) t;  int humidity = (int) h;  int heatindex = (int) hif;  int pressure = (int) p;  String tem=String(temperature, DEC); //Thingspeak only data stream is string type  String hum=String(humidity, DEC);    // Converting integer data to string  String heat=String(heatindex, DEC);  String pr =String(pressure, DEC);  Serial.print(F('api.thingspeak.com -> '));  while  (ip  ==  0)  {    if  (!  cc3000.getHostByName('api.thingspeak.com', &ip))  {      Serial.println(F('Couldn't resolve!, Restarting.....'));      wdt_enable(WDTO_8S);                  // if host does not response wait 8 sec and restart      while(1){}    }    delay(500);  }   cc3000.printIPdotsRev(ip);  Serial.println(F(''));   Adafruit_CC3000_Client client = cc3000.connectTCP(ip, 80);   // Print Update Response to Serial Monitor  if (client.available())  {    char c = client.read();    Serial.print(c);  } // Update ThingSpeak  if(client.connected())  {    // Send temperature and humidity data to Thingspeak site    updateThingSpeak('1='+tem+'&2='+hum+'&3='+pr+'&4='+heat);    delay(25000);   // Thingspeak needs a 15s delay between 2 data stream.    failedCounter=0;  }  else  {  Serial.println(F('Connection failed'));  failedCounter++;  if (failedCounter==10)  {    Serial.println(F('Connection failed for 10 times, Restarting......'));    wdt_enable(WDTO_8S);   // if 10 continuous data upload failed, restart host after 8s.    while(1){}  }  }}void updateThingSpeak(String tsData){    Adafruit_CC3000_Client client = cc3000.connectTCP(ip, 80);    Serial.println('Connecting to ThingSpeak...');    Serial.println('Sending Data');    client.print('POST /update HTTP/1.1');    client.print('Host: api.thingspeak.com');    client.print('Connection: close');    client.print('X-THINGSPEAKAPIKEY: '+writeAPIKey+'');    client.print('Content-Type: application/x-www-form-urlencoded');    client.print('Content-Length: ');    client.print(tsData.length());    client.print('');    client.print(tsData);    Serial.println(F('Done'));    Serial.println(F('Waiting 30 sec for next sending'));    Serial.println('_________');}void ConnectWifi(){   Serial.println(F('Initializing...'));  if (!cc3000.begin())  {    Serial.println(F('Couldn't begin()! Check your wiring?'));    while(1);  }  // Connect to WiFi network  cc3000.connectToAP(WLAN_SSID, WLAN_PASS, WLAN_SECURITY);  Serial.println(F('Connected!'));  /* Wait for DHCP to complete */  Serial.println(F('Request DHCP'));  while (!cc3000.checkDHCP())  {    delay(100);  }  }Here is the printout to my serial monitor where it failed on the second transmission.  What is wrong that the code does not allow reconnection to ThingSpeak?Initializing...Connected!Request DHCPAbsolute Pressure = 992.42Temperature = 68.00Humidity = 46.00Heat Index = 66.66api.thingspeak.com -> 144.212.80.11Connecting to ThingSpeak...Sending DataDoneWaiting 30 sec for next sending_________Absolute Pressure = 992.44Temperature = 68.00Humidity = 46.00Heat Index = 66.66api.thingspeak.com -> 144.212.80.11", "num_user_post": " 1", "author": "jbrh530"}, {"date": "December 16, 2015 - 9:57 am", "content": "Hi,It looks like the Adafruit_CC3000_Client class is a standard Arduino TCP client, which means that you could pass it into the ThingSpeak Communication Library for Arduino (it looks similar to the wi-fi shield).  This has been heavily tested and reliably sends data.More info on the library:http://community.thingspeak.com/2015/10/official-thingspeak-library-for-arduino-and-particle/See if you can get the examples working with your connection, and let us know how it goes.-Rob", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "April 12, 2016 - 1:54 pm", "content": "I would also like to point out\u00a0the actual ThingSpeak IP address incase you have an issue with this code in the future. The offical static IP for ThingSpeak is 184.106.153.149 found here (http://www.mathworks.com/help/thingspeak/channel-settings.html#endpoints).", "num_user_post": " 402", "author": "Hans"}]}, {"url": "https://community.thingspeak.com/forum/arduino/updating-multiple-fields-to-thingspeak/", "posts": [{"date": "March 12, 2016 - 2:05 am", "content": "hello,actually i m using 4 fields in a channel. in that i have used first field for updating the moisture sensor data and i wann  use fields 2,3,4 for updating dht11 sensor data i.e field 2 for temperature , field 3  for humidity, and field 4 for dew points. but i m not able update all the 4 fields at a time though i have multiple fields in channel setting, just the field 1 is getting updated.", "num_user_post": " 5", "author": "sushma"}, {"date": "March 12, 2016 - 7:34 am", "content": "What does your command look like?", "num_user_post": " 402", "author": "Hans"}, {"date": "March 23, 2016 - 1:42 am", "content": "Hans said What does your command look like?thank you.the code is,// This sketch uses a DHT11 sensor to report temperature, humidity and dew point data to http://www.thingspeak.com.//// Sketch tested with an Arduino Uno, a HanRun Ethernet shield and a DHT11 temperature and humidity sensor.//// See http://playground.arduino.cc/main/DHT11Lib for the origins of the temperature, humidity and dew point functions.#include#include#include // ThingSpeak Settingschar thingSpeakAddress[] = 'api.thingspeak.com';String writeAPIKey = '99E4E2IDC9Y8J59B'; // Add your Thingspeak API key hereEthernetClient client;// Temperature sensor settingsdht DHT;#define DHTPIN 6const int ONE_MINUTE = 60 * 1000;int status;int failedConnectionAttempCounter;//Rounds down (via intermediary integer conversion truncation)//See : http://lordvon64.blogspot.co.uk/2012/01/simple-arduino-double-to-string.htmlString dblToString(double input, int decimalPlaces){  if( decimalPlaces != 0)  {    String string = String((int)(input*pow(10,decimalPlaces)));    if(abs(input)  0)      {        string = '0' + string;      }      else if(input  3 )    {      Serial.println('Re-starting the ethernet connection...');      connectToInternet();      failedConnectionAttempCounter = 0;    }  }}", "num_user_post": " 5", "author": "sushma"}, {"date": "March 23, 2016 - 12:57 pm", "content": "sushma said hello,actually i m using 4 fields in a channel. in that i have used first field for updating the moisture sensor data and i wann  use fields 2,3,4 for updating dht11 sensor data i.e field 2 for temperature , field 3  for humidity, and field 4 for dew points. but i m not able update all the 4 fields at a time though i have multiple fields in channel setting, just the field 1 is getting updated.---------------------Hi,Here is sample code from a Kickstarter  project that shows a way  update multiple fields with one write. It worked for me on my water meter project. Larry// This #include statement was automatically added by the Particle IDE.#include 'ThingSpeak.h'// This #include statement was automatically added by the Particle IDE.#include 'Adafruit_DHT/Adafruit_DHT.h'// Sensor type#define DHTTYPE DHT22      // DHT 22 (AM2302)// DHT22 sensor pinout:// Pin 1 (on the left): +3.3V// Pin 2: output// Pin 4 (on the right): GROUND#define DHT_5V_PIN D1#define DHT_SENSOR_PIN D2#define DHT_GROUND_PIN D4DHT dht(DHT_SENSOR_PIN, DHTTYPE);/* Thingspeak */TCPClient client;unsigned long myChannelNumber = 89137;const char * myWriteAPIKey = '3D23PQHQIJ3OZXNF';void setup() {    // Connect to ThingSpeak    ThingSpeak.begin(client);    // Give power to the sensor    pinMode(DHT_5V_PIN, OUTPUT);    pinMode(DHT_GROUND_PIN, OUTPUT);    digitalWrite(DHT_5V_PIN, HIGH);    digitalWrite(DHT_GROUND_PIN, LOW);    // Wait for the sensor to stabilize    delay(1000);    // Initialize sensor    dht.begin();    // Read Sensor    double temperature = dht.getTempCelcius();    double humidity = dht.getHumidity();    // Update the 2 ThingSpeak fields with the new data    ThingSpeak.setField(1, (float)temperature);    ThingSpeak.setField(2, (float)humidity);    // Write the fields that you've set all at once.    ThingSpeak.writeFields(myChannelNumber, myWriteAPIKey);    // Give time for the message to reach ThingSpeak    delay(5000);    // Sleep for 15 minutes to save battery    System.sleep(SLEEP_MODE_DEEP, 15 * 60);}void loop() {    // This will run because the system is sleeping}", "num_user_post": " 8", "author": "wheato22"}, {"date": "March 25, 2016 - 5:54 am", "content": "thank you sir,i will try it.", "num_user_post": " 5", "author": "sushma"}, {"date": "March 25, 2016 - 6:07 am", "content": "i tried the code given above but it is showing compilation error at command 'Adafruit_DHT/Adafruit_dht.h'", "num_user_post": " 5", "author": "sushma"}]}, {"url": "https://community.thingspeak.com/forum/arduino/my-water-meter-reading-app-communication-with-thingspeak/", "posts": [{"date": "March 6, 2016 - 8:11 pm", "content": "I've about given up trying to get my water meter reader app to upload data to my ThingSpeak channel using Arudino and a wired Ethernet shield.  Being a non-programmer I have tried to use published examples designed for analog inputs to work with my interrupt driven app. I have tried co cobble my app into  both the HTTP POST and  and  ThingSpeak.write Voltage Examples. In both cases compile errors have dogged me to submission.  If anyone can suggest some upload code that will play nicely with my interrupt driven counter code (below) and pave the way to upload my serial.print output to channel 1 I'd appreciate the help . ThingSpeak seems like a perfect way to visualize water use in real time... Particularly here in the western US, water use allocations are in effect . /* Water Meter Flow Application----  authored by L. Wheaton, 2015   * Sub-meter outputs a pulse every gallon of flow   * Hall device connected to digital pin 2 creates interrupt   * Interrupt handler increments gallon counter   * accumulated gallon count print and uploads every 20 seconds   */    byte sensorInterrupt = 0;    byte sensorPin       = 2;    volatile byte pulseCount;    unsigned int gallons;    unsigned long oldTime;   void setup(){    Serial.begin(9600);    pinMode(sensorPin, INPUT);    digitalWrite(sensorPin, HIGH);    pulseCount        = 0;    oldTime           = 0;    attachInterrupt(sensorInterrupt, pulseCounter, FALLING);}void loop(){    // Sets xmit every 20 seconds    if((millis() - oldTime) > 20000)  {   // Disable interrupts while calculating   detachInterrupt(sensorInterrupt);   oldTime = millis();   gallons = (gallons + pulseCount);   // Prints gallon flow and Total   Serial.print('Pulse:  ');   Serial.print(pulseCount);   Serial.print('  Gallons: ');   Serial.println(gallons);   pulseCount = 0;   // Enable interrupts again   attachInterrupt(sensorInterrupt, pulseCounter, FALLING);  }}// interrupt handlervoid pulseCounter(){  pulseCount++;}", "num_user_post": " 8", "author": "wheato22"}, {"date": "March 7, 2016 - 10:58 am", "content": "Hi,Sorry you're having so much trouble.   I wonder if attaching and detaching the interrupts is the culprit.  It might be disrupting other things that depend on interrupts, like the ethernet card.  You might refactor your code a bit to use noInterrupts(), copy out the value of pulseCounter,reset it, turn on interrupts again using  interrupts(), and then do the calculations, serial stuff, and the write to ThingSpeak.  Presumably, there's no risk of having more than 255 gallons of water used in 20 seconds, right?// Disable interrupts while reseting pulse countnoInterrupts();pulseCountCopy = pulseCount;pulseCount = 0;// Enable interrupts againinterrupts();//calculateoldTime = millis();gallons = (gallons + pulseCountCopy );// Prints gallon flow and TotalSerial.print('Pulse: ');Serial.print(pulseCountCopy );Serial.print(' Gallons: ');Serial.println(gallons);pulseCount = 0;", "num_user_post": " 47", "author": "Rob Purser"}, {"date": "March 7, 2016 - 11:46 pm", "content": "Are you able to get the unedited 'Write Voltage' sketch to work with your Arduino and thingspeak?  (https://github.com/mathworks/thingspeak-arduino/tree/master/examples/WriteVoltage)This will ensure that your software environment is correctly configured.   Many problems occur because of choosing the wrong board type in the IDE or not installing all the libraries you need. You also need to update that sketch with your own thingspeak channel and API key.If this step fails then post the error messages you get and maybe we can help some more.If that succeeds I suggest you change pulseCount as followsvolatile unsigned long int pulseCount=0;add your interrupt service routine to the WriteVoltage code and send this value in place of  voltage like soThingSpeak.writeField(myChannelNumber, 1, pulseCount, myWriteAPIKey);I wouldn't bother attaching and detaching the interrupt each time you send.  If you want a rate rather than a cumulative total make a last_pulseCount and subtract it from the current value.", "num_user_post": " 271", "author": "rw950431"}, {"date": "March 13, 2016 - 3:09 pm", "content": "Hi Rob and RW,Rob's Points above are on target. Water pulses arrive at a max rate of 10/minute. No need to disable interrupt handler since it takes microseconds to do the math. I'll give that a try to eliminate interactions with the Ethernet routine. Other's doing water meter apps usually count the spinning leak detector in the meter and it pulses 1000's of times per gallon.  I'll eliminate off/on interrupts code and testRW identifies my  fundamental  knowledge gap of Arudino programming.   I have had no sure idea how to correctly merge my Water Count void loop (which works standalone) with the the Ethernet example.  I understand the only one 'void setup()' concept but need help on how to structure the multiple routines 'void loops' on one big Sketch.  I'll try RW's  'Write Voltage' example first with my  specific Ethernet shield and and get that working.  Then add my Water Sketch without  'disabling' interrupts between pulses .    Thanks for the help. Larry", "num_user_post": " 8", "author": "wheato22"}, {"date": "March 21, 2016 - 1:52 am", "content": "Can anyone give me some assistance in getting a second Channel working. When  I compile a Sketch with a second channel write i get an error for the following write instruction. (ThingSpeak.writeField(myChannelNumber,2, gallons ,myWriteAPIKey);)  'call of overloaded 'writeField(long unsigned int&, int, long unsigned int&, const char*&)' is ambiguous' I'm thinking it's related to the fields data type but have no idea on how to fix. My Sketch follows... Larry***************************// Logs flow in gallons/minute from residential water meter #include 'ThingSpeak.h'#includebyte mac[] = { 0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED};EthernetClient client;unsigned long myChannelNumber = 90870;const char * myWriteAPIKey = 'xxxxxxxx';byte sensorInterrupt = 0;byte sensorPin       = 2;volatile byte pulseCount;unsigned long oldTime;unsigned long gallons;void setup(){  Ethernet.begin(mac);  ThingSpeak.begin(client);  Serial.begin(9600);  pinMode(sensorPin, INPUT);  digitalWrite(sensorPin, HIGH);  gallons           = 0;  pulseCount        = 0;  oldTime           = 0;  attachInterrupt(sensorInterrupt, pulseCounter, RISING);}void loop(){  if((millis() - oldTime) > 60000)  {  oldTime = millis();  gallons = (gallons + pulseCount);  Serial.print('Pulse:  ');  Serial.print(pulseCount);  Serial.print('  Gallons: ');  Serial.println(gallons);  ThingSpeak.begin (client);  ThingSpeak.writeField(myChannelNumber,1, pulseCount ,myWriteAPIKey);  ThingSpeak.writeField(myChannelNumber,2, gallons ,myWriteAPIKey);  pulseCount = 0;  }}void pulseCounter(){  pulseCount++;}", "num_user_post": " 8", "author": "wheato22"}, {"date": "March 21, 2016 - 11:46 pm", "content": "Try changing the type of 'gallons' to long rather than unsigned long and see if that helpseglong gallons;", "num_user_post": " 271", "author": "rw950431"}]}, {"url": "https://community.thingspeak.com/forum/arduino/megaethernet-shield-uploading-thingspeak-channels/", "posts": [{"date": "March 10, 2016 - 4:39 pm", "content": "I'm new on this forum, and quite new on Arduino and programming in general.Hi all,I've developed a quite elementary code to upload three fields (one int, one float, and one text string) in a TS channel.This code includes ThngSpeak Arduino library. The code works quite fine..... but there is a but.... \ud83d\ude42 ... nay, three but... - Data are sent every 30*1000ms. I can change 30 in a range from 15 to 30 with no problem, but if I try a longer time frame (1 mins or more) there are not data uploaded on TS. Nothing else is changed in the code, except for the value in the delay command. In fact my final goal will be to have data sent every hour or so. Any suggestion why?- When I set 30 secs as delay time, data are updated sometimes twice per mins, but mostly once every two or three minutes (this seems to be quite randomly). Why?- When I let the script running overnight, I find in the morning only 100 readings for each of the three fields in the same channel. I mean, only 100 lines. What is the limit storage size allocated for each Tingspeak channel?I appreciate very much any suggestion from anyone can help me.Many thanks!!!!Corrado", "num_user_post": " 1", "author": "corbru"}]}, {"url": "https://community.thingspeak.com/forum/arduino/arduino-with-ethernet-shield-stop-working-after-a-1-hours/", "posts": [{"date": "March 3, 2016 - 6:11 am", "content": "I used the sketch you have written above. Or other examples found in this site.I have an Arduino Mega with ethernet shield W5500 processor with.Log ambient temperature every two minutes.Everything works properly, but after about an hour, telling me error in the connection to the site. To make it work I have to power cycle.I also tried it with several other ethernet shields (W5100, W5200), but the result and the same.Possible that these ethernet shield do not work all the time and always give problems? If so, it would be only of disappointments.Someone managed to make it all work?Steven", "num_user_post": " 1", "author": "superzaffo"}]}]}