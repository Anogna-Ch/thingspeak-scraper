{"url": "https://community.thingspeak.com/forum/thingspeak-api/page-13/", "threads": [{"url": "https://community.thingspeak.com/forum/thingspeak-api/does-thingspeak-mqtt-support-relative-timestamp-delta_t-instead-of-absolute-created_at-just-like-in-rest-api/", "posts": [{"date": "August 20, 2017 - 10:13 am", "content": "Hi, ThingSpeak's REST API declares support for relative timestamps in bulk updates (see https://www.mathworks.com/help/thingspeak/bulk-update-a-channel-feed-1.html). One just need to set\u00a0delta_t field instead of created_atDoes anybody know if MQTT supports the same?Spec does not mention it, but who knows, maybe TS has not yet updated it.", "num_user_post": " 3", "author": "Pavlo"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/not-getting-sms-this-evening/", "posts": [{"date": "August 16, 2017 - 11:17 pm", "content": "Hi,\u00a0I have an Arduino app that has been running just fine for a while now and tonight SMS messages through the Thingspeak api are not going through. I checked the Arduino side and the api seems to be fine - getting the expected responses from the api. But no SMS going through.\u00a0Anyone else seeing a similar problem?\u00a0Thanks.\u00a0", "num_user_post": " 7", "author": "irasch"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/count-elapsed-hours/", "posts": [{"date": "August 8, 2017 - 11:39 pm", "content": "Hi All, I have a ds18b20 temp sensor\u00a0on an esp8266\u00a0-13 uP updating one of my channels every couple of minutes. The board is running from a 10000mAh power bank and based on my calculations it should run for about 200 hours. I'm just testing at the moment so I'm deleting all the data in the channel and starting afresh each time I replace the batteries. So, I wondering how I could keep track of how many hours I've\u00a0been\u00a0running with Matlab code and save the (count) calculation to a field on the channel. I'm already running\u00a0code that looks up the max and min temp for the last 24 hours every five minutes so I could place the snippet of code there, I just don't\u00a0know how to go about doing the counting of elapsed hours from initial power up, I do know how to save data to a field.Any thought, ideas, hints, examples?", "num_user_post": " 9", "author": "viiartz"}, {"date": "August 10, 2017 - 10:52 am", "content": "If you are trying to do it on the device, I think you may be able to use the millis() function to do this task. \u00a0It gives the number of miliseconds since startup. \u00a0If you want to do it in MATLAB, now will give you the present time that you can save, and then use datetime to manipulate the dates.", "num_user_post": " 401", "author": "cstapels"}, {"date": "August 13, 2017 - 2:44 am", "content": "I decided to keep track of uptime on the device (ESP8266 ESP-13). I based my solution on a sketch I came across here https://goo.gl/u63bwUSo, I generate a string (ie '2-21-45') where the first digit is the elapsed days next is the hours and the last digit is the minutes. Upload to field3 of my channel I use a bit of javascript generate the text posted on the web page (ie\u00a0uptime\u00a02 Day, 21 Hour, 45 Minute).", "num_user_post": " 9", "author": "viiartz"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/mqtt-losing-data/", "posts": [{"date": "July 4, 2017 - 2:45 pm", "content": "Hi, i have an ESP8266 thing that has been flawlessly logging data for months, one data point per minute.However I recently realised that it is now skipping quite a lot of points, sometimes going for 8-10 minutes without logs.I tried the following:1) stripped down the code to the bare minimum, no difference2) I eventually even tried the Arduino example on the thingspeak site, it behaves exactly the same3) I recorded the traffic with tcpdump/wireshark. It appears that all is in order, flawless TCP conversationMy conclusion is that ThingSpeak MUST have changed something on the server side.Anyone experiencing the same?", "num_user_post": " 10", "author": "MarcFinns"}, {"date": "July 7, 2017 - 10:43 am", "content": "I'm seeing some loss of data points as well, I'm looking into it.", "num_user_post": " 34", "author": "JasonW"}, {"date": "July 8, 2017 - 4:41 am", "content": "Please keep us posted. The loss I am seeing is in the range of 35-45%.Let me know if you need more details. Thank you!", "num_user_post": " 10", "author": "MarcFinns"}, {"date": "July 8, 2017 - 11:21 am", "content": "Marc,Thank you for reporting the issue. We are working to identify a fix and will post when it is resolved.While we work to resolve this is it possible to switch your device to use the REST API?Take a look at this\u00a0example on how to use the REST API to do bulk updates. It has the added benefit that you may be able to send your device to sleep between sending data to the server, potentially extending the battery life for battery powered devices.-Vinod", "num_user_post": " 225", "author": "Vinod"}, {"date": "August 9, 2017 - 3:26 pm", "content": "Marc,We're made some changes to the MQTT broker that will hopefully stop that behavior from happening in the future.If you are continuing to see data loss, please let us know!Jason", "num_user_post": " 34", "author": "JasonW"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/getting-channel-out-put-as-a-single-value/", "posts": [{"date": "August 9, 2017 - 12:31 am", "content": "I was trying to get my channel field using\u00a0https://api.thingspeak.com/channels/xxxxx/fields/1.json?api_key=xxxxxxxxxxxxx&results=1but i got out put as {'channel':{'id':313504,'name':'ab','latitude':'0.0','longitude':'0.0','field1':'led','created_at':'2017-08-06T06:00:05Z','updated_at':'2017-08-09T03:40:53Z','last_entry_id':343},'feeds':[{'created_at':'2017-08-08T16:08:54Z','entry_id':342,'field1':'100'},{'created_at':'2017-08-09T03:40:53Z','entry_id':343,'field1':'500'}]}I want the output as 500 only printed in my screen I am a beginner in app development using mit app inventor and i wanted this printed in my app using this address ", "num_user_post": " 1", "author": "maneesh.marian"}, {"date": "August 9, 2017 - 9:25 am", "content": "If you just want the last entry, you can use the instructions here. \u00a0For example, use the format\u00a0https://api.thingspeak.com/channels/12397/fields/1/last.txtIf you don't want the last entry, you can use the entry id:https://api.thingspeak.com/channels/9/fields/1/6061519.txt", "num_user_post": " 401", "author": "cstapels"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/query-data-field-for-javascript-dependency/", "posts": [{"date": "July 31, 2017 - 10:35 am", "content": "Not sure if this is already doable...\u00a0In my JavaScript I have a number of variables as shown:\u00a0stop = new google.maps.LatLng(49.093914487013, -117.71569423377514)waypts.push({location: stop,stopover: true\u00a0The line in Bold\u00a0is what I need help with. I have data transmitted to Thingspeak. I have an API that allows me to select the exact value to query; what I need to know is how to use a GET statement (Or anything that would work) to have that Stopover\u00a0line be True or False based on the result. So IF the result queried by the API is over 8, it's TRUE, if it's under it is false.\u00a0The API line looks like this:\u00a0\u00a0GET https://api.thingspeak.com/channels/****/fields/1.json?results=2So How do I set that Bold\u00a0field to query this and either be TRUE or FALSE based upon the result of this query?\u00a0If you need any more info please reply and I can fill in any blanks, but I'm reallllly needing some help here.\u00a0Thank you!\u00a0\u00a0", "num_user_post": " 8", "author": "jteindl"}, {"date": "August 8, 2017 - 3:23 pm", "content": "You may be able to use jquery:$.getJSON('https://api.thingspeak.com/channels/' + channel_id + '/fields/1.json?api_key=' + api_key , function(data) {\u00a0if (data.feeds==....) \u00a0 //Do your check here})You may need to load the library first:https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js", "num_user_post": " 401", "author": "cstapels"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/json-query-in-js-to-define-variable-based-on-result/", "posts": [{"date": "August 2, 2017 - 12:43 pm", "content": "This is my code:\u00a0var bin1;\u00a0function loadData() {\u00a0//\u00a0 $.getJSON('https://api.thingspeak.com/channels/276256/field/2/last.json?apikey=LP74006MCJC*****&callback=?', function(data) {\u00a0\u00a0\u00a0 bin1 = data.field2;\u00a0//\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 if (bin1\u00a0 > 40) {bin1 = 'True';} else\u00a0 {bin1 = 'False';\u00a0 }});\u00a0I am trying to say, look at the result of Field2 using the Thingspeak API string, if the result is > 40 then define 'bin1' as TRUE, else define as FALSE\u00a0What am I doing wrong....?", "num_user_post": " 8", "author": "jteindl"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/thinghttp-using-esp8266/", "posts": [{"date": "July 29, 2017 - 5:03 am", "content": "Hello everyone, i am fairly new to this community. I am currently working on ThingHTTP with ESP8266 nodeMCU. My little project should read in total subscribers from youtube channel and lets say for now print them out to the serial monitor.\u00a0I have created a new ThingHTTP and filled in URL, parsing string and method. After the link was generated i clicked into it and it seems to be working just fine, while displaying only the total number of subscribers. Now, the problem is the code itself.. i don't know how to properly call the function and how it should be printed out to the serial. I would really appreciate some help here.\u00a0There is my code so far :\u00a0\u00a0#includeconst char* ssid = 'ssidName';const char* password = 'password';const char* host = 'api.things.com';const char URL_youtube[] = 'GET\u00a0https://api.thingspeak.com/apps/thinghttp/send_request?api_key=XXXXXXXXXXXXXXX\u00a0HTTP/1.0';void setup() {Serial.begin(115200);delay(10);WiFi.begin(ssid, password);Serial.println();Serial.println();Serial.print('tConnecting to: ');Serial.println(ssid);while (WiFi.status() != WL_CONNECTED) {delay(100);Serial.print('.');}Serial.println('');Serial.println('tWiFi Connected');}void loop() {getYoutube();delay(15000);}\u00a0void getYoutube() {if (WiFi.status() == WL_CONNECTED) {// function goes here}}", "num_user_post": " 2", "author": "RytisBe"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/multiple-24-hour-periods-as-separate-plots-in-one-chart/", "posts": [{"date": "July 21, 2017 - 5:44 pm", "content": "I can plot 48 hours of data in one plot, for example I ask forhttps://api.thingspeak.com/channels/304707/charts/1?width=900&height=600&timescale=10&days=2and I get a plot like: https://photos.app.goo.gl/TUQnBL7kfxwzwfbl2That's good. Now, is it possible to plot that same data using only 24 hours on the horizontal axis, and two separate traces for each day's data, so if for example today is a little warmer than yesterday, the second trace sits a little above the first one?The point is to better compare day-over-day differences at each hour of the day. \u00a0If that is possible, how? \u00a0Thanks for any help!", "num_user_post": " 3", "author": "jbeale1"}, {"date": "July 24, 2017 - 4:26 pm", "content": "MATLAB and ThingSpeak have many options for plotting. \u00a0Take a look at the documentation for thingSpeakPlotYY. \u00a0Also thingSpeakRead to see the options for reading dates.Here is one possibility you can use in MATLAB visualization.dataToday=thingSpeakRead(304707,'DateRange',[datetime('today')-caldays(1),datetime('today')],'OutputFormat','Timetable');dataYesterday=thingSpeakRead(304707,'DateRange',[datetime('today')-caldays(2),datetime('today')-caldays(1)],'OutputFormat','Timetable');thingSpeakPlotYY(1:height(dataToday),dataToday.G_Battery,1:height(dataYesterday),dataYesterday.G_Battery);", "num_user_post": " 401", "author": "cstapels"}, {"date": "July 26, 2017 - 1:53 am", "content": "Thank you very much for that suggestion! That code works fine for two lines showing two days. Then I tried to extend to 3 lines for 3 days, and using all the same X and Y axes (instead of double-Y axis type) so I used the matlab 'plot' command with three (X,Y) data pairs. It works fine without error for the G_Battery and Garage channel, but fails on the third channel 'Shed' saying 'Error using plot\u00a0\u00a0Invalid second data argument \u00a0\u00a0Error in Custom (no starter code) 3 (line 17)\u00a0\u00a0plot(x1,y1,x2,y2,x3,y3);'Here is the code I'm trying (the commented-out lines work OK)d1=thingSpeakRead(304707,'DateRange',[datetime('today')-caldays(1),datetime('today')],'OutputFormat','Timetable'); d2=thingSpeakRead(304707,'DateRange',[datetime('today')-caldays(2),datetime('today')-caldays(1)],'OutputFormat','Timetable'); d3=thingSpeakRead(304707,'DateRange',[datetime('today')-caldays(3),datetime('today')-caldays(2)],'OutputFormat','Timetable');% x1=1:height(d1); y1=d1.G_Battery; % x2=1:height(d2); y2=d2.G_Battery; % x3=1:height(d3); y3=d3.G_Battery;% x1=1:height(d1); y1=d1.Garage; % x2=1:height(d2); y2=d2.Garage; % x3=1:height(d3); y3=d3.Garage;x1=1:height(d1); y1=d1.Shed; x2=1:height(d2); y2=d2.Shed; x3=1:height(d3); y3=d3.Shed;plot(x1,y1,x2,y2,x3,y3);", "num_user_post": " 3", "author": "jbeale1"}, {"date": "July 28, 2017 - 2:03 pm", "content": "The field for shed has some text data in it, so thingspeak is providing those as character vectors. \u00a0The plot() function won't plot characters. \u00a0There may be a function that exists to remove those from a cell array. \u00a0You could also just remove the text values, or put a loop in to remove them with an element by element search. \u00a0Be careful to write the elements you keep back to a type of double - when you read character arrays, MATLAB chooses to male the variable a cell array", "num_user_post": " 401", "author": "cstapels"}, {"date": "July 28, 2017 - 10:36 pm", "content": "Ah, thank you, I didn't realize that since the default graph plot still worked for the Shed channel. Maybe it is a stray CR-LF at the end of line. \u00a0I changed the source Python code to convert incoming data string to float and then print that back into a string to add to the 'GET https://...' line, hopefully that will work, thanks again!", "num_user_post": " 3", "author": "jbeale1"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/exporting-data-with-local-time-instead-of-utc/", "posts": [{"date": "July 25, 2017 - 5:50 pm", "content": "Hi,I'm not sure if this is the right place to post the question. I was wondering if it was possible for the data export function to return local time as set in my profile instead of UTC?Cheers,Michael.", "num_user_post": " 1", "author": "toofargone"}, {"date": "July 25, 2017 - 10:40 pm", "content": "You can set the timezone on a API call but adding the &timezone= parameter see https://au.mathworks.com/help/thingspeak/time-zones-reference.html dor details.\u00a0Not sure about the data export button on the website.", "num_user_post": " 271", "author": "rw950431"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/http-get-in-javascript/", "posts": [{"date": "July 25, 2017 - 4:04 pm", "content": "\u00a0I am working in JavaScript and need to pull data from one field on my Thingspeak chart. This is the piece of code I am working with:\u00a0stop = new google.maps.LatLng(49.093914487013, -117.71569423377514)waypts.push({location: stop,stopover: true\u00a0The line in\u00a0Bold\u00a0is what I am trying to set a dependency on. How do I do an If/Else statement essentially to pull from a field on my Thingspeak chart, and say if the value is >8\u00a0stopover: true\u00a0and if value is <8\u00a0stopover: false\u00a0So how would I call a field to get the value and set the if/else based on that?\u00a0\u00a0Thank you in advance for your help!", "num_user_post": " 8", "author": "jteindl"}]}, {"url": "https://community.thingspeak.com/forum/thingspeak-api/problem-with-arduino-sim908-gprs-module/", "posts": [{"date": "July 4, 2017 - 5:20 pm", "content": "Hi, I want to upload data to Thingspeak using the SIM908 module, but I don't get any answer in my Thingspeak channel.I'm new with this and if you could help me it would be great. Here is the code:\u00a0int8_t answer;int onModulePin= 2;char aux_str[50];\u00a0float pressure= 100;String humidity='1';String str;void setup(){ pinMode(onModulePin, OUTPUT); Serial.begin(115200);  Serial.println('Starting...'); power_on(); delay(3000); // sets the PIN code sendATcommand2('AT+CPIN=3765', 'OK', 'ERROR', 2000); delay(3000); while (sendATcommand2('AT+CREG?', '+CREG: 0,1', '+CREG: 0,5', 1000)==0);}void loop(){\u00a0humidity = '70'; pressure = 100;str='GET http://api.thingspeak.com/update?api_key=TPGL5UMZGNYO857K&field1=' + String(pressure);bidali();delay (20000);}void bidali (){char message_TCP [300]; str.toCharArray(message_TCP, 300); // converting TCP_message to char inorder for it to pass through AT commandif(sendATcommand2('AT+CIPMUX=0','OK','ERROR',1000)==1) { while(sendATcommand2('AT+CIPSTATUS','INITIAL','',500)==0); delay(5000);if(sendATcommand2('AT+CSTT='gprs-service.com','',''','OK','ERROR',30000)==1) { while(sendATcommand2('AT+CIPSTATUS','START','',500)==0); delay(5000);if(sendATcommand2('AT+CIICR','OK','ERROR',30000)==1) { while(sendATcommand2('AT+CIPSTATUS','GPRSACT','',500)==0); delay(5000);if(sendATcommand2('AT+CIFSR','.','ERROR',10000)==1) { while(sendATcommand2('AT+CIPSTATUS','IP STATUS','',500)==0); delay(5000); Serial.println('Openning TCP');if(sendATcommand2('AT+CIPSTART='TCP','api.thingspeak.com','80'','CONNECT OK', 'CONNECT FAIL', 30000)==1) { Serial.println('Konektatua');sprintf(aux_str,'AT+CIPSEND=%d', strlen(message_TCP)); if(sendATcommand2(aux_str,'>','ERROR',10000)==1) { sendATcommand2(message_TCP,'','ERROR',20000); Serial.println('Mensaje mandado!'); } sendATcommand2('AT+CIPCLOSE','CLOSE OK','ERROR',10000); } else { Serial.println('Errorea konexioa irekitzen'); } } else { Serial.println('Errorea IP helbidea lortzen'); } } else { Serial.println('Errorea hari gabeko konexioa irekitzen'); } } else { Serial.println('Errorea APN-a konfigurazioarekin'); }}else{ Serial.println('Errorea konexioa ezartzen');}sendATcommand2('AT+CIPSHUT','OK','ERROR',10000);delay (4000);}void power_on(){uint8_t answer=0; // checks if the module is started answer = sendATcommand2('AT', 'OK', 'OK', 2000); if (answer == 0) { // power on pulse digitalWrite(onModulePin,HIGH); delay(3000); digitalWrite(onModulePin,LOW); // waits for an answer from the module while(answer == 0){ // Send AT every two seconds and wait for the answer answer = sendATcommand2('AT', 'OK', 'OK', 2000); } }}int8_t sendATcommand2(char* ATcommand, char* expected_answer1, char* expected_answer2, unsigned int timeout){uint8_t x=0, answer=0; char response[100]; unsigned long previous;memset(response, '0', 100); // Initialize the string delay(100); while( Serial.available() > 0) Serial.read(); // Clean the input buffer Serial.println(ATcommand); // Send the AT command\u00a0x = 0; previous = millis();// this loop waits for the answer do{if(Serial.available() != 0){ response[x] = Serial.read(); x++; // check if the desired answer is in the response of the module if (strstr(response, expected_answer1) != NULL) { answer = 1; } else if(strstr(response, expected_answer2) !=NULL) { answer=2; } } } // Waits for the asnwer with time out while((answer == 0) && ((millis() - previous) < timeout));return answer;}What can be wrong? Thank you!", "num_user_post": " 2", "author": "Aitorto8"}, {"date": "July 12, 2017 - 8:27 am", "content": "What response codes are you getting when you post with this software? \u00a0Have you tried the post in a browser or POSTSMAN? \u00a0The formatting of your HTTP request looks correct.", "num_user_post": " 401", "author": "cstapels"}]}]}